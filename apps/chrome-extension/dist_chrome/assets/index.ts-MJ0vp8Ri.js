var ze=Object.defineProperty;var Ve=(e,t,r)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var w=(e,t,r)=>Ve(e,typeof t!="symbol"?t+"":t,r);var $e=Object.create,me=Object.defineProperty,We=Object.getOwnPropertyDescriptor,ge=Object.getOwnPropertyNames,Be=Object.getPrototypeOf,qe=Object.prototype.hasOwnProperty,O=(e,t)=>function(){return t||(0,e[ge(e)[0]])((t={exports:{}}).exports,t),t.exports},Fe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(var o=ge(t),s=0,i=o.length,a;s<i;s++)a=o[s],!qe.call(e,a)&&a!==r&&me(e,a,{get:(c=>t[c]).bind(null,a),enumerable:!(n=We(t,a))||n.enumerable});return e},b=(e,t,r)=>(r=e!=null?$e(Be(e)):{},Fe(me(r,"default",{value:e,enumerable:!0}),e)),ye=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/typeof.js"(e,t){function r(n){"@babel/helpers - typeof";return t.exports=r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t.exports.__esModule=!0,t.exports.default=t.exports,r(n)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}}),He=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPrimitive.js"(e,t){var r=ye().default;function n(o,s){if(r(o)!="object"||!o)return o;var i=o[Symbol.toPrimitive];if(i!==void 0){var a=i.call(o,s||"default");if(r(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}}),Ye=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPropertyKey.js"(e,t){var r=ye().default,n=He();function o(s){var i=n(s,"string");return r(i)=="symbol"?i:i+""}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}}),T=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/defineProperty.js"(e,t){var r=Ye();function n(o,s,i){return(s=r(s))in o?Object.defineProperty(o,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[s]=i,o}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}}),x=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/objectSpread2.js"(e,t){var r=T();function n(s,i){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);i&&(c=c.filter(function(u){return Object.getOwnPropertyDescriptor(s,u).enumerable})),a.push.apply(a,c)}return a}function o(s){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?n(Object(a),!0).forEach(function(c){r(s,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(c){Object.defineProperty(s,c,Object.getOwnPropertyDescriptor(a,c))})}return s}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}});function q(e){const t={subscribe(r){let n=null,o=!1,s=!1,i=!1;function a(){if(n===null){i=!0;return}s||(s=!0,typeof n=="function"?n():n&&n.unsubscribe())}return n=e({next(c){var u;o||(u=r.next)===null||u===void 0||u.call(r,c)},error(c){var u;o||(o=!0,(u=r.error)===null||u===void 0||u.call(r,c),a())},complete(){var c;o||(o=!0,(c=r.complete)===null||c===void 0||c.call(r),a())}}),i&&a(),{unsubscribe:a}},pipe(...r){return r.reduce(Je,t)}};return t}function Je(e,t){return t(e)}function Qe(e){const t=new AbortController;return new Promise((n,o)=>{let s=!1;function i(){s||(s=!0,a.unsubscribe())}t.signal.addEventListener("abort",()=>{o(t.signal.reason)});const a=e.subscribe({next(c){s=!0,n(c),i()},error(c){o(c)},complete(){t.abort(),i()}})})}function Xe(e){return t=>{let r=0,n=null;const o=[];function s(){n||(n=t.subscribe({next(a){for(const u of o){var c;(c=u.next)===null||c===void 0||c.call(u,a)}},error(a){for(const u of o){var c;(c=u.error)===null||c===void 0||c.call(u,a)}},complete(){for(const c of o){var a;(a=c.complete)===null||a===void 0||a.call(c)}}}))}function i(){if(r===0&&n){const a=n;n=null,a.unsubscribe()}}return q(a=>(r++,o.push(a),s(),{unsubscribe(){r--,i();const c=o.findIndex(u=>u===a);c>-1&&o.splice(c,1)}}))}}function Ze(e){let t=e;const r=[],n=i=>{t!==void 0&&i.next(t),r.push(i)},o=i=>{r.splice(r.indexOf(i),1)},s=q(i=>(n(i),()=>{o(i)}));return s.next=i=>{if(t!==i){t=i;for(const a of r)a.next(i)}},s.get=()=>t,s}function et(e){return q(t=>{function r(o=0,s=e.op){const i=e.links[o];if(!i)throw new Error("No more links to execute - did you forget to add an ending link?");return i({op:s,next(c){return r(o+1,c)}})}return r().subscribe(t)})}function M(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}var tt=Object.create,he=Object.defineProperty,rt=Object.getOwnPropertyDescriptor,be=Object.getOwnPropertyNames,nt=Object.getPrototypeOf,ot=Object.prototype.hasOwnProperty,G=(e,t)=>function(){return t||(0,e[be(e)[0]])((t={exports:{}}).exports,t),t.exports},st=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(var o=be(t),s=0,i=o.length,a;s<i;s++)a=o[s],!ot.call(e,a)&&a!==r&&he(e,a,{get:(c=>t[c]).bind(null,a),enumerable:!(n=rt(t,a))||n.enumerable});return e},F=(e,t,r)=>(r=e!=null?tt(nt(e)):{},st(he(r,"default",{value:e,enumerable:!0}),e));const ve=()=>{},se=e=>{Object.freeze&&Object.freeze(e)};function we(e,t,r){var n;const o=t.join(".");return(n=r[o])!==null&&n!==void 0||(r[o]=new Proxy(ve,{get(s,i){if(!(typeof i!="string"||i==="then"))return we(e,[...t,i],r)},apply(s,i,a){const c=t[t.length-1];let u={args:a,path:t};return c==="call"?u={args:a.length>=2?[a[1]]:[],path:t.slice(0,-1)}:c==="apply"&&(u={args:a.length>=2?a[1]:[],path:t.slice(0,-1)}),se(u.args),se(u.path),e(u)}})),r[o]}const it=e=>we(e,[],Object.create(null)),at=e=>new Proxy(ve,{get(t,r){if(r!=="then")return e(r)}});var Pe=G({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/typeof.js"(e,t){function r(n){"@babel/helpers - typeof";return t.exports=r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t.exports.__esModule=!0,t.exports.default=t.exports,r(n)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}}),ct=G({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPrimitive.js"(e,t){var r=Pe().default;function n(o,s){if(r(o)!="object"||!o)return o;var i=o[Symbol.toPrimitive];if(i!==void 0){var a=i.call(o,s||"default");if(r(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}}),ut=G({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPropertyKey.js"(e,t){var r=Pe().default,n=ct();function o(s){var i=n(s,"string");return r(i)=="symbol"?i:i+""}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}}),xe=G({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/defineProperty.js"(e,t){var r=ut();function n(o,s,i){return(s=r(s))in o?Object.defineProperty(o,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[s]=i,o}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}}),oe=G({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/objectSpread2.js"(e,t){var r=xe();function n(s,i){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);i&&(c=c.filter(function(u){return Object.getOwnPropertyDescriptor(s,u).enumerable})),a.push.apply(a,c)}return a}function o(s){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?n(Object(a),!0).forEach(function(c){r(s,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(c){Object.defineProperty(s,c,Object.getOwnPropertyDescriptor(a,c))})}return s}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}});F(oe());F(xe());var K=F(oe());function lt(e,t){if("error"in e){const n=t.deserialize(e.error);return{ok:!1,error:(0,K.default)((0,K.default)({},e),{},{error:n})}}return{ok:!0,result:(0,K.default)((0,K.default)({},e.result),(!e.result.type||e.result.type==="data")&&{type:"data",data:t.deserialize(e.result.data)})}}var Y=class extends Error{constructor(){super("Unable to transform response from server")}};function dt(e,t){let r;try{r=lt(e,t)}catch{throw new Y}if(!r.ok&&(!M(r.error.error)||typeof r.error.error.code!="number"))throw new Y;if(r.ok&&!M(r.result))throw new Y;return r}F(oe());var z=b(T()),I=b(x());function ft(e){return e instanceof B}function pt(e){return M(e)&&M(e.error)&&typeof e.error.code=="number"&&typeof e.error.message=="string"}function mt(e,t){return typeof e=="string"?e:M(e)&&typeof e.message=="string"?e.message:t}var B=class $ extends Error{constructor(t,r){var n,o;const s=r==null?void 0:r.cause;super(t,{cause:s}),(0,z.default)(this,"cause",void 0),(0,z.default)(this,"shape",void 0),(0,z.default)(this,"data",void 0),(0,z.default)(this,"meta",void 0),this.meta=r==null?void 0:r.meta,this.cause=s,this.shape=r==null||(n=r.result)===null||n===void 0?void 0:n.error,this.data=r==null||(o=r.result)===null||o===void 0?void 0:o.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,$.prototype)}static from(t,r={}){const n=t;return ft(n)?(r.meta&&(n.meta=(0,I.default)((0,I.default)({},n.meta),r.meta)),n):pt(n)?new $(n.error.message,(0,I.default)((0,I.default)({},r),{},{result:n})):new $(mt(n,"Unknown error"),(0,I.default)((0,I.default)({},r),{},{cause:n}))}};function gt(e){const t=e;return t?"input"in t?t:{input:t,output:t}:{input:{serialize:r=>r,deserialize:r=>r},output:{serialize:r=>r,deserialize:r=>r}}}const ie=e=>typeof e=="function";function yt(e){if(e)return e;if(typeof window<"u"&&ie(window.fetch))return window.fetch;if(typeof globalThis<"u"&&ie(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}var A=b(x());function ht(e){return{url:e.url.toString(),fetch:e.fetch,transformer:gt(e.transformer),methodOverride:e.methodOverride}}function bt(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];t[r]=n}return t}const vt={query:"GET",mutation:"POST",subscription:"PATCH"};function Ce(e){return"input"in e?e.transformer.input.serialize(e.input):bt(e.inputs.map(t=>e.transformer.input.serialize(t)))}const Oe=e=>{const t=e.url.split("?");let n=t[0].replace(/\/$/,"")+"/"+e.path;const o=[];if(t[1]&&o.push(t[1]),"inputs"in e&&o.push("batch=1"),e.type==="query"||e.type==="subscription"){const s=Ce(e);s!==void 0&&e.methodOverride!=="POST"&&o.push(`input=${encodeURIComponent(JSON.stringify(s))}`)}return o.length&&(n+="?"+o.join("&")),n},wt=e=>{if(e.type==="query"&&e.methodOverride!=="POST")return;const t=Ce(e);return t!==void 0?JSON.stringify(t):void 0},Pt=e=>St((0,A.default)((0,A.default)({},e),{},{contentTypeHeader:"application/json",getUrl:Oe,getBody:wt}));var xt=class extends Error{constructor(){const e="AbortError";super(e),this.name=e,this.message=e}};const Ct=e=>{var t;if(e!=null&&e.aborted)throw(t=e.throwIfAborted)===null||t===void 0||t.call(e),typeof DOMException<"u"?new DOMException("AbortError","AbortError"):new xt};async function Ot(e){var t;Ct(e.signal);const r=e.getUrl(e),n=e.getBody(e),{type:o}=e,s=await(async()=>{const a=await e.headers();return Symbol.iterator in a?Object.fromEntries(a):a})(),i=(0,A.default)((0,A.default)((0,A.default)({},e.contentTypeHeader?{"content-type":e.contentTypeHeader}:{}),e.trpcAcceptHeader?{"trpc-accept":e.trpcAcceptHeader}:void 0),s);return yt(e.fetch)(r,{method:(t=e.methodOverride)!==null&&t!==void 0?t:vt[o],signal:e.signal,body:n,headers:i})}async function St(e){const t={},r=await Ot(e);t.response=r;const n=await r.json();return t.responseJSON=n,{json:n,meta:t}}b(x());const ae=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function ce(e){let t=null,r=null;const n=()=>{clearTimeout(r),r=null,t=null};function o(a){const c=[[]];let u=0;for(;;){const m=a[u];if(!m)break;const d=c[c.length-1];if(m.aborted){var p;(p=m.reject)===null||p===void 0||p.call(m,new Error("Aborted")),u++;continue}if(e.validate(d.concat(m).map(f=>f.key))){d.push(m),u++;continue}if(d.length===0){var l;(l=m.reject)===null||l===void 0||l.call(m,new Error("Input is too big for a single dispatch")),u++;continue}c.push([])}return c}function s(){const a=o(t);n();for(const c of a){if(!c.length)continue;const u={items:c};for(const l of c)l.batch=u;e.fetch(u.items.map(l=>l.key)).then(async l=>{await Promise.all(l.map(async(d,y)=>{const f=u.items[y];try{var v;const P=await Promise.resolve(d);(v=f.resolve)===null||v===void 0||v.call(f,P)}catch(P){var E;(E=f.reject)===null||E===void 0||E.call(f,P)}f.batch=null,f.reject=null,f.resolve=null}));for(const d of u.items){var m;(m=d.reject)===null||m===void 0||m.call(d,new Error("Missing result")),d.batch=null}}).catch(l=>{for(const d of u.items){var m;(m=d.reject)===null||m===void 0||m.call(d,l),d.batch=null}})}}function i(a){var c;const u={aborted:!1,key:a,batch:null,resolve:ae,reject:ae},p=new Promise((l,m)=>{var d;u.reject=m,u.resolve=l,(d=t)!==null&&d!==void 0||(t=[]),t.push(u)});return(c=r)!==null&&c!==void 0||(r=setTimeout(s)),p}return{load:i}}function _t(...e){const t=new AbortController,r=e.length;let n=0;const o=()=>{++n===r&&t.abort()};for(const s of e)s!=null&&s.aborted?o():s==null||s.addEventListener("abort",o,{once:!0});return t.signal}var V=b(x());function kt(e){var t,r;const n=ht(e),o=(t=e.maxURLLength)!==null&&t!==void 0?t:1/0,s=(r=e.maxItems)!==null&&r!==void 0?r:1/0;return()=>{const i=p=>({validate(l){if(o===1/0&&s===1/0)return!0;if(l.length>s)return!1;const m=l.map(f=>f.path).join(","),d=l.map(f=>f.input);return Oe((0,V.default)((0,V.default)({},n),{},{type:p,path:m,inputs:d,signal:null})).length<=o},async fetch(l){const m=l.map(P=>P.path).join(","),d=l.map(P=>P.input),y=_t(...l.map(P=>P.signal)),f=await Pt((0,V.default)((0,V.default)({},n),{},{path:m,inputs:d,type:p,headers(){return e.headers?typeof e.headers=="function"?e.headers({opList:l}):e.headers:{}},signal:y}));return(Array.isArray(f.json)?f.json:l.map(()=>f.json)).map(P=>({meta:f.meta,json:P}))}}),a=ce(i("query")),c=ce(i("mutation")),u={query:a,mutation:c};return({op:p})=>q(l=>{/* istanbul ignore if -- @preserve */if(p.type==="subscription")throw new Error("Subscriptions are unsupported by `httpLink` - use `httpSubscriptionLink` or `wsLink`");const d=u[p.type].load(p);let y;return d.then(f=>{y=f;const v=dt(f.json,n.transformer.output);if(!v.ok){l.error(B.from(v.error,{meta:f.meta}));return}l.next({context:f.meta,result:v.result}),l.complete()}).catch(f=>{l.error(B.from(f,{meta:y==null?void 0:y.meta}))}),()=>{}})}}b(x());const Se=(e,...t)=>typeof e=="function"?e(...t):e;b(T());function Tt(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}async function Et(e){const t=await Se(e.url);if(!e.connectionParams)return t;const n=`${t.includes("?")?"&":"?"}connectionParams=1`;return t+n}async function It(e){const t={method:"connectionParams",data:await Se(e)};return JSON.stringify(t)}b(T());var _=b(T());function jt(e){const{promise:t,resolve:r,reject:n}=Tt();return e.addEventListener("open",()=>{e.removeEventListener("error",n),r()}),e.addEventListener("error",n),t}function Rt(e,{intervalMs:t,pongTimeoutMs:r}){let n,o;function s(){n=setTimeout(()=>{e.send("PING"),o=setTimeout(()=>{e.close()},r)},t)}function i(){clearTimeout(n),s()}function a(){clearTimeout(o),i()}e.addEventListener("open",s),e.addEventListener("message",({data:c})=>{clearTimeout(n),s(),c==="PONG"&&a()}),e.addEventListener("close",()=>{clearTimeout(n),clearTimeout(o)})}var At=class X{constructor(t){var r;if((0,_.default)(this,"id",++X.connectCount),(0,_.default)(this,"WebSocketPonyfill",void 0),(0,_.default)(this,"urlOptions",void 0),(0,_.default)(this,"keepAliveOpts",void 0),(0,_.default)(this,"wsObservable",Ze(null)),(0,_.default)(this,"openPromise",null),this.WebSocketPonyfill=(r=t.WebSocketPonyfill)!==null&&r!==void 0?r:WebSocket,!this.WebSocketPonyfill)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");this.urlOptions=t.urlOptions,this.keepAliveOpts=t.keepAlive}get ws(){return this.wsObservable.get()}set ws(t){this.wsObservable.next(t)}isOpen(){return!!this.ws&&this.ws.readyState===this.WebSocketPonyfill.OPEN&&!this.openPromise}isClosed(){return!!this.ws&&(this.ws.readyState===this.WebSocketPonyfill.CLOSING||this.ws.readyState===this.WebSocketPonyfill.CLOSED)}async open(){var t=this;if(t.openPromise)return t.openPromise;t.id=++X.connectCount;const r=Et(t.urlOptions).then(n=>new t.WebSocketPonyfill(n));t.openPromise=r.then(async n=>{t.ws=n,n.addEventListener("message",function({data:o}){o==="PING"&&this.send("PONG")}),t.keepAliveOpts.enabled&&Rt(n,t.keepAliveOpts),n.addEventListener("close",()=>{t.ws===n&&(t.ws=null)}),await jt(n),t.urlOptions.connectionParams&&n.send(await It(t.urlOptions.connectionParams))});try{await t.openPromise}finally{t.openPromise=null}}async close(){var t=this;try{await t.openPromise}finally{var r;(r=t.ws)===null||r===void 0||r.close()}}};(0,_.default)(At,"connectCount",0);b(T());b(x());var J=b(T()),ue=b(x()),Nt=class{constructor(e){(0,J.default)(this,"links",void 0),(0,J.default)(this,"runtime",void 0),(0,J.default)(this,"requestId",void 0),this.requestId=0,this.runtime={},this.links=e.links.map(t=>t(this.runtime))}$request(e){var t;return et({links:this.links,op:(0,ue.default)((0,ue.default)({},e),{},{context:(t=e.context)!==null&&t!==void 0?t:{},id:++this.requestId})}).pipe(Xe())}async requestAsPromise(e){var t=this;try{const r=t.$request(e);return(await Qe(r)).result.data}catch(r){throw B.from(r)}}query(e,t,r){return this.requestAsPromise({type:"query",path:e,input:t,context:r==null?void 0:r.context,signal:r==null?void 0:r.signal})}mutation(e,t,r){return this.requestAsPromise({type:"mutation",path:e,input:t,context:r==null?void 0:r.context,signal:r==null?void 0:r.signal})}subscription(e,t,r){return this.$request({type:"subscription",path:e,input:t,context:r.context,signal:r.signal}).subscribe({next(o){switch(o.result.type){case"state":{var s;(s=r.onConnectionStateChange)===null||s===void 0||s.call(r,o.result);break}case"started":{var i;(i=r.onStarted)===null||i===void 0||i.call(r,{context:o.context});break}case"stopped":{var a;(a=r.onStopped)===null||a===void 0||a.call(r);break}case"data":case void 0:{var c;(c=r.onData)===null||c===void 0||c.call(r,o.result.data);break}}},error(o){var s;(s=r.onError)===null||s===void 0||s.call(r,o)},complete(){var o;(o=r.onComplete)===null||o===void 0||o.call(r)}})}};const Mt=Symbol.for("trpc_untypedClient"),Lt={query:"query",mutate:"mutation",subscribe:"subscription"},Dt=e=>Lt[e];function Ut(e){const t=it(({path:r,args:n})=>{const o=[...r],s=Dt(o.pop()),i=o.join(".");return e[s](i,...n)});return at(r=>r===Mt?e:t[r])}function Gt(e){const t=new Nt(e);return Ut(t)}b(x());b(x());var Kt=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/asyncIterator.js"(e,t){function r(o){var s,i,a,c=2;for(typeof Symbol<"u"&&(i=Symbol.asyncIterator,a=Symbol.iterator);c--;){if(i&&(s=o[i])!=null)return s.call(o);if(a&&(s=o[a])!=null)return new n(s.call(o));i="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function n(o){function s(i){if(Object(i)!==i)return Promise.reject(new TypeError(i+" is not an object."));var a=i.done;return Promise.resolve(i.value).then(function(c){return{value:c,done:a}})}return n=function(a){this.s=a,this.n=a.next},n.prototype={s:null,n:null,next:function(){return s(this.n.apply(this.s,arguments))},return:function(a){var c=this.s.return;return c===void 0?Promise.resolve({value:a,done:!0}):s(c.apply(this.s,arguments))},throw:function(a){var c=this.s.return;return c===void 0?Promise.reject(a):s(c.apply(this.s,arguments))}},new n(o)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}});b(Kt());b(x());var zt=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/usingCtx.js"(e,t){function r(){var n=typeof SuppressedError=="function"?SuppressedError:function(a,c){var u=Error();return u.name="SuppressedError",u.error=a,u.suppressed=c,u},o={},s=[];function i(a,c){if(c!=null){if(Object(c)!==c)throw new TypeError("using declarations can only be used with objects, functions, null, or undefined.");if(a)var u=c[Symbol.asyncDispose||Symbol.for("Symbol.asyncDispose")];if(u===void 0&&(u=c[Symbol.dispose||Symbol.for("Symbol.dispose")],a))var p=u;if(typeof u!="function")throw new TypeError("Object is not disposable.");p&&(u=function(){try{p.call(c)}catch(m){return Promise.reject(m)}}),s.push({v:c,d:u,a})}else a&&s.push({d:c,a});return c}return{e:o,u:i.bind(null,!1),a:i.bind(null,!0),d:function(){var c,u=this.e,p=0;function l(){for(;c=s.pop();)try{if(!c.a&&p===1)return p=0,s.push(c),Promise.resolve().then(l);if(c.d){var d=c.d.call(c.v);if(c.a)return p|=2,Promise.resolve(d).then(l,m)}else p|=1}catch(y){return m(y)}if(p===1)return u!==o?Promise.reject(u):Promise.resolve();if(u!==o)throw u}function m(d){return u=u!==o?new n(d,u):d,l()}return l()}}}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}}),_e=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/OverloadYield.js"(e,t){function r(n,o){this.v=n,this.k=o}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}}),Vt=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/awaitAsyncGenerator.js"(e,t){var r=_e();function n(o){return new r(o,0)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}}),$t=O({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/wrapAsyncGenerator.js"(e,t){var r=_e();function n(s){return function(){return new o(s.apply(this,arguments))}}function o(s){var i,a;function c(p,l){try{var m=s[p](l),d=m.value,y=d instanceof r;Promise.resolve(y?d.v:d).then(function(f){if(y){var v=p==="return"?"return":"next";if(!d.k||f.done)return c(v,f);f=s[v](f).value}u(m.done?"return":"normal",f)},function(f){c("throw",f)})}catch(f){u("throw",f)}}function u(p,l){switch(p){case"return":i.resolve({value:l,done:!0});break;case"throw":i.reject(l);break;default:i.resolve({value:l,done:!1})}(i=i.next)?c(i.key,i.arg):a=null}this._invoke=function(p,l){return new Promise(function(m,d){var y={key:p,arg:l,resolve:m,reject:d,next:null};a?a=a.next=y:(i=a=y,c(p,l))})},typeof s.return!="function"&&(this.return=void 0)}o.prototype[typeof Symbol=="function"&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},o.prototype.next=function(s){return this._invoke("next",s)},o.prototype.throw=function(s){return this._invoke("throw",s)},o.prototype.return=function(s){return this._invoke("return",s)},t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}});b(zt());b(Vt());b($t());b(x());class Wt{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,r){this.keyToValue.set(t,r),this.valueToKey.set(r,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class ke{constructor(t){this.generateIdentifier=t,this.kv=new Wt}register(t,r){this.kv.getByValue(t)||(r||(r=this.generateIdentifier(t)),this.kv.set(r,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class Bt extends ke{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(t,r.allowProps),super.register(t,r.identifier)):super.register(t,r)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function qt(e){if("values"in Object)return Object.values(e);const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function Ft(e,t){const r=qt(e);if("find"in r)return r.find(t);const n=r;for(let o=0;o<n.length;o++){const s=n[o];if(t(s))return s}}function R(e,t){Object.entries(e).forEach(([r,n])=>t(n,r))}function W(e,t){return e.indexOf(t)!==-1}function le(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(t(n))return n}}class Ht{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return Ft(this.transfomers,r=>r.isApplicable(t))}findByName(t){return this.transfomers[t]}}const Yt=e=>Object.prototype.toString.call(e).slice(8,-1),Te=e=>typeof e>"u",Jt=e=>e===null,L=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,Z=e=>L(e)&&Object.keys(e).length===0,S=e=>Array.isArray(e),Qt=e=>typeof e=="string",Xt=e=>typeof e=="number"&&!isNaN(e),Zt=e=>typeof e=="boolean",er=e=>e instanceof RegExp,D=e=>e instanceof Map,U=e=>e instanceof Set,Ee=e=>Yt(e)==="Symbol",tr=e=>e instanceof Date&&!isNaN(e.valueOf()),rr=e=>e instanceof Error,de=e=>typeof e=="number"&&isNaN(e),nr=e=>Zt(e)||Jt(e)||Te(e)||Xt(e)||Qt(e)||Ee(e),or=e=>typeof e=="bigint",sr=e=>e===1/0||e===-1/0,ir=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),ar=e=>e instanceof URL,Ie=e=>e.replace(/\./g,"\\."),Q=e=>e.map(String).map(Ie).join("."),N=e=>{const t=[];let r="";for(let o=0;o<e.length;o++){let s=e.charAt(o);if(s==="\\"&&e.charAt(o+1)==="."){r+=".",o++;continue}if(s==="."){t.push(r),r="";continue}r+=s}const n=r;return t.push(n),t};function C(e,t,r,n){return{isApplicable:e,annotation:t,transform:r,untransform:n}}const je=[C(Te,"undefined",()=>null,()=>{}),C(or,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),C(tr,"Date",e=>e.toISOString(),e=>new Date(e)),C(rr,"Error",(e,t)=>{const r={name:e.name,message:e.message};return t.allowedErrorProps.forEach(n=>{r[n]=e[n]}),r},(e,t)=>{const r=new Error(e.message);return r.name=e.name,r.stack=e.stack,t.allowedErrorProps.forEach(n=>{r[n]=e[n]}),r}),C(er,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),r=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,r)}),C(U,"set",e=>[...e.values()],e=>new Set(e)),C(D,"map",e=>[...e.entries()],e=>new Map(e)),C(e=>de(e)||sr(e),"number",e=>de(e)?"NaN":e>0?"Infinity":"-Infinity",Number),C(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),C(ar,"URL",e=>e.toString(),e=>new URL(e))];function H(e,t,r,n){return{isApplicable:e,annotation:t,transform:r,untransform:n}}const Re=H((e,t)=>Ee(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,r)=>{const n=r.symbolRegistry.getValue(t[1]);if(!n)throw new Error("Trying to deserialize unknown symbol");return n}),cr=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Ae=H(ir,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const r=cr[t[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(e)});function Ne(e,t){return e!=null&&e.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}const Me=H(Ne,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const r=t.classRegistry.getAllowedProps(e.constructor);if(!r)return{...e};const n={};return r.forEach(o=>{n[o]=e[o]}),n},(e,t,r)=>{const n=r.classRegistry.getValue(t[1]);if(!n)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(n.prototype),e)}),Le=H((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,r)=>{const n=r.customTransformerRegistry.findByName(t[1]);if(!n)throw new Error("Trying to deserialize unknown custom value");return n.deserialize(e)}),ur=[Me,Re,Le,Ae],fe=(e,t)=>{const r=le(ur,o=>o.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation(e,t)};const n=le(je,o=>o.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation}},De={};je.forEach(e=>{De[e.annotation]=e});const lr=(e,t,r)=>{if(S(t))switch(t[0]){case"symbol":return Re.untransform(e,t,r);case"class":return Me.untransform(e,t,r);case"custom":return Le.untransform(e,t,r);case"typed-array":return Ae.untransform(e,t,r);default:throw new Error("Unknown transformation: "+t)}else{const n=De[t];if(!n)throw new Error("Unknown transformation: "+t);return n.untransform(e,r)}},j=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const r=e.keys();for(;t>0;)r.next(),t--;return r.next().value};function Ue(e){if(W(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(W(e,"prototype"))throw new Error("prototype is not allowed as a property");if(W(e,"constructor"))throw new Error("constructor is not allowed as a property")}const dr=(e,t)=>{Ue(t);for(let r=0;r<t.length;r++){const n=t[r];if(U(e))e=j(e,+n);else if(D(e)){const o=+n,s=+t[++r]==0?"key":"value",i=j(e,o);switch(s){case"key":e=i;break;case"value":e=e.get(i);break}}else e=e[n]}return e},ee=(e,t,r)=>{if(Ue(t),t.length===0)return r(e);let n=e;for(let s=0;s<t.length-1;s++){const i=t[s];if(S(n)){const a=+i;n=n[a]}else if(L(n))n=n[i];else if(U(n)){const a=+i;n=j(n,a)}else if(D(n)){if(s===t.length-2)break;const c=+i,u=+t[++s]==0?"key":"value",p=j(n,c);switch(u){case"key":n=p;break;case"value":n=n.get(p);break}}}const o=t[t.length-1];if(S(n)?n[+o]=r(n[+o]):L(n)&&(n[o]=r(n[o])),U(n)){const s=j(n,+o),i=r(s);s!==i&&(n.delete(s),n.add(i))}if(D(n)){const s=+t[t.length-2],i=j(n,s);switch(+o==0?"key":"value"){case"key":{const c=r(i);n.set(c,n.get(i)),c!==i&&n.delete(i);break}case"value":{n.set(i,r(n.get(i)));break}}}return e};function te(e,t,r=[]){if(!e)return;if(!S(e)){R(e,(s,i)=>te(s,t,[...r,...N(i)]));return}const[n,o]=e;o&&R(o,(s,i)=>{te(s,t,[...r,...N(i)])}),t(n,r)}function fr(e,t,r){return te(t,(n,o)=>{e=ee(e,o,s=>lr(s,n,r))}),e}function pr(e,t){function r(n,o){const s=dr(e,N(o));n.map(N).forEach(i=>{e=ee(e,i,()=>s)})}if(S(t)){const[n,o]=t;n.forEach(s=>{e=ee(e,N(s),()=>e)}),o&&R(o,r)}else R(t,r);return e}const mr=(e,t)=>L(e)||S(e)||D(e)||U(e)||Ne(e,t);function gr(e,t,r){const n=r.get(e);n?n.push(t):r.set(e,[t])}function yr(e,t){const r={};let n;return e.forEach(o=>{if(o.length<=1)return;t||(o=o.map(a=>a.map(String)).sort((a,c)=>a.length-c.length));const[s,...i]=o;s.length===0?n=i.map(Q):r[Q(s)]=i.map(Q)}),n?Z(r)?[n]:[n,r]:Z(r)?void 0:r}const Ge=(e,t,r,n,o=[],s=[],i=new Map)=>{const a=nr(e);if(!a){gr(e,o,t);const d=i.get(e);if(d)return n?{transformedValue:null}:d}if(!mr(e,r)){const d=fe(e,r),y=d?{transformedValue:d.value,annotations:[d.type]}:{transformedValue:e};return a||i.set(e,y),y}if(W(s,e))return{transformedValue:null};const c=fe(e,r),u=(c==null?void 0:c.value)??e,p=S(u)?[]:{},l={};R(u,(d,y)=>{if(y==="__proto__"||y==="constructor"||y==="prototype")throw new Error(`Detected property ${y}. This is a prototype pollution risk, please remove it from your object.`);const f=Ge(d,t,r,n,[...o,y],[...s,e],i);p[y]=f.transformedValue,S(f.annotations)?l[y]=f.annotations:L(f.annotations)&&R(f.annotations,(v,E)=>{l[Ie(y)+"."+E]=v})});const m=Z(l)?{transformedValue:p,annotations:c?[c.type]:void 0}:{transformedValue:p,annotations:c?[c.type,l]:l};return a||i.set(e,m),m};function Ke(e){return Object.prototype.toString.call(e).slice(8,-1)}function pe(e){return Ke(e)==="Array"}function hr(e){if(Ke(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function br(e,t,r,n,o){const s={}.propertyIsEnumerable.call(n,t)?"enumerable":"nonenumerable";s==="enumerable"&&(e[t]=r),o&&s==="nonenumerable"&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0})}function re(e,t={}){if(pe(e))return e.map(o=>re(o,t));if(!hr(e))return e;const r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertySymbols(e);return[...r,...n].reduce((o,s)=>{if(pe(t.props)&&!t.props.includes(s))return o;const i=e[s],a=re(i,t);return br(o,s,a,e,t.nonenumerable),o},{})}class g{constructor({dedupe:t=!1}={}){this.classRegistry=new Bt,this.symbolRegistry=new ke(r=>r.description??""),this.customTransformerRegistry=new Ht,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const r=new Map,n=Ge(t,r,this,this.dedupe),o={json:n.transformedValue};n.annotations&&(o.meta={...o.meta,values:n.annotations});const s=yr(r,this.dedupe);return s&&(o.meta={...o.meta,referentialEqualities:s}),o}deserialize(t){const{json:r,meta:n}=t;let o=re(r);return n!=null&&n.values&&(o=fr(o,n.values,this)),n!=null&&n.referentialEqualities&&(o=pr(o,n.referentialEqualities)),o}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,r){this.classRegistry.register(t,r)}registerSymbol(t,r){this.symbolRegistry.register(t,r)}registerCustom(t,r){this.customTransformerRegistry.register({name:r,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}g.defaultInstance=new g;g.serialize=g.defaultInstance.serialize.bind(g.defaultInstance);g.deserialize=g.defaultInstance.deserialize.bind(g.defaultInstance);g.stringify=g.defaultInstance.stringify.bind(g.defaultInstance);g.parse=g.defaultInstance.parse.bind(g.defaultInstance);g.registerClass=g.defaultInstance.registerClass.bind(g.defaultInstance);g.registerSymbol=g.defaultInstance.registerSymbol.bind(g.defaultInstance);g.registerCustom=g.defaultInstance.registerCustom.bind(g.defaultInstance);g.allowErrorProps=g.defaultInstance.allowErrorProps.bind(g.defaultInstance);g.serialize;g.deserialize;g.stringify;g.parse;g.registerClass;g.registerCustom;g.registerSymbol;g.allowErrorProps;const vr=()=>{let e;return e="https://cow-pretty-titmouse.ngrok-free.app/api/trpc",console.log("tRPC Client: Connecting to server URL:",e),e};let ne=null;const wr=e=>{ne=e,console.log("tRPC Client: Cached token set, length:",(e==null?void 0:e.length)||0),e&&(console.log("tRPC Client: Cached token parts:",e.split(".").length),console.log("tRPC Client: Cached token (first 50 chars):",e.substring(0,50)+"..."))},Pr=async()=>ne?(console.log("tRPC Client: Using cached token"),ne):(console.warn("tRPC Client: No cached token available"),null),xr=()=>Gt({links:[kt({url:vr(),transformer:g,async headers(){const e=await Pr(),t={"x-trpc-source":"chrome-extension","ngrok-skip-browser-warning":"true","Content-Type":"application/json"};return e?(t.Authorization=`Bearer ${e}`,console.log("tRPC Client: Adding Authorization header with session token")):console.warn("tRPC Client: No token available - request will be unauthenticated"),console.log("tRPC Client: Headers being sent:",t),t},fetch:async(e,t)=>{const r=new AbortController,n=setTimeout(()=>r.abort(),3e4);try{const o=await fetch(e,{...t,signal:r.signal});return clearTimeout(n),o}catch(o){throw clearTimeout(n),o}}})]});class Cr{constructor(){w(this,"trpcClient",xr())}async generateComment(t,r){console.log("ðŸš€ AIService.generateComment() called - using tRPC API"),console.log("ðŸš€ Server URL will be determined by tRPC client"),console.log("ðŸš€ Post content length:",t.length),console.log("ðŸš€ Style guide length:",r.styleGuide.length);try{console.log("ðŸ“¡ Making tRPC call to server...");const n=await this.trpcClient.aiComments.generateComment.mutate({postContent:t,styleGuide:r.styleGuide});return console.log("âœ… tRPC call successful! Result:",{success:n.success,fallback:n.fallback,commentLength:n.comment.length,error:n.error}),n.comment}catch(n){return console.error("âŒ tRPC call failed:",n),console.error("âŒ Error type:",typeof n),console.error("âŒ Error message:",n instanceof Error?n.message:String(n)),console.error("âŒ Error stack:",n instanceof Error?n.stack:"No stack"),"Great post! Thanks for sharing your insights."}}}class Or{constructor(t){w(this,"dependencies");w(this,"handleMessage",(t,r,n)=>{switch(t.action){case"backgroundLog":return this.handleBackgroundLog(t,r,n);case"startAutoCommenting":return this.handleStartAutoCommenting(t,r,n);case"stopAutoCommenting":return this.handleStopAutoCommenting(t,r,n);case"generateComment":return this.handleGenerateComment(t,r,n);case"updateCommentCount":return this.handleUpdateCommentCount(t,r,n);case"commentingCompleted":return this.handleCommentingCompleted(t,r,n);case"moveToOriginalTab":return this.handleMoveToOriginalTab(t,r,n);case"pageReady":return this.handlePageReady(t,r,n);default:return console.warn("MessageRouter: Unknown action:",t.action),n({success:!1,error:"Unknown action"}),!1}});w(this,"handleBackgroundLog",(t,r,n)=>{const o=new Date().toLocaleTimeString(),s=r.tab?`[Tab ${r.tab.id}]`:"[Unknown Tab]";switch(t.level){case"error":console.error(`${o} ${s} CONTENT:`,...t.args);break;case"warn":console.warn(`${o} ${s} CONTENT:`,...t.args);break;case"group":console.group(`${o} ${s} CONTENT:`,...t.args);break;case"groupEnd":console.groupEnd();break;default:console.log(`${o} ${s} CONTENT:`,...t.args);break}return n({success:!0}),!1});w(this,"handleStartAutoCommenting",(t,r,n)=>{var s,i;if(console.log("MessageRouter: Received startAutoCommenting with settings:",{scrollDuration:t.scrollDuration,commentDelay:t.commentDelay,maxPosts:t.maxPosts,duplicateWindow:t.duplicateWindow,styleGuide:((s=t.styleGuide)==null?void 0:s.substring(0,50))+"...",hasClerkToken:!!t.clerkToken,tokenLength:((i=t.clerkToken)==null?void 0:i.length)||0}),!t.clerkToken)return console.error("MessageRouter: No Clerk token provided!"),n({success:!1,error:"No authentication token provided"}),!1;const o={styleGuide:t.styleGuide,scrollDuration:t.scrollDuration,commentDelay:t.commentDelay,maxPosts:t.maxPosts,duplicateWindow:t.duplicateWindow};return console.log("MessageRouter: Saving settings to storage:",o),chrome.storage.local.set(o),this.dependencies.startAutoCommenting(t.styleGuide,t.clerkToken,t.scrollDuration,t.commentDelay,t.maxPosts,t.duplicateWindow),n({success:!0}),!1});w(this,"handleStopAutoCommenting",(t,r,n)=>(console.log("MessageRouter: Received stopAutoCommenting request"),this.dependencies.autoCommentingState.isRunning=!1,this.dependencies.autoCommentingState.feedTabId&&chrome.tabs.sendMessage(this.dependencies.autoCommentingState.feedTabId,{action:"stopCommentingFlow"}),chrome.storage.local.set({isRunning:!1,currentCommentCount:0}),this.dependencies.autoCommentingState.commentCount=0,this.dependencies.autoCommentingState.originalTabId=void 0,this.dependencies.sendStatusUpdate("Process stopped and LinkedIn tab closed",{isRunning:!1}),n({success:!0}),!1));w(this,"handleGenerateComment",(t,r,n)=>{var o;return console.log("MessageRouter: Received comment generation request for content:",((o=t.postContent)==null?void 0:o.substring(0,100))+"..."),this.dependencies.generateComment(t.postContent).then(s=>{console.log("MessageRouter: Sending comment response:",s.substring(0,100)+"..."),n({comment:s})}).catch(s=>{console.error("MessageRouter: Error in comment generation promise:",s);const i={message:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,name:s instanceof Error?s.name:"Unknown",apiKey:this.dependencies.autoCommentingState.apiKey?"Present":"Missing",styleGuide:this.dependencies.autoCommentingState.styleGuide?"Present":"Missing",postContentLength:t.postContent?t.postContent.length:0,timestamp:new Date().toISOString(),type:"comment_generation_error"};this.dependencies.autoCommentingState.feedTabId&&chrome.tabs.sendMessage(this.dependencies.autoCommentingState.feedTabId,{action:"ai_generation_error",error:i}).catch(a=>{console.error("MessageRouter: Failed to send error to content script:",a)}),console.error("MessageRouter: Sending fallback comment due to error"),n({comment:"Great post! Thanks for sharing.",error:i})}),!0});w(this,"handleUpdateCommentCount",(t,r,n)=>(this.dependencies.autoCommentingState.commentCount=t.count,this.dependencies.sendStatusUpdate(t.status||`Processed ${t.count} comments`,{commentCount:t.count}),n({success:!0}),!1));w(this,"handleCommentingCompleted",(t,r,n)=>(this.dependencies.autoCommentingState.isRunning=!1,this.dependencies.autoCommentingState.feedTabId&&chrome.tabs.remove(this.dependencies.autoCommentingState.feedTabId).catch(()=>{console.log("LinkedIn tab was already closed or could not be closed")}),this.dependencies.autoCommentingState.originalTabId=void 0,this.dependencies.sendStatusUpdate("Commenting completed! LinkedIn tab closed. Check the counts above for total comments posted.",{isRunning:!1}),n({success:!0}),!1));w(this,"handleMoveToOriginalTab",(t,r,n)=>(console.log("MessageRouter: Received request to move back to the original tab"),this.dependencies.autoCommentingState.originalTabId&&chrome.tabs.update(this.dependencies.autoCommentingState.originalTabId,{active:!0}).then(()=>{console.log(`âœ… Successfully focused original tab ID: ${this.dependencies.autoCommentingState.originalTabId}`),n({success:!0})}),!0));w(this,"handlePageReady",(t,r,n)=>(console.log("Content script signaled page ready - showing start button"),this.dependencies.sendStatusUpdate("LinkedIn feed loaded. Showing start button..."),this.dependencies.autoCommentingState.feedTabId&&(chrome.tabs.sendMessage(this.dependencies.autoCommentingState.feedTabId,{action:"showStartButton"}),console.log("Start button should now be visible in the LinkedIn tab")),n({success:!0}),!1));this.dependencies=t}}console.log("background script loaded");let h={isRunning:!1,styleGuide:"",apiKey:"",scrollDuration:10,commentDelay:10,maxPosts:20,duplicateWindow:24,commentCount:0};const k=(e,t={})=>{try{chrome.runtime.sendMessage({action:"statusUpdate",status:e,commentCount:h.commentCount,isRunning:h.isRunning,...t}),chrome.storage.local.set({isRunning:h.isRunning,currentCommentCount:h.commentCount})}catch(r){console.error("Error sending status update:",r)}},Sr=e=>{const r=`comments_today_${new Date().toDateString()}`;chrome.storage.local.get([r],n=>{const s=(n[r]||0)+e;chrome.storage.local.set({[r]:s});try{chrome.runtime.sendMessage({action:"statusUpdate",newTodayTotal:s})}catch(i){console.error("Error sending today total update:",i)}})},_r=new Cr,kr=async e=>_r.generateComment(e,{apiKey:h.apiKey,styleGuide:h.styleGuide}),Tr=async(e,t,r,n,o,s)=>{var i;try{wr(t),console.log("Background: Cached Clerk token for tRPC client"),h.styleGuide=e,h.apiKey="",h.scrollDuration=r,h.commentDelay=n,h.maxPosts=o,h.duplicateWindow=s,h.isRunning=!0,h.commentCount=0,console.log("Starting LinkedIn auto-commenting process..."),k("Starting LinkedIn auto-commenting...");const a=await chrome.tabs.query({active:!0,currentWindow:!0});a.length>0&&((i=a[0])!=null&&i.id)&&(h.originalTabId=a[0].id,console.log(`Captured original tab ID: ${h.originalTabId}`));let c;if(console.log("Creating LinkedIn tab in current window..."),k("Creating LinkedIn tab for automation..."),c=await chrome.tabs.create({url:"https://www.linkedin.com/feed/",active:!0,pinned:!0}),!c||!c.id)throw new Error("Failed to create LinkedIn feed tab");h.feedTabId=c.id,console.log(`LinkedIn tab created with ID: ${c.id}`),console.log(`LinkedIn tab pinned status: ${c.pinned}`),k("LinkedIn tab created successfully as pinned tab (anti-throttling)..."),k("Waiting for LinkedIn page to load..."),console.log("Waiting for content script to signal page ready...")}catch(a){console.error("Error in auto-commenting process:",a),h.isRunning=!1,k("Error occurred during auto-commenting setup",{isRunning:!1})}},Er=new Or({autoCommentingState:h,sendStatusUpdate:k,updateTodayComments:Sr,startAutoCommenting:Tr,generateComment:kr});chrome.runtime.onMessage.addListener(Er.handleMessage);chrome.tabs.onRemoved.addListener(e=>{h.feedTabId===e&&(console.log("LinkedIn tab was manually closed"),h.feedTabId=void 0,h.isRunning&&(h.isRunning=!1,chrome.storage.local.set({isRunning:!1,currentCommentCount:0}),h.commentCount=0,h.originalTabId=void 0,k("LinkedIn tab was closed - automation stopped",{isRunning:!1})))});console.log("EngageKit background script loaded");
//# sourceMappingURL=index.ts-MJ0vp8Ri.js.map
