{"version":3,"file":"always-active-core.ts-DOrNw5Wi.js","sources":["../../src/pages/content/always-active-core.ts"],"sourcesContent":["// Always Active Core - TypeScript version for easy integration\n// This script spoofs browser visibility and focus states to keep tabs \"active\"\n\n// Type definitions\ntype VisibilityState = 'visible' | 'hidden' | 'prerender';\n\ninterface AlwaysActiveConfig {\n  enabled: boolean;\n  spoofVisibility: boolean;\n  spoofFocus: boolean;\n  blockBlur: boolean;\n  blockMouseLeave: boolean;\n  keepAnimations: boolean;\n}\n\ninterface AlwaysActiveAPI {\n  enable: () => void;\n  disable: () => void;\n  isEnabled: () => boolean;\n  configure: (newConfig: Partial<AlwaysActiveConfig>) => void;\n  getConfig: () => AlwaysActiveConfig;\n}\n\n// Extend Document interface for webkit properties\ninterface Document {\n  webkitVisibilityState?: VisibilityState;\n  webkitHidden?: boolean;\n}\n\n// Extend Window interface\ninterface Window {\n  alwaysActive: AlwaysActiveAPI;\n}\n\n(function(): void {\n  'use strict';\n  \n  // Configuration - you can modify these to enable/disable specific features\n  const config: AlwaysActiveConfig = {\n    enabled: true,\n    spoofVisibility: true,\n    spoofFocus: true,\n    blockBlur: true,\n    blockMouseLeave: true,\n    keepAnimations: true\n  };\n\n  // Helper function to block events\n  const blockEvent = (e: Event): void => {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n  };\n\n  // 1. SPOOF VISIBILITY STATE\n  if (config.spoofVisibility) {\n    // Override document.visibilityState to always return 'visible'\n    Object.defineProperty(document, 'visibilityState', {\n      get(): VisibilityState { return 'visible'; },\n      configurable: true\n    });\n\n    // Override document.hidden to always return false\n    Object.defineProperty(document, 'hidden', {\n      get(): boolean { return false; },\n      configurable: true\n    });\n\n    // Webkit-specific properties for Chromium browsers\n    Object.defineProperty(document, 'webkitVisibilityState', {\n      get(): VisibilityState { return 'visible'; },\n      configurable: true\n    });\n\n    Object.defineProperty(document, 'webkitHidden', {\n      get(): boolean { return false; },\n      configurable: true\n    });\n\n    // Block visibility change events\n    let firstVisibilityChange: boolean = true;\n    document.addEventListener('visibilitychange', (e: Event): void => {\n      if (config.enabled) {\n        if (firstVisibilityChange) {\n          firstVisibilityChange = false;\n          return; // Allow the first event to pass through\n        }\n        blockEvent(e);\n      }\n    }, true);\n\n    document.addEventListener('webkitvisibilitychange', (e: Event): void => {\n      if (config.enabled) blockEvent(e);\n    }, true);\n\n    // Block page hide events\n    window.addEventListener('pagehide', (e: PageTransitionEvent): void => {\n      if (config.enabled) blockEvent(e);\n    }, true);\n  }\n\n  // 2. SPOOF FOCUS STATE\n  if (config.spoofFocus) {\n    // Override document.hasFocus() to always return true\n    Document.prototype.hasFocus = new Proxy(Document.prototype.hasFocus, {\n      apply(target: () => boolean, self: Document, args: unknown[]): boolean {\n        if (config.enabled) return true;\n        return Reflect.apply(target, self, args);\n      }\n    });\n\n    // Block focus events (except the first one)\n    let firstFocus: boolean = true;\n    const handleFocus = (e: FocusEvent): void => {\n      if (config.enabled && (e.target === document || e.target === window)) {\n        if (firstFocus) {\n          firstFocus = false;\n          return;\n        }\n        blockEvent(e);\n      }\n    };\n    document.addEventListener('focus', handleFocus, true);\n    window.addEventListener('focus', handleFocus, true);\n  }\n\n  // 3. BLOCK BLUR EVENTS\n  if (config.blockBlur) {\n    const handleBlur = (e: FocusEvent): void => {\n      if (config.enabled && (e.target === document || e.target === window)) {\n        blockEvent(e);\n      }\n    };\n    document.addEventListener('blur', handleBlur, true);\n    window.addEventListener('blur', handleBlur, true);\n  }\n\n  // 4. BLOCK MOUSE LEAVE EVENTS\n  if (config.blockMouseLeave) {\n    window.addEventListener('mouseleave', (e: MouseEvent): void => {\n      if (config.enabled && (e.target === document || e.target === window)) {\n        blockEvent(e);\n      }\n    }, true);\n\n    window.addEventListener('mouseout', (e: MouseEvent): void => {\n      if (config.enabled && (e.target === document.documentElement || e.target === document.body)) {\n        blockEvent(e);\n      }\n    }, true);\n  }\n\n  // 5. KEEP ANIMATIONS RUNNING\n  if (config.keepAnimations) {\n    let lastTime: number = 0;\n    \n    // Override requestAnimationFrame to keep running even when tab is \"hidden\"\n    window.requestAnimationFrame = new Proxy(window.requestAnimationFrame, {\n      apply(\n        target: (callback: FrameRequestCallback) => number,\n        self: Window,\n        args: [FrameRequestCallback]\n      ): number {\n        if (config.enabled && document.hidden) {\n          // Simulate 60fps when tab would normally be throttled\n          const currTime: number = Date.now();\n          const timeToCall: number = Math.max(0, 16 - (currTime - lastTime));\n          const id: number = setTimeout((): void => {\n            args[0](performance.now());\n          }, timeToCall) as unknown as number;\n          lastTime = currTime + timeToCall;\n          return id;\n        }\n        return Reflect.apply(target, self, args);\n      }\n    });\n\n    // Override cancelAnimationFrame to work with our custom implementation\n    window.cancelAnimationFrame = new Proxy(window.cancelAnimationFrame, {\n      apply(\n        target: (handle: number) => void,\n        self: Window,\n        args: [number]\n      ): void {\n        if (config.enabled && document.hidden) {\n          clearTimeout(args[0]);\n          return;\n        }\n        return Reflect.apply(target, self, args);\n      }\n    });\n  }\n\n  // 6. UTILITY FUNCTIONS FOR YOUR EXTENSION\n  \n  // Function to enable/disable the always-active functionality\n  (window as Window).alwaysActive = {\n    enable: (): void => { \n      config.enabled = true; \n    },\n    \n    disable: (): void => { \n      config.enabled = false; \n    },\n    \n    isEnabled: (): boolean => config.enabled,\n    \n    // Configure specific features\n    configure: (newConfig: Partial<AlwaysActiveConfig>): void => {\n      Object.assign(config, newConfig);\n    },\n    \n    // Get current configuration\n    getConfig: (): AlwaysActiveConfig => ({ ...config })\n  };\n\n  console.log('Always Active Core loaded - Tab will appear active even when in background');\n})(); "],"names":["config","blockEvent","firstVisibilityChange","e","target","self","args","firstFocus","handleFocus","handleBlur","lastTime","currTime","timeToCall","id","newConfig"],"mappings":"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"}