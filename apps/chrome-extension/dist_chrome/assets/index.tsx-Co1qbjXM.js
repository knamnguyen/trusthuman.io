(function(){function x(e){return new Promise(o=>setTimeout(o,e))}const c=(...e)=>{console.log(...e),chrome.runtime.sendMessage({action:"backgroundLog",level:"log",args:e}).catch(()=>{})},M=(...e)=>{console.error(...e),chrome.runtime.sendMessage({action:"backgroundLog",level:"error",args:e}).catch(()=>{})},N=(...e)=>{console.warn(...e),chrome.runtime.sendMessage({action:"backgroundLog",level:"warn",args:e}).catch(()=>{})},j=(...e)=>{console.group(...e),chrome.runtime.sendMessage({action:"backgroundLog",level:"group",args:e}).catch(()=>{})},B=()=>{console.groupEnd(),chrome.runtime.sendMessage({action:"backgroundLog",level:"groupEnd",args:[]}).catch(()=>{})};let d=!1,L=new Set,D=new Map,E=0,A=0,T=new Map,k=0,$=0,y=null,_=null,w=null;document.readyState!=="loading"?(console.log("document is already ready, just execute code here"),chrome.runtime.sendMessage({action:"pageReady"})):document.addEventListener("DOMContentLoaded",function(){console.log("document was not ready, place code here"),chrome.runtime.sendMessage({action:"pageReady"})});function H(){if(console.log("ğŸš€ Showing start button for EngageKit..."),document.getElementById("linkedin-start-overlay"))return;const e=document.createElement("div");e.id="linkedin-start-overlay",e.style.cssText=`
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0, 115, 177, 0.95) !important;
    z-index: 2147483647 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    align-items: center !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
    color: white !important;
  `;const o=document.createElement("div");o.style.cssText=`
    text-align: center !important;
    max-width: 600px !important;
    padding: 40px !important;
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 20px !important;
    backdrop-filter: blur(10px) !important;
  `;const s=document.createElement("h1");s.textContent="EngageKit",s.style.cssText=`
    font-size: 48px !important;
    margin: 0 0 20px 0 !important;
    text-align: center !important;
    font-weight: bold !important;
    color: white !important;
  `;const t=document.createElement("p");t.textContent="Click to start auto-commenting on LinkedIn posts",t.style.cssText=`
    font-size: 20px !important;
    margin: 0 0 40px 0 !important;
    text-align: center !important;
    opacity: 0.9 !important;
    color: white !important;
  `;const n=document.createElement("button");n.textContent="ğŸš€ Start Auto-Commenting",n.style.cssText=`
    background: #ffffff !important;
    color: #0073b1 !important;
    border: none !important;
    padding: 20px 40px !important;
    font-size: 24px !important;
    font-weight: bold !important;
    border-radius: 12px !important;
    cursor: pointer !important;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
    transition: all 0.3s ease !important;
    margin: 0 0 20px 0 !important;
    font-family: inherit !important;
  `,n.addEventListener("mouseenter",()=>{n.style.transform="translateY(-2px)",n.style.boxShadow="0 12px 20px rgba(0,0,0,0.3)"}),n.addEventListener("mouseleave",()=>{n.style.transform="translateY(0)",n.style.boxShadow="0 8px 16px rgba(0,0,0,0.2)"});const r=document.createElement("p");r.innerHTML=`
    <strong>What will happen:</strong><br>
    â€¢ Audio will start playing to keep this tab active<br>
    â€¢ This window will move to the background<br>
    â€¢ Auto-commenting will begin immediately<br>
    â€¢ You can continue using other applications
  `,r.style.cssText=`
    font-size: 16px !important;
    text-align: center !important;
    opacity: 0.8 !important;
    line-height: 1.6 !important;
    max-width: 500px !important;
    margin: 0 !important;
    color: white !important;
  `,n.addEventListener("click",async()=>{console.log("ğŸš€ Start button clicked! Beginning full flow..."),n.textContent="ğŸ”„ Starting...",n.style.background="#28a745",n.style.color="white",n.disabled=!0;try{console.log("ğŸµ Step 1: Starting continuous audio..."),await Y(),n.textContent="ğŸµ Audio Started",await x(1e3),n.textContent="ğŸ’¬ Starting flow",chrome.storage.local.get(["scrollDuration","commentDelay","maxPosts","duplicateWindow","styleGuide","apiKey"],a=>{c("Content: Retrieved settings from storage:",a);const i=a.scrollDuration!==void 0?a.scrollDuration:10,l=a.commentDelay!==void 0?a.commentDelay:5,m=a.maxPosts!==void 0?a.maxPosts:5,u=a.duplicateWindow!==void 0?a.duplicateWindow:24,g=a.styleGuide!==void 0?a.styleGuide:"Be engaging and professional",p=a.apiKey!==void 0?a.apiKey:"";if(c("ğŸ¯ Starting commenting flow with settings:",{scrollDuration:i,commentDelay:l,maxPosts:m,styleGuide:(g==null?void 0:g.substring(0,50))+"...",hasApiKey:!!p}),!g){M("âŒ No style guide found in storage! Cannot start commenting.");return}n.textContent=`ğŸ“œ Scrolling to load posts (${i}s) - DON'T navigate away!`,n.style.background="#ff9500",n.style.fontSize="18px",t.textContent="Loading posts from LinkedIn feed - please keep this tab visible";const f=document.createElement("div");f.id="linkedin-status-panel",f.style.cssText=`
          background: rgba(255, 255, 255, 0.15) !important;
          border-radius: 12px !important;
          padding: 20px !important;
          margin-top: 20px !important;
          border: 1px solid rgba(255, 255, 255, 0.3) !important;
          font-family: monospace !important;
          font-size: 14px !important;
          line-height: 1.6 !important;
        `;const C=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length;f.innerHTML=`
          <div style="color: white !important; margin-bottom: 12px !important;">
            <strong>ğŸ“Š AUTOMATION SETTINGS</strong>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 8px !important;">
            ğŸ“œ Scroll Duration: <span style="color: #90EE90 !important;">${i} seconds</span>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 8px !important;">
            â±ï¸ Comment Delay: <span style="color: #90EE90 !important;">${l} seconds</span>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 16px !important;">
            ğŸ¯ Max Posts: <span style="color: #90EE90 !important;">${m} posts</span>
          </div>
          
          <div style="color: white !important; margin-bottom: 12px !important;">
            <strong>ğŸ“ˆ REAL-TIME STATUS</strong>
          </div>
          <div id="time-remaining" style="color: #FFD700 !important; margin-bottom: 8px !important;">
            â° Time Remaining: <span style="color: #FFA500 !important;">${i}s</span>
          </div>
          <div id="posts-loaded" style="color: #87CEEB !important; margin-bottom: 8px !important;">
            ğŸ“ Posts Loaded: <span style="color: #00BFFF !important;">${C} posts</span>
          </div>
          <div id="scroll-progress" style="color: #DDA0DD !important;">
            ğŸ”„ Status: <span style="color: #DA70D6 !important;">Starting scroll...</span>
          </div>
        `;const h=e.querySelector("div");h&&h.appendChild(f),W(i,l,m,g,u,e,n,t,f)}),console.log("âœ… Full flow started successfully!")}catch(a){console.error("âŒ Failed to start:",a),n.textContent="âŒ Failed - Try Again",n.style.background="#dc3545",n.disabled=!1,t.textContent="Something went wrong - click to try again"}}),o.appendChild(s),o.appendChild(t),o.appendChild(n),o.appendChild(r),e.appendChild(o),document.body.appendChild(e),console.log("ğŸš€ Start button overlay displayed")}async function Y(){return new Promise((e,o)=>{try{console.log("ğŸµ Initializing Web Audio API for continuous sound...");const s=window.AudioContext||window.webkitAudioContext;if(!s)throw new Error("Web Audio API is not supported in this browser. Cannot play audio.");y=new s;const t=y.createOscillator(),n=y.createGain(),r=y.createMediaStreamDestination();t.connect(n),n.connect(r),t.type="sine";const a=261.63,i=523.25,l=1e4;t.frequency.setValueAtTime(l,y.currentTime),n.gain.setValueAtTime(.001,y.currentTime),w=document.createElement("audio"),w.srcObject=r.stream,w.autoplay=!0,w.loop=!0,w.controls=!1,w.style.cssText="position: fixed; top: -9999px; opacity: 0;",document.body.appendChild(w),(async()=>{y.state==="suspended"&&await y.resume(),t.start(),_=t;const u=w.play();u!==void 0?u.then(()=>{console.log(`âœ… Playing a ${t.type} wave at ${l.toFixed(2)} Hz. Audio element injected and playing.`),e()}).catch(g=>{console.warn("âŒ Autoplay was prevented by the browser:",g),o(g)}):(console.log("âœ… Audio started successfully (no promise returned)"),e())})()}catch(s){console.error("âŒ Audio setup failed:",s),o(s)}})}chrome.runtime.onMessage.addListener((e,o,s)=>{if(console.log("Content script received message:",e),e.action==="showStartButton")console.log("ğŸ“± Popup requested to show start button"),H(),s({success:!0});else if(e.action==="startNewCommentingFlow")W(e.scrollDuration,e.commentDelay,e.maxPosts,e.styleGuide,e.apiKey,e.duplicateWindow||24,null,null,null),s({success:!0});else if(e.action==="stopCommentingFlow")console.log("Received stop signal - stopping commenting flow"),d=!1,P(),s({success:!0});else if(e.action==="statusUpdate"&&e.error){console.group("ğŸš¨ EngageKit Error Details"),console.error("Error Message:",e.error.message),e.error.status&&console.error("HTTP Status:",e.error.status,"-",e.error.statusText),e.error.body&&console.error("API Response Body:",e.error.body),e.error.headers&&console.error("Response Headers:",e.error.headers),console.error("API Key Status:",e.error.apiKey||"Unknown"),console.error("Style Guide Status:",e.error.styleGuide||"Unknown"),e.error.postContentLength!==void 0&&console.error("Post Content Length:",e.error.postContentLength,"characters"),e.error.stack&&console.error("Stack Trace:",e.error.stack),e.error.data&&console.error("Additional Data:",e.error.data),console.groupEnd();const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fee;
      border: 2px solid #f00;
      padding: 15px;
      border-radius: 8px;
      z-index: 10000;
      max-width: 400px;
      font-family: Arial, sans-serif;
      font-size: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,t.innerHTML=`
      <div style="font-weight: bold; color: #d00; margin-bottom: 8px;">
        ğŸš¨ EngageKit Error
      </div>
      <div style="color: #800; margin-bottom: 5px;">
        ${e.error.message||"Unknown error occurred"}
      </div>
      ${e.error.status?`<div style="color: #600; font-size: 11px;">HTTP ${e.error.status}: ${e.error.statusText}</div>`:""}
      <div style="color: #600; font-size: 11px; margin-top: 5px;">
        Check console for full details (F12)
      </div>
      <button onclick="this.parentElement.remove()" style="
        background: #d00;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 10px;
        margin-top: 8px;
      ">Close</button>
    `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},1e4)}});function U(){return new Date().toDateString()}async function q(){const e="commented_authors_timestamps";return new Promise(o=>{chrome.storage.local.get([e],s=>{const t=s[e]||{};o(new Map(Object.entries(t).map(([n,r])=>[n,Number(r)])))})})}async function V(e){const o="commented_authors_timestamps",s=Date.now();return new Promise(t=>{chrome.storage.local.get([o],n=>{const r=n[o]||{};r[e]=s,chrome.storage.local.set({[o]:r},()=>{console.log(`Saved commented author: ${e} at timestamp: ${s}`),t()})})})}function X(e,o,s){const t=o.get(e);if(!t)return!1;const n=Date.now(),r=s*60*60*1e3;return n-t<r}async function J(){const o=`commented_authors_${U()}`;return new Promise(s=>{chrome.storage.local.get([o],t=>{const n=t[o]||[];s(new Set(n))})})}async function Q(e){const o=U(),s=`commented_authors_${o}`;return new Promise(t=>{chrome.storage.local.get([s],n=>{const r=n[s]||[];r.includes(e)?t():(r.push(e),chrome.storage.local.set({[s]:r},()=>{console.log(`Saved commented author: ${e} for ${o}`),t()}))})})}async function Z(){return new Promise(e=>{chrome.storage.local.get(["postsSkippedDuplicate","recentAuthorsDetected","postsSkippedAlreadyCommented","duplicatePostsDetected"],o=>{E=o.postsSkippedDuplicate||0,A=o.recentAuthorsDetected||0,k=o.postsSkippedAlreadyCommented||0,$=o.duplicatePostsDetected||0,console.log(`Loaded counters - Posts skipped: ${E}, Recent authors: ${A}, Posts already commented: ${k}, Duplicate posts detected: ${$}`),e()})})}async function ee(){return E++,A++,$++,new Promise(e=>{chrome.storage.local.set({postsSkippedDuplicate:E,recentAuthorsDetected:A,duplicatePostsDetected:$},()=>{console.log(`Updated counters - Posts skipped: ${E}, Recent authors: ${A}, Duplicate posts detected: ${$}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",skippedCount:E,recentAuthorsCount:A,duplicatePostsDetectedCount:$}),e()})})}async function oe(){return new Promise(e=>{chrome.storage.local.get(["commented_post_urns"],o=>{const s=o.commented_post_urns||{};T=new Map(Object.entries(s).map(([t,n])=>[t,Number(n)])),console.log(`Loaded ${T.size} commented post URNs from storage`),e()})})}async function te(e){const o=Date.now();return T.set(e,o),new Promise(s=>{const t=Object.fromEntries(T);chrome.storage.local.set({commented_post_urns:t},()=>{console.log(`Saved commented post URN: ${e} at timestamp: ${o}`),s()})})}function ne(e){return T.has(e)}function se(e){const o=e.closest("div[data-id]");if(!o)return console.log("No div[data-id] found for this post container"),[];const s=o.getAttribute("data-id");if(!s)return console.log("No data-id attribute found"),[];console.log(`Found data-id: ${s}`);const t=[];if(s.startsWith("urn:li:aggregate:")){const n=s.match(/urn:li:aggregate:\((.*)\)/);if(n){const r=n[1].split(",").map(a=>a.trim());t.push(...r)}}else s.startsWith("urn:li:activity:")&&t.push(s);return console.log(`Extracted URNs: ${t.join(", ")}`),t}async function re(){return k++,$++,new Promise(e=>{chrome.storage.local.set({postsSkippedAlreadyCommented:k,duplicatePostsDetected:$},()=>{console.log(`Updated post already commented counter: ${k}`),console.log(`Updated duplicate posts detected counter: ${$}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",postsSkippedAlreadyCommentedCount:k,duplicatePostsDetectedCount:$}),e()})})}async function ie(){const o=Date.now();return new Promise(s=>{let t=0;const n=new Map;for(const[r,a]of T)o-a<31536e6?n.set(r,a):t++;if(t>0){T=n;const r=Object.fromEntries(T);chrome.storage.local.set({commented_post_urns:r},()=>{console.log(`Cleaned up ${t} old post URNs (older than 1 year)`),s()})}else console.log("No old post URNs to clean up"),s()})}async function ae(){const o=`comments_today_${U()}`;return new Promise(s=>{chrome.storage.local.get([o,"totalAllTimeComments"],t=>{const n=t[o]||0,r=t.totalAllTimeComments||0,a=n+1,i=r+1;chrome.storage.local.set({[o]:a,totalAllTimeComments:i},()=>{console.log(`Updated counts - Today: ${a}, All-time: ${i}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",todayCount:a,allTimeCount:i}),s()})})})}async function W(e,o,s,t,n,r,a,i,l){d=!0,console.log("ğŸš€ Starting new commenting flow with parameters:"),c("ğŸš€ Starting new commenting flow with parameters:"),console.log(`   - scrollDuration: ${e}`),console.log(`   - commentDelay: ${o}`),console.log(`   - maxPosts: ${s}`),console.log(`   - isCommentingActive: ${d}`),c(`   - scrollDuration: ${e}, commentDelay: ${o}, maxPosts: ${s}, isCommentingActive: ${d}`),await R(),c("ğŸ­ Applied LinkedIn background tab bypass techniques"),D=await q(),await oe(),await Z(),await he(),await ie(),L=await J(),console.log(`Loaded ${D.size} authors with timestamps and ${L.size} authors for today`),console.log(`Loaded counters - Posts skipped: ${E}, Recent authors: ${A}`),c(`Loaded ${D.size} authors with timestamps and ${L.size} authors for today`),c(`Loaded counters - Posts skipped: ${E}, Recent authors: ${A}`);try{if(console.log(`Starting new commenting flow with max ${s} posts...`),c(`Starting new commenting flow with max ${s} posts...`),console.log(`ğŸ“œ Step 1: Scrolling feed for ${e} seconds...`),c(`ğŸ“œ Step 1: Scrolling feed for ${e} seconds...`),await me(e,l),console.log("ğŸ“œ Step 1.5: Scrolling completed, now moving back to original tab..."),c("ğŸ“œ Step 1.5: Scrolling completed, now moving back to original tab..."),chrome.runtime.sendMessage({action:"moveToOriginalTab"}),await x(2e3),!d){console.log("âŒ Commenting stopped during scroll phase"),c("âŒ Commenting stopped during scroll phase"),P();return}if(console.log("ğŸ“œ Step 2: Scrolling back to top..."),c("ğŸ“œ Step 2: Scrolling back to top..."),window.scrollTo({top:0,behavior:"smooth"}),await x(2e3),r&&a&&i&&(a.textContent="âœ… Posts loaded! You can now move away from this tab",a.style.background="#28a745",a.style.fontSize="20px",i.textContent="All posts have been loaded. Switching to automation mode...",await x(3e3),r.remove(),c("ğŸ“œ ğŸ­ Overlay removed after successful post loading")),!d){console.log("âŒ Commenting stopped during scroll to top"),c("âŒ Commenting stopped during scroll to top"),P();return}console.log("ğŸ“œ Step 3: Processing all posts on feed..."),console.log(`   - maxPosts parameter: ${s}`),console.log(`   - commentDelay parameter: ${o}`),console.log(`   - isCommentingActive before processing: ${d}`),c(`ğŸ“œ Step 3: Processing all posts on feed... maxPosts: ${s}, commentDelay: ${o}, isCommentingActive: ${d}`),await pe(o,s,n),console.log("ğŸ“œ Step 3 completed. Final state:"),console.log(`   - isCommentingActive: ${d}`),c(`ğŸ“œ Step 3 completed. Final isCommentingActive: ${d}`),P(),d?(console.log("ğŸ Sending completion message to background script..."),c("ğŸ Sending completion message to background script..."),chrome.runtime.sendMessage({action:"commentingCompleted"})):(console.log("ğŸ›‘ Not sending completion message because commenting was stopped"),c("ğŸ›‘ Not sending completion message because commenting was stopped"))}catch(m){console.error("ğŸ’¥ Error in new commenting flow:",m),M("ğŸ’¥ Error in new commenting flow:",m),d=!1,P()}}async function ce(){try{return"Notification"in window?Notification.permission==="granted"?(c("ğŸ“œ ğŸ”” Notification permission already granted"),!0):Notification.permission==="denied"?(c("ğŸ“œ ğŸ”” Notification permission previously denied"),!1):await Notification.requestPermission()==="granted"?(c("ğŸ“œ ğŸ”” âœ… Notification permission granted - should help with anti-throttling"),new Notification("EngageKit",{body:"Notification permission granted for better performance",icon:"https://static.licdn.com/sc/h/3m6veb8kxx0k7v4c6u7q6z8hm",silent:!0}),!0):(c("ğŸ“œ ğŸ”” âŒ Notification permission denied"),!1):(c("ğŸ“œ ğŸ”” Notifications not supported in this browser"),!1)}catch(e){return N("ğŸ“œ ğŸ”” âš ï¸ Failed to request notification permission:",e),!1}}async function R(){try{await ce(),Object.defineProperty(document,"hidden",{value:!1,writable:!1}),Object.defineProperty(document,"visibilityState",{value:"visible",writable:!1});const e=document.hasFocus;document.hasFocus=function(){return!0};const o=document.addEventListener;document.addEventListener=function(s,t,n){if(s!=="visibilitychange"&&t!==null)return o.call(this,s,t,n)},c("ğŸ“œ ğŸ­ Applied comprehensive tab active state spoofing")}catch(e){N("ğŸ“œ âš ï¸ Failed to apply tab active state spoofing:",e)}}function le(){try{const e=new Event("visibilitychange",{bubbles:!0});document.dispatchEvent(e);const o=new Event("focus",{bubbles:!0});window.dispatchEvent(o),document.dispatchEvent(o);const s=new PageTransitionEvent("pageshow",{bubbles:!0,persisted:!1});window.dispatchEvent(s);const t=document.querySelector(".scaffold-finite-scroll__load-button");t&&!t.disabled?(t.click(),c("ğŸ“œ ğŸ¯ Clicked LinkedIn infinite scroll load button (.scaffold-finite-scroll__load-button)")):t&&t.disabled?c("ğŸ“œ âš ï¸ Infinite scroll button found but disabled"):c("ğŸ“œ â„¹ï¸ No infinite scroll button found (.scaffold-finite-scroll__load-button)")}catch(e){N("ğŸ“œ âš ï¸ Failed to trigger LinkedIn loading:",e)}}function de(){try{const e=new Event("scroll",{bubbles:!0,cancelable:!0});window.dispatchEvent(e),document.dispatchEvent(e),[".scaffold-layout__main",".feed-container-theme",".scaffold-finite-scroll",".feed-shared-update-v2",".application-outlet",".feed-outlet","#main",'[role="main"]',".ember-application"].forEach(n=>{document.querySelectorAll(n).forEach(a=>{a&&(a.dispatchEvent(e),c(`ğŸ“œ ğŸ¯ Triggered scroll event on: ${n}`))})});const s=new WheelEvent("wheel",{bubbles:!0,cancelable:!0,deltaY:100,deltaMode:WheelEvent.DOM_DELTA_PIXEL});window.dispatchEvent(s);const t=document.querySelector(".scaffold-layout__main, .feed-container-theme");t&&(t.dispatchEvent(s),c("ğŸ“œ ğŸ¯ Triggered wheel event on main LinkedIn container"))}catch(e){N("ğŸ“œ âš ï¸ Failed to trigger scroll events:",e)}}async function me(e,o){console.log(`Aggressively scrolling feed for ${e} seconds to load posts...`),c(`ğŸ“œ Starting aggressive scroll-to-bottom for ${e} seconds...`),await R();const s=Date.now(),t=s+e*1e3;let n=0,r=0,a=0;const i=document.querySelectorAll(".feed-shared-update-v2__control-menu-container");r=i.length,a=r,c(`ğŸ“œ Initial post count: ${r}`);const l=2e3;for(;Date.now()<t&&d;){if(!d){c("âŒ Stopping scroll due to stop signal");break}const p=Date.now(),f=Math.round((t-p)/1e3);if(c(`ğŸ“œ Aggressive scroll attempt ${n+1}, ${f}s remaining`),o){const b=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length,O=b-r,G=o.querySelector("#time-remaining span"),K=o.querySelector("#posts-loaded span"),z=o.querySelector("#scroll-progress span");G&&(G.textContent=`${f}s`),K&&(K.textContent=`${b} posts (+${O} this session)`),z&&(z.textContent=`Scroll attempt ${n+1} - Loading content...`)}n++;const C=window.scrollY,h=document.body.scrollHeight;window.scrollTo({top:h,behavior:"smooth"}),de(),await x(l);const I=window.scrollY,S=document.body.scrollHeight;c(`ğŸ“œ Scrolled from ${C} to ${I}, doc height: ${h} â†’ ${S}`);const v=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length;if(v>a){const b=v-a;if(c(`ğŸ“œ âœ… Content loaded! Found ${b} new posts (total: ${v})`),a=v,o){const O=o.querySelector("#scroll-progress span");O&&(O.textContent=`âœ… Loaded ${b} new posts! (Total: ${v})`)}}else if(c(`ğŸ“œ âš ï¸ No new posts detected. Still at ${v} posts`),o){const b=o.querySelector("#scroll-progress span");b&&(b.textContent=`â³ Waiting for new content... (${v} posts)`)}if(n%3===0&&(await R(),le(),c("ğŸ“œ ğŸ­ Reapplied anti-throttling techniques"),o)){const b=o.querySelector("#scroll-progress span");b&&(b.textContent="ğŸ­ Applied anti-throttling techniques")}S===h&&v===a&&c("ğŸ“œ ğŸ“Š No height or post changes detected - continuing for full duration")}if(o){const f=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length-r,C=o.querySelector("#time-remaining span"),h=o.querySelector("#scroll-progress span");C&&(C.textContent="0s - COMPLETE!"),h&&(h.textContent=`ğŸ‰ Scrolling complete! Loaded ${f} new posts`)}const m=document.querySelectorAll(".feed-shared-update-v2__control-menu-container"),u=m.length-i.length,g=Math.round((Date.now()-s)/1e3);console.log("Finished aggressive scrolling to load posts"),c(`ğŸ“œ Aggressive scroll completed! Duration: ${g}s, Scroll attempts: ${n}, New posts loaded: ${u} (${i.length} â†’ ${m.length})`),u<15&&g>15?N(`ğŸ“œ âš ï¸ Only loaded ${u} posts in ${g}s. LinkedIn might be throttling or has limited content.`):u>=20&&c(`ğŸ“œ ğŸ‰ Excellent! Loaded ${u} posts using aggressive scrolling.`)}async function pe(e,o,s){console.group("ğŸ¯ PROCESSING ALL POSTS - DETAILED DEBUG"),j("ğŸ¯ PROCESSING ALL POSTS - DETAILED DEBUG"),console.log(`ğŸ¯ Starting to process posts on feed (max ${o} posts)...`),c(`ğŸ¯ Starting to process posts on feed (max ${o} posts)...`);const t=document.querySelectorAll("div[data-id]");console.log(`ğŸ¯ Found ${t.length} post containers with selector: div[data-id]`),c(`ğŸ¯ Found ${t.length} post containers with selector: div[data-id]`);const n=document.querySelectorAll(".feed-shared-update-v2"),r=document.querySelectorAll('[data-urn*="urn:li:activity"]'),a=document.querySelectorAll(".feed-shared-update-v2__content");if(console.log("ğŸ¯ Alternative selector results:"),console.log(`   - .feed-shared-update-v2: ${n.length} elements`),console.log(`   - [data-urn*="urn:li:activity"]: ${r.length} elements`),console.log(`   - .feed-shared-update-v2__content: ${a.length} elements`),c(`ğŸ¯ Alternative selector results: .feed-shared-update-v2: ${n.length}, [data-urn*="urn:li:activity"]: ${r.length}, .feed-shared-update-v2__content: ${a.length}`),t.length===0){console.error("ğŸš¨ NO POSTS FOUND! This is why the automation stops immediately."),console.error("ğŸš¨ The page might not be fully loaded or the selector is wrong."),M("ğŸš¨ NO POSTS FOUND! This is why the automation stops immediately."),M("ğŸš¨ The page might not be fully loaded or the selector is wrong."),console.groupEnd(),B();return}let i=0;console.log(`ğŸ¯ Starting loop: commentCount=${i}, maxPosts=${o}, isActive=${d}`),c(`ğŸ¯ Starting loop: commentCount=${i}, maxPosts=${o}, isActive=${d}`);for(let l=0;l<t.length&&d&&i<o;l++){if(console.group(`ğŸ”„ POST ${l+1}/${t.length} - DETAILED PROCESSING`),console.log(`ğŸ”„ Loop iteration ${l+1}:`),console.log(`   - commentCount: ${i}/${o}`),console.log(`   - isCommentingActive: ${d}`),console.log(`   - Loop condition: i(${l}) < postContainers.length(${t.length}) = ${l<t.length}`),console.log(`   - Active condition: isCommentingActive = ${d}`),console.log(`   - Count condition: commentCount(${i}) < maxPosts(${o}) = ${i<o}`),console.log(`   - Overall loop should continue: ${l<t.length&&d&&i<o}`),!d){console.log("âŒ STOPPING: isCommentingActive became false"),console.groupEnd();break}const m=t[l];try{if(console.log(`ğŸ” Processing post ${l+1}/${t.length} (commented: ${i}/${o})`),m.scrollIntoView({behavior:"smooth",block:"center"}),await x(1e3),!d){console.log("âŒ STOPPING: isCommentingActive became false after scroll"),console.groupEnd();break}const u=se(m);if(u.length===0){console.log(`â­ï¸ SKIPPING post ${l+1} - could not extract post URNs`),console.groupEnd();continue}let g=!1;for(const S of u)if(ne(S)){console.log(`â­ï¸ SKIPPING post ${l+1} - already commented on post URN: ${S}`),g=!0;break}if(g){await re(),console.groupEnd();continue}const p=ue(m);if(!p){console.log(`â­ï¸ SKIPPING post ${l+1} - could not extract author info`),console.groupEnd();continue}if(X(p.name,D,s)){console.log(`â­ï¸ SKIPPING post ${l+1} - already commented on ${p.name} within ${s} hours`),await ee(),console.groupEnd();continue}const f=ge(m);if(!f){console.log(`â­ï¸ SKIPPING post ${l+1} - could not extract post content`),console.groupEnd();continue}const C=p.name+f;if(console.log(`ğŸ“ Post content preview: ${f.substring(0,100)}...`),!d){console.log("âŒ STOPPING: isCommentingActive became false before comment generation"),console.groupEnd();break}console.log(`ğŸ¤– Generating comment for post ${l+1}...`);const h=await fe(C);if(console.log(`ğŸ¤– Comment generation result for post ${l+1}:`,h?"SUCCESS":"FAILED"),!h){console.log(`âŒ SKIPPING post ${l+1} - could not generate comment`),console.groupEnd();continue}if(console.log(`âœ… Generated comment for post ${l+1}:`,h.substring(0,50)+"..."),!d){console.log("âŒ STOPPING: isCommentingActive became false before posting comment"),console.groupEnd();break}console.log(`ğŸ“ Attempting to post comment on post ${l+1} by ${p.name}...`);const I=await postCommentOnPost(m,h,d);if(console.log(`ğŸ“ Comment posting result for post ${l+1}: ${I?"SUCCESS":"FAILED"}`),I){i++,L.add(p.name),await Q(p.name),await V(p.name),D.set(p.name,Date.now());for(const S of u)await te(S);if(await ae(),console.log(`ğŸ‰ Successfully posted comment ${i}/${o} on post by ${p.name}`),c(`ğŸ‰ Successfully posted comment ${i}/${o} on post by ${p.name}`),console.group("ğŸ“Š Progress Update After Successful Comment"),console.log(`Comments posted this session: ${i}/${o}`),console.log("Authors commented on today:",Array.from(L)),console.log(`Remaining posts to process: ${t.length-l-1}`),console.log(`Should continue? commentCount(${i}) < maxPosts(${o}) = ${i<o}`),console.log(`Next iteration will be: ${l+1} < ${t.length} = ${l+1<t.length}`),c(`ğŸ“Š Progress Update: ${i}/${o} comments posted. Remaining posts: ${t.length-l-1}. Should continue: ${i<o}`),console.groupEnd(),chrome.runtime.sendMessage({action:"updateCommentCount",count:i,status:`Posted comment ${i}/${o} on post by ${p.name}`}),i>=o){console.log(`âœ… REACHED MAX POSTS LIMIT: commentCount(${i}) >= maxPosts(${o}). Stopping...`),c(`âœ… REACHED MAX POSTS LIMIT: commentCount(${i}) >= maxPosts(${o}). Stopping...`),console.groupEnd();break}if(l<t.length-1&&i<o){console.log(`â³ Waiting ${e} seconds before next comment...`),console.log(`â³ Delay conditions: i(${l}) < postContainers.length-1(${t.length-1}) = ${l<t.length-1}`),console.log(`â³ Delay conditions: commentCount(${i}) < maxPosts(${o}) = ${i<o}`);const S=Math.ceil(e);for(let F=0;F<S&&d;F++)if(await x(1e3),!d){console.log("âŒ STOPPING during comment delay due to stop signal"),console.groupEnd();break}if(!d){console.groupEnd();break}console.log("âœ… Delay completed, continuing to next post...")}else console.log("ğŸ”š No delay needed - this was the last post or we've reached max comments"),console.log(`   - i(${l}) < postContainers.length-1(${t.length-1}): ${l<t.length-1}`),console.log(`   - commentCount(${i}) < maxPosts(${o}): ${i<o}`)}else console.log(`âŒ Failed to post comment on post ${l+1} by ${p.name}`);console.groupEnd()}catch(u){console.error(`ğŸ’¥ Error processing post ${l+1}:`,u),console.groupEnd()}console.log(`ğŸ”„ End of iteration ${l+1}. Next iteration check:`),console.log(`   - Next i will be: ${l+1}`),console.log(`   - postContainers.length: ${t.length}`),console.log(`   - isCommentingActive: ${d}`),console.log(`   - commentCount: ${i}`),console.log(`   - maxPosts: ${o}`),console.log(`   - Loop will continue: ${l+1<t.length&&d&&i<o}`)}console.log("ğŸ LOOP COMPLETED. Final stats:"),console.log(`   - Posted ${i}/${o} comments total`),console.log(`   - Final isCommentingActive: ${d}`),console.log(`   - Processed ${t.length} total posts`),console.log("   - Loop exit reason analysis:"),console.log(`     - Reached max posts? ${i>=o}`),console.log(`     - Lost active status? ${!d}`),console.log(`     - Ran out of posts? ${t.length===0}`),c(`ğŸ LOOP COMPLETED. Final stats: Posted ${i}/${o} comments total. Final isCommentingActive: ${d}. Processed ${t.length} total posts.`),c(`ğŸ Loop exit reason: Reached max posts? ${i>=o}, Lost active status? ${!d}, Ran out of posts? ${t.length===0}`),console.groupEnd(),B()}function ue(e){try{const o=e.querySelector(".update-components-actor__container");if(!o)return console.log("Author container not found"),null;const s=['.update-components-actor__title span[dir="ltr"] span[aria-hidden="true"]','.update-components-actor__title span[aria-hidden="true"]',".update-components-actor__title",".update-components-actor__name"];for(const t of s){const n=o.querySelector(t);if(n&&n.textContent){const r=n.textContent.replace(/<!---->/g,"").trim().split("â€¢")[0].trim();if(r)return console.log(`Extracted author name: ${r}`),{name:r}}}return console.log("Could not extract author name"),null}catch(o){return console.error("Error extracting author info:",o),null}}function ge(e){try{let o=function(n){let r="";return n.childNodes.forEach(a=>{var i;a.nodeType===Node.TEXT_NODE?r+=((i=a.textContent)==null?void 0:i.trim())+" ":a.nodeType===Node.ELEMENT_NODE&&(r+=o(a))}),r};const s=e.querySelector(".feed-shared-inline-show-more-text");if(!s)return console.log("Content container not found"),"";const t=o(s).replace(/\s+/g," ").trim();return console.log(`Extracted post content: ${t.substring(0,100)}...`),t}catch(o){return console.error("Error extracting post content:",o),""}}async function fe(e){return new Promise(o=>{console.log("ğŸ¤– Requesting comment generation for post content:",e.substring(0,200)+"...");const s=setTimeout(()=>{console.error("â° FALLBACK REASON: Comment generation timed out after 30 seconds"),console.error("â° TIMEOUT - No response from background script within 30 seconds"),o("Great post! Thanks for sharing.")},3e4),t=(n=1)=>{console.log(`ğŸ”„ Attempt ${n}/3: Sending comment generation request...`),chrome.runtime.sendMessage({action:"generateComment",postContent:e},r=>{var a;if(clearTimeout(s),chrome.runtime.lastError){if(console.error(`ğŸ’¥ ATTEMPT ${n} FAILED - Chrome runtime error:`,chrome.runtime.lastError),(a=chrome.runtime.lastError.message)!=null&&a.includes("Could not establish connection")&&n<3){console.log(`ğŸ”„ Connection error detected, retrying in 2 seconds... (attempt ${n+1}/3)`),setTimeout(()=>{t(n+1)},2e3);return}console.error("ğŸ’¥ FALLBACK REASON: Chrome runtime error during comment generation"),console.error("ğŸ’¥ CHROME ERROR:",chrome.runtime.lastError),console.error("ğŸ’¥ This usually means the background script crashed or message passing failed"),o("Great post! Thanks for sharing.")}else if(r)r.comment?r.comment==="Great post! Thanks for sharing."?(console.error("ğŸš¨ FALLBACK REASON: Background script returned the default fallback comment"),console.error("ğŸš¨ This means the AI API failed and background script used fallback"),r.error?(console.group("ğŸ”¥ AI API ERROR DETAILS FROM RESPONSE"),console.error("ğŸ”¥ Error Message:",r.error.message),console.error("ğŸ”¥ Error Type:",r.error.name),console.error("ğŸ”¥ API Key Status:",r.error.apiKey),console.error("ğŸ”¥ Style Guide Status:",r.error.styleGuide),console.error("ğŸ”¥ Post Content Length:",r.error.postContentLength,"characters"),r.error.stack&&console.error("ğŸ”¥ Stack Trace:",r.error.stack),console.groupEnd()):console.error("ğŸš¨ No error details provided - check background script console"),o(r.comment)):(console.log("âœ… Successfully received generated comment:",r.comment.substring(0,100)+"..."),o(r.comment)):(console.error("âš ï¸ FALLBACK REASON: Response received but no comment field"),console.error("âš ï¸ INVALID RESPONSE STRUCTURE:",r),console.error("âš ï¸ Expected response.comment but got:",Object.keys(r)),o("Great post! Thanks for sharing."));else{if(console.error(`âŒ ATTEMPT ${n} FAILED - No response received from background script`),n<3){console.log(`ğŸ”„ No response received, retrying in 2 seconds... (attempt ${n+1}/3)`),setTimeout(()=>{t(n+1)},2e3);return}console.error("âŒ FALLBACK REASON: No response received from background script after 3 attempts"),console.error("âŒ RESPONSE NULL - Background script may have failed silently"),o("Great post! Thanks for sharing.")}})};t(1)})}function P(){try{console.log("ğŸ”‡ Stopping continuous audio..."),_&&(_.stop(),_=null),w&&(w.pause(),w.remove(),w=null),y&&y.state!=="closed"&&(y.close(),y=null),console.log("ğŸ”‡ Continuous audio stopped")}catch(e){console.warn("âš ï¸ Error stopping audio:",e)}}async function he(){const e="commented_authors_timestamps",s=Date.now();return new Promise(t=>{chrome.storage.local.get([e],n=>{const r=n[e]||{},a={};let i=0;for(const[l,m]of Object.entries(r))typeof m=="number"&&s-m<6048e5?a[l]=m:i++;i>0?chrome.storage.local.set({[e]:a},()=>{console.log(`Cleaned up ${i} old timestamp entries`),t()}):t()})})}console.log("EngageKit content script loaded - Background Window Mode");
//# sourceMappingURL=index.tsx-Co1qbjXM.js.map
})()
