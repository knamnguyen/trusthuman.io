(function(){function C(o){return new Promise(e=>setTimeout(e,o))}const d=(...o)=>{console.log(...o),chrome.runtime.sendMessage({action:"backgroundLog",level:"log",args:o}).catch(()=>{})},I=(...o)=>{console.error(...o),chrome.runtime.sendMessage({action:"backgroundLog",level:"error",args:o}).catch(()=>{})},F=(...o)=>{console.group(...o),chrome.runtime.sendMessage({action:"backgroundLog",level:"group",args:o}).catch(()=>{})},M=()=>{console.groupEnd(),chrome.runtime.sendMessage({action:"backgroundLog",level:"groupEnd",args:[]}).catch(()=>{})};async function U(o){const r=Date.now();return new Promise(t=>{let n=0;const s=new Map;for(const[c,l]of o)r-l<31536e6?s.set(c,l):n++;if(n>0){o=s;const c=Object.fromEntries(o);chrome.storage.local.set({commented_post_urns:c},()=>{console.log(`Cleaned up ${n} old post URNs (older than 1 year)`),t()})}else console.log("No old post URNs to clean up"),t()})}async function G(){const o="commented_authors_timestamps",r=Date.now();return new Promise(t=>{chrome.storage.local.get([o],n=>{const s=n[o]||{},c={};let l=0;for(const[i,m]of Object.entries(s))typeof m=="number"&&r-m<6048e5?c[i]=m:l++;l>0?chrome.storage.local.set({[o]:c},()=>{console.log(`Cleaned up ${l} old timestamp entries`),t()}):t()})})}function K(o){try{const e=o.querySelector(".update-components-actor__container");if(!e)return console.log("Author container not found"),null;const r=['.update-components-actor__title span[dir="ltr"] span[aria-hidden="true"]','.update-components-actor__title span[aria-hidden="true"]',".update-components-actor__title",".update-components-actor__name"];for(const t of r){const n=e.querySelector(t);if(n&&n.textContent){const s=n.textContent.replace(/<!---->/g,"").trim().split("â€¢")[0].trim();if(s)return console.log(`Extracted author name: ${s}`),{name:s}}}return console.log("Could not extract author name"),null}catch(e){return console.error("Error extracting author info:",e),null}}function B(o){try{let e=function(n){let s="";return n.childNodes.forEach(c=>{var l;c.nodeType===Node.TEXT_NODE?s+=((l=c.textContent)==null?void 0:l.trim())+" ":c.nodeType===Node.ELEMENT_NODE&&(s+=e(c))}),s};const r=o.querySelector(".feed-shared-inline-show-more-text");if(!r)return console.log("Content container not found"),"";const t=e(r).replace(/\s+/g," ").trim();return console.log(`Extracted post content: ${t.substring(0,100)}...`),t}catch(e){return console.error("Error extracting post content:",e),""}}async function z(o){return new Promise(e=>{console.log("ğŸ¤– Requesting comment generation for post content:",o.substring(0,200)+"...");const r=setTimeout(()=>{console.error("â° FALLBACK REASON: Comment generation timed out after 30 seconds"),console.error("â° TIMEOUT - No response from background script within 30 seconds"),e("Great post! Thanks for sharing.")},3e4),t=(n=1)=>{console.log(`ğŸ”„ Attempt ${n}/3: Sending comment generation request...`),chrome.runtime.sendMessage({action:"generateComment",postContent:o},s=>{var c;if(clearTimeout(r),chrome.runtime.lastError){if(console.error(`ğŸ’¥ ATTEMPT ${n} FAILED - Chrome runtime error:`,chrome.runtime.lastError),(c=chrome.runtime.lastError.message)!=null&&c.includes("Could not establish connection")&&n<3){console.log(`ğŸ”„ Connection error detected, retrying in 2 seconds... (attempt ${n+1}/3)`),setTimeout(()=>{t(n+1)},2e3);return}console.error("ğŸ’¥ FALLBACK REASON: Chrome runtime error during comment generation"),console.error("ğŸ’¥ CHROME ERROR:",chrome.runtime.lastError),console.error("ğŸ’¥ This usually means the background script crashed or message passing failed"),e("Great post! Thanks for sharing.")}else if(s)s.comment?s.comment==="Great post! Thanks for sharing."?(console.error("ğŸš¨ FALLBACK REASON: Background script returned the default fallback comment"),console.error("ğŸš¨ This means the AI API failed and background script used fallback"),s.error?(console.group("ğŸ”¥ AI API ERROR DETAILS FROM RESPONSE"),console.error("ğŸ”¥ Error Message:",s.error.message),console.error("ğŸ”¥ Error Type:",s.error.name),console.error("ğŸ”¥ API Key Status:",s.error.apiKey),console.error("ğŸ”¥ Style Guide Status:",s.error.styleGuide),console.error("ğŸ”¥ Post Content Length:",s.error.postContentLength,"characters"),s.error.stack&&console.error("ğŸ”¥ Stack Trace:",s.error.stack),console.groupEnd()):console.error("ğŸš¨ No error details provided - check background script console"),e(s.comment)):(console.log("âœ… Successfully received generated comment:",s.comment.substring(0,100)+"..."),e(s.comment)):(console.error("âš ï¸ FALLBACK REASON: Response received but no comment field"),console.error("âš ï¸ INVALID RESPONSE STRUCTURE:",s),console.error("âš ï¸ Expected response.comment but got:",Object.keys(s)),e("Great post! Thanks for sharing."));else{if(console.error(`âŒ ATTEMPT ${n} FAILED - No response received from background script`),n<3){console.log(`ğŸ”„ No response received, retrying in 2 seconds... (attempt ${n+1}/3)`),setTimeout(()=>{t(n+1)},2e3);return}console.error("âŒ FALLBACK REASON: No response received from background script after 3 attempts"),console.error("âŒ RESPONSE NULL - Background script may have failed silently"),e("Great post! Thanks for sharing.")}})};t(1)})}async function W(o,e,r){try{if(console.group("ğŸ“ Comment Posting Process"),console.log("Starting to post comment:",e.substring(0,100)+"..."),!r)return console.log("âŒ Stopping comment posting due to stop signal"),console.groupEnd(),!1;console.log("ğŸ” Looking for comment button...");const t=o.querySelector('button[aria-label="Comment"]');if(!t)return console.error("âŒ Comment button not found"),console.groupEnd(),!1;if(console.log("ğŸ‘† Clicking comment button..."),t.click(),console.log("â³ Waiting for comment editor to appear..."),await C(2e3),!r)return console.log("âŒ Stopping during comment editor wait due to stop signal"),console.groupEnd(),!1;console.log("ğŸ” Looking for comment editor...");const n=o.querySelector(".comments-comment-box-comment__text-editor");if(!n)return console.error("âŒ Comment editor not found"),console.groupEnd(),!1;console.log("ğŸ” Looking for editable field...");const s=n.querySelector('div[contenteditable="true"]');if(!s)return console.error("âŒ Editable field not found"),console.groupEnd(),!1;if(console.log("âœ… Found editable field, inputting comment..."),!r)return console.log("âŒ Stopping during comment input due to stop signal"),console.groupEnd(),!1;s.focus(),s.click(),s.innerHTML="",e.split(`
`).forEach(p=>{const g=document.createElement("p");p===""?g.appendChild(document.createElement("br")):g.textContent=p,s.appendChild(g)});const l=window.getSelection();if(l){const p=document.createRange();s.lastChild?p.setStartAfter(s.lastChild):p.selectNodeContents(s),p.collapse(!0),l.removeAllRanges(),l.addRange(p)}s.focus();const i=new Event("input",{bubbles:!0,cancelable:!0});if(s.dispatchEvent(i),console.log("âœ… Comment text inputted successfully"),console.log("â³ Waiting for submit button to become enabled..."),await C(1e3),!r)return console.log("âŒ Stopping during submit button wait due to stop signal"),console.groupEnd(),!1;console.log("ğŸ” Looking for submit button...");const m=o.querySelector(".comments-comment-box__submit-button--cr");return!m||m.disabled?(console.error("âŒ Submit button not found or disabled"),console.groupEnd(),!1):(console.log("ğŸš€ Clicking submit button..."),m.click(),console.log("â³ Waiting for comment to be posted..."),await C(2e3),console.log("ğŸ‰ Comment posted successfully"),console.groupEnd(),!0)}catch(t){return console.error("ğŸ’¥ Error posting comment:",t),console.groupEnd(),!1}}function H(){try{const o=new Event("scroll",{bubbles:!0,cancelable:!0});window.dispatchEvent(o),document.dispatchEvent(o),[".scaffold-layout__main",".feed-container-theme",".scaffold-finite-scroll",".feed-shared-update-v2",".application-outlet",".feed-outlet","#main",'[role="main"]',".ember-application"].forEach(n=>{document.querySelectorAll(n).forEach(c=>{c&&(c.dispatchEvent(o),console.log(`Triggered scroll event on: ${n}`))})});const r=new WheelEvent("wheel",{bubbles:!0,cancelable:!0,deltaY:100,deltaMode:WheelEvent.DOM_DELTA_PIXEL});window.dispatchEvent(r);const t=document.querySelector(".scaffold-layout__main, .feed-container-theme");t&&(t.dispatchEvent(r),console.log("Triggered wheel event on main LinkedIn container"))}catch(o){console.error("Failed to trigger scroll events:",o)}}async function j(o,e,r){console.log(`Aggressively scrolling feed for ${o} seconds to load posts...`);const n=Date.now()+o*1e3;let s=0,c=0,l=0;const i=document.querySelectorAll(".feed-shared-update-v2__control-menu-container");c=i.length,l=c;const m=2e3;for(;Date.now()<n&&e&&e;){const g=Date.now(),u=Math.round((n-g)/1e3);if(r){const $=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length,w=$-c,k=r.querySelector("#time-remaining span"),N=r.querySelector("#posts-loaded span"),_=r.querySelector("#scroll-progress span");k&&(k.textContent=`${u}s`),N&&(N.textContent=`${$} posts (+${w} this session)`),_&&(_.textContent=`Scroll attempt ${s+1} - Loading content...`)}s++;const f=document.body.scrollHeight;window.scrollTo({top:f,behavior:"smooth"}),H(),await C(m),document.body.scrollHeight;const h=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length;if(h>l){const $=h-l;if(l=h,r){const w=r.querySelector("#scroll-progress span");w&&(w.textContent=`âœ… Loaded ${$} new posts! (Total: ${h})`)}}else if(r){const $=r.querySelector("#scroll-progress span");$&&($.textContent=`â³ Waiting for new content... (${h} posts)`)}}if(r){const u=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length-c,f=r.querySelector("#time-remaining span"),A=r.querySelector("#scroll-progress span");f&&(f.textContent="0s - COMPLETE!"),A&&(A.textContent=`ğŸ‰ Scrolling complete! Loaded ${u} new posts`)}document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length-i.length,console.log("Finished aggressive scrolling to load posts")}async function Y(){const e=`comments_today_${new Date().toDateString()}`;return new Promise(r=>{chrome.storage.local.get([e,"totalAllTimeComments"],t=>{const n=t[e]||0,s=t.totalAllTimeComments||0,c=n+1,l=s+1;chrome.storage.local.set({[e]:c,totalAllTimeComments:l},()=>{console.log(`Updated counts - Today: ${c}, All-time: ${l}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",todayCount:c,allTimeCount:l}),r()})})})}let a=!1,L=new Set,D=new Map,E=0,v=0,T=new Map,x=0,S=0,y=null,O=null,b=null;document.readyState!=="loading"?(console.log("document is already ready, just execute code here"),chrome.runtime.sendMessage({action:"pageReady"})):document.addEventListener("DOMContentLoaded",function(){console.log("document was not ready, place code here"),chrome.runtime.sendMessage({action:"pageReady"})});function q(){if(console.log("ğŸš€ Showing start button for EngageKit..."),document.getElementById("linkedin-start-overlay"))return;const o=document.createElement("div");o.id="linkedin-start-overlay",o.style.cssText=`
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0, 115, 177, 0.95) !important;
    z-index: 2147483647 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    align-items: center !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
    color: white !important;
  `;const e=document.createElement("div");e.style.cssText=`
    text-align: center !important;
    max-width: 600px !important;
    padding: 40px !important;
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 20px !important;
    backdrop-filter: blur(10px) !important;
  `;const r=document.createElement("h1");r.textContent="EngageKit",r.style.cssText=`
    font-size: 48px !important;
    margin: 0 0 20px 0 !important;
    text-align: center !important;
    font-weight: bold !important;
    color: white !important;
  `;const t=document.createElement("p");t.textContent="Click to start auto-commenting on LinkedIn posts",t.style.cssText=`
    font-size: 20px !important;
    margin: 0 0 40px 0 !important;
    text-align: center !important;
    opacity: 0.9 !important;
    color: white !important;
  `;const n=document.createElement("button");n.textContent="ğŸš€ Start Auto-Commenting",n.style.cssText=`
    background: #ffffff !important;
    color: #0073b1 !important;
    border: none !important;
    padding: 20px 40px !important;
    font-size: 24px !important;
    font-weight: bold !important;
    border-radius: 12px !important;
    cursor: pointer !important;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
    transition: all 0.3s ease !important;
    margin: 0 0 20px 0 !important;
    font-family: inherit !important;
  `,n.addEventListener("mouseenter",()=>{n.style.transform="translateY(-2px)",n.style.boxShadow="0 12px 20px rgba(0,0,0,0.3)"}),n.addEventListener("mouseleave",()=>{n.style.transform="translateY(0)",n.style.boxShadow="0 8px 16px rgba(0,0,0,0.2)"});const s=document.createElement("p");s.innerHTML=`
    <strong>What will happen:</strong><br>
    â€¢ Audio will start playing to keep this tab active<br>
    â€¢ This window will move to the background<br>
    â€¢ Auto-commenting will begin immediately<br>
    â€¢ You can continue using other applications
  `,s.style.cssText=`
    font-size: 16px !important;
    text-align: center !important;
    opacity: 0.8 !important;
    line-height: 1.6 !important;
    max-width: 500px !important;
    margin: 0 !important;
    color: white !important;
  `,n.addEventListener("click",async()=>{console.log("ğŸš€ Start button clicked! Beginning full flow..."),n.textContent="ğŸ”„ Starting...",n.style.background="#28a745",n.style.color="white",n.disabled=!0;try{console.log("ğŸµ Step 1: Starting continuous audio..."),await V(),n.textContent="ğŸµ Audio Started",await C(1e3),n.textContent="ğŸ’¬ Starting flow",chrome.storage.local.get(["scrollDuration","commentDelay","maxPosts","duplicateWindow","styleGuide","apiKey"],c=>{d("Content: Retrieved settings from storage:",c);const l=c.scrollDuration!==void 0?c.scrollDuration:10,i=c.commentDelay!==void 0?c.commentDelay:5,m=c.maxPosts!==void 0?c.maxPosts:5,p=c.duplicateWindow!==void 0?c.duplicateWindow:24,g=c.styleGuide!==void 0?c.styleGuide:"Be engaging and professional",u=c.apiKey!==void 0?c.apiKey:"";if(d("ğŸ¯ Starting commenting flow with settings:",{scrollDuration:l,commentDelay:i,maxPosts:m,styleGuide:(g==null?void 0:g.substring(0,50))+"...",hasApiKey:!!u}),!g){I("âŒ No style guide found in storage! Cannot start commenting.");return}n.textContent=`ğŸ“œ Scrolling to load posts (${l}s) - DON'T navigate away!`,n.style.background="#ff9500",n.style.fontSize="18px",t.textContent="Loading posts from LinkedIn feed - please keep this tab visible";const f=document.createElement("div");f.id="linkedin-status-panel",f.style.cssText=`
          background: rgba(255, 255, 255, 0.15) !important;
          border-radius: 12px !important;
          padding: 20px !important;
          margin-top: 20px !important;
          border: 1px solid rgba(255, 255, 255, 0.3) !important;
          font-family: monospace !important;
          font-size: 14px !important;
          line-height: 1.6 !important;
        `;const A=document.querySelectorAll(".feed-shared-update-v2__control-menu-container").length;f.innerHTML=`
          <div style="color: white !important; margin-bottom: 12px !important;">
            <strong>ğŸ“Š AUTOMATION SETTINGS</strong>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 8px !important;">
            ğŸ“œ Scroll Duration: <span style="color: #90EE90 !important;">${l} seconds</span>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 8px !important;">
            â±ï¸ Comment Delay: <span style="color: #90EE90 !important;">${i} seconds</span>
          </div>
          <div style="color: #e0e0e0 !important; margin-bottom: 16px !important;">
            ğŸ¯ Max Posts: <span style="color: #90EE90 !important;">${m} posts</span>
          </div>
          
          <div style="color: white !important; margin-bottom: 12px !important;">
            <strong>ğŸ“ˆ REAL-TIME STATUS</strong>
          </div>
          <div id="time-remaining" style="color: #FFD700 !important; margin-bottom: 8px !important;">
            â° Time Remaining: <span style="color: #FFA500 !important;">${l}s</span>
          </div>
          <div id="posts-loaded" style="color: #87CEEB !important; margin-bottom: 8px !important;">
            ğŸ“ Posts Loaded: <span style="color: #00BFFF !important;">${A} posts</span>
          </div>
          <div id="scroll-progress" style="color: #DDA0DD !important;">
            ğŸ”„ Status: <span style="color: #DA70D6 !important;">Starting scroll...</span>
          </div>
        `;const h=o.querySelector("div");h&&h.appendChild(f),R(l,i,m,g,p,o,n,t,f)}),console.log("âœ… Full flow started successfully!")}catch(c){console.error("âŒ Failed to start:",c),n.textContent="âŒ Failed - Try Again",n.style.background="#dc3545",n.disabled=!1,t.textContent="Something went wrong - click to try again"}}),e.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(s),o.appendChild(e),document.body.appendChild(o),console.log("ğŸš€ Start button overlay displayed")}async function V(){return new Promise((o,e)=>{try{console.log("ğŸµ Initializing Web Audio API for continuous sound...");const r=window.AudioContext||window.webkitAudioContext;if(!r)throw new Error("Web Audio API is not supported in this browser. Cannot play audio.");y=new r;const t=y.createOscillator(),n=y.createGain(),s=y.createMediaStreamDestination();t.connect(n),n.connect(s),t.type="sine";const c=261.63,l=523.25,i=1e4;t.frequency.setValueAtTime(i,y.currentTime),n.gain.setValueAtTime(.001,y.currentTime),b=document.createElement("audio"),b.srcObject=s.stream,b.autoplay=!0,b.loop=!0,b.controls=!1,b.style.cssText="position: fixed; top: -9999px; opacity: 0;",document.body.appendChild(b),(async()=>{y.state==="suspended"&&await y.resume(),t.start(),O=t;const p=b.play();p!==void 0?p.then(()=>{console.log(`âœ… Playing a ${t.type} wave at ${i.toFixed(2)} Hz. Audio element injected and playing.`),o()}).catch(g=>{console.warn("âŒ Autoplay was prevented by the browser:",g),e(g)}):(console.log("âœ… Audio started successfully (no promise returned)"),o())})()}catch(r){console.error("âŒ Audio setup failed:",r),e(r)}})}chrome.runtime.onMessage.addListener((o,e,r)=>{if(console.log("Content script received message:",o),o.action==="showStartButton")console.log("ğŸ“± Popup requested to show start button"),q(),r({success:!0});else if(o.action==="startNewCommentingFlow")R(o.scrollDuration,o.commentDelay,o.maxPosts,o.styleGuide,o.apiKey,o.duplicateWindow||24,null,null,null),r({success:!0});else if(o.action==="stopCommentingFlow")console.log("Received stop signal - stopping commenting flow"),a=!1,P(),r({success:!0});else if(o.action==="statusUpdate"&&o.error){console.group("ğŸš¨ EngageKit Error Details"),console.error("Error Message:",o.error.message),o.error.status&&console.error("HTTP Status:",o.error.status,"-",o.error.statusText),o.error.body&&console.error("API Response Body:",o.error.body),o.error.headers&&console.error("Response Headers:",o.error.headers),console.error("API Key Status:",o.error.apiKey||"Unknown"),console.error("Style Guide Status:",o.error.styleGuide||"Unknown"),o.error.postContentLength!==void 0&&console.error("Post Content Length:",o.error.postContentLength,"characters"),o.error.stack&&console.error("Stack Trace:",o.error.stack),o.error.data&&console.error("Additional Data:",o.error.data),console.groupEnd();const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fee;
      border: 2px solid #f00;
      padding: 15px;
      border-radius: 8px;
      z-index: 10000;
      max-width: 400px;
      font-family: Arial, sans-serif;
      font-size: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,t.innerHTML=`
      <div style="font-weight: bold; color: #d00; margin-bottom: 8px;">
        ğŸš¨ EngageKit Error
      </div>
      <div style="color: #800; margin-bottom: 5px;">
        ${o.error.message||"Unknown error occurred"}
      </div>
      ${o.error.status?`<div style="color: #600; font-size: 11px;">HTTP ${o.error.status}: ${o.error.statusText}</div>`:""}
      <div style="color: #600; font-size: 11px; margin-top: 5px;">
        Check console for full details (F12)
      </div>
      <button onclick="this.parentElement.remove()" style="
        background: #d00;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 10px;
        margin-top: 8px;
      ">Close</button>
    `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},1e4)}});async function X(){const o="commented_authors_timestamps";return new Promise(e=>{chrome.storage.local.get([o],r=>{const t=r[o]||{};e(new Map(Object.entries(t).map(([n,s])=>[n,Number(s)])))})})}async function J(o){const e="commented_authors_timestamps",r=Date.now();return new Promise(t=>{chrome.storage.local.get([e],n=>{const s=n[e]||{};s[o]=r,chrome.storage.local.set({[e]:s},()=>{console.log(`Saved commented author: ${o} at timestamp: ${r}`),t()})})})}function Q(o,e,r){const t=e.get(o);if(!t)return!1;const n=Date.now(),s=r*60*60*1e3;return n-t<s}async function Z(){const e=`commented_authors_${new Date().toDateString()}`;return new Promise(r=>{chrome.storage.local.get([e],t=>{const n=t[e]||[];r(new Set(n))})})}async function oo(o){const e=new Date().toDateString(),r=`commented_authors_${e}`;return new Promise(t=>{chrome.storage.local.get([r],n=>{const s=n[r]||[];s.includes(o)?t():(s.push(o),chrome.storage.local.set({[r]:s},()=>{console.log(`Saved commented author: ${o} for ${e}`),t()}))})})}async function eo(){return new Promise(o=>{chrome.storage.local.get(["postsSkippedDuplicate","recentAuthorsDetected","postsSkippedAlreadyCommented","duplicatePostsDetected"],e=>{E=e.postsSkippedDuplicate||0,v=e.recentAuthorsDetected||0,x=e.postsSkippedAlreadyCommented||0,S=e.duplicatePostsDetected||0,console.log(`Loaded counters - Posts skipped: ${E}, Recent authors: ${v}, Posts already commented: ${x}, Duplicate posts detected: ${S}`),o()})})}async function to(){return E++,v++,S++,new Promise(o=>{chrome.storage.local.set({postsSkippedDuplicate:E,recentAuthorsDetected:v,duplicatePostsDetected:S},()=>{console.log(`Updated counters - Posts skipped: ${E}, Recent authors: ${v}, Duplicate posts detected: ${S}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",skippedCount:E,recentAuthorsCount:v,duplicatePostsDetectedCount:S}),o()})})}async function no(){return new Promise(o=>{chrome.storage.local.get(["commented_post_urns"],e=>{const r=e.commented_post_urns||{};T=new Map(Object.entries(r).map(([t,n])=>[t,Number(n)])),console.log(`Loaded ${T.size} commented post URNs from storage`),o()})})}async function ro(o){const e=Date.now();return T.set(o,e),new Promise(r=>{const t=Object.fromEntries(T);chrome.storage.local.set({commented_post_urns:t},()=>{console.log(`Saved commented post URN: ${o} at timestamp: ${e}`),r()})})}function so(o){return T.has(o)}async function lo(){return x++,S++,new Promise(o=>{chrome.storage.local.set({postsSkippedAlreadyCommented:x,duplicatePostsDetected:S},()=>{console.log(`Updated post already commented counter: ${x}`),console.log(`Updated duplicate posts detected counter: ${S}`),chrome.runtime.sendMessage({action:"realTimeCountUpdate",postsSkippedAlreadyCommentedCount:x,duplicatePostsDetectedCount:S}),o()})})}async function R(o,e,r,t,n,s,c,l,i){a=!0,console.log("ğŸš€ Starting new commenting flow with parameters:"),d("ğŸš€ Starting new commenting flow with parameters:"),console.log(`   - scrollDuration: ${o}`),console.log(`   - commentDelay: ${e}`),console.log(`   - maxPosts: ${r}`),console.log(`   - isCommentingActive: ${a}`),d(`   - scrollDuration: ${o}, commentDelay: ${e}, maxPosts: ${r}, isCommentingActive: ${a}`),d("ğŸ­ Applied LinkedIn background tab bypass techniques"),D=await X(),await no(),await eo(),await G(),await U(T),L=await Z(),console.log(`Loaded ${D.size} authors with timestamps and ${L.size} authors for today`),console.log(`Loaded counters - Posts skipped: ${E}, Recent authors: ${v}`),d(`Loaded ${D.size} authors with timestamps and ${L.size} authors for today`),d(`Loaded counters - Posts skipped: ${E}, Recent authors: ${v}`);try{if(console.log(`Starting new commenting flow with max ${r} posts...`),d(`Starting new commenting flow with max ${r} posts...`),console.log(`ğŸ“œ Step 1: Scrolling feed for ${o} seconds...`),d(`ğŸ“œ Step 1: Scrolling feed for ${o} seconds...`),await j(o,a,i),console.log("ğŸ“œ Step 1.5: Scrolling completed, now moving back to original tab..."),d("ğŸ“œ Step 1.5: Scrolling completed, now moving back to original tab..."),chrome.runtime.sendMessage({action:"moveToOriginalTab"}),await C(2e3),!a){console.log("âŒ Commenting stopped during scroll phase"),d("âŒ Commenting stopped during scroll phase"),P();return}if(console.log("ğŸ“œ Step 2: Scrolling back to top..."),d("ğŸ“œ Step 2: Scrolling back to top..."),window.scrollTo({top:0,behavior:"smooth"}),await C(2e3),s&&c&&l&&(c.textContent="âœ… Posts loaded! You can now move away from this tab",c.style.background="#28a745",c.style.fontSize="20px",l.textContent="All posts have been loaded. Switching to automation mode...",await C(3e3),s.remove(),d("ğŸ“œ ğŸ­ Overlay removed after successful post loading")),!a){console.log("âŒ Commenting stopped during scroll to top"),d("âŒ Commenting stopped during scroll to top"),P();return}console.log("ğŸ“œ Step 3: Processing all posts on feed..."),console.log(`   - maxPosts parameter: ${r}`),console.log(`   - commentDelay parameter: ${e}`),console.log(`   - isCommentingActive before processing: ${a}`),d(`ğŸ“œ Step 3: Processing all posts on feed... maxPosts: ${r}, commentDelay: ${e}, isCommentingActive: ${a}`),await co(e,r,n),console.log("ğŸ“œ Step 3 completed. Final state:"),console.log(`   - isCommentingActive: ${a}`),d(`ğŸ“œ Step 3 completed. Final isCommentingActive: ${a}`),P(),a?(console.log("ğŸ Sending completion message to background script..."),d("ğŸ Sending completion message to background script..."),chrome.runtime.sendMessage({action:"commentingCompleted"})):(console.log("ğŸ›‘ Not sending completion message because commenting was stopped"),d("ğŸ›‘ Not sending completion message because commenting was stopped"))}catch(m){console.error("ğŸ’¥ Error in new commenting flow:",m),I("ğŸ’¥ Error in new commenting flow:",m),a=!1,P()}}async function co(o,e,r){console.group("ğŸ¯ PROCESSING ALL POSTS - DETAILED DEBUG"),F("ğŸ¯ PROCESSING ALL POSTS - DETAILED DEBUG"),console.log(`ğŸ¯ Starting to process posts on feed (max ${e} posts)...`),d(`ğŸ¯ Starting to process posts on feed (max ${e} posts)...`);const t=document.querySelectorAll("div[data-id]");console.log(`ğŸ¯ Found ${t.length} post containers with selector: div[data-id]`),d(`ğŸ¯ Found ${t.length} post containers with selector: div[data-id]`);const n=document.querySelectorAll(".feed-shared-update-v2"),s=document.querySelectorAll('[data-urn*="urn:li:activity"]'),c=document.querySelectorAll(".feed-shared-update-v2__content");if(console.log("ğŸ¯ Alternative selector results:"),console.log(`   - .feed-shared-update-v2: ${n.length} elements`),console.log(`   - [data-urn*="urn:li:activity"]: ${s.length} elements`),console.log(`   - .feed-shared-update-v2__content: ${c.length} elements`),d(`ğŸ¯ Alternative selector results: .feed-shared-update-v2: ${n.length}, [data-urn*="urn:li:activity"]: ${s.length}, .feed-shared-update-v2__content: ${c.length}`),t.length===0){console.error("ğŸš¨ NO POSTS FOUND! This is why the automation stops immediately."),console.error("ğŸš¨ The page might not be fully loaded or the selector is wrong."),I("ğŸš¨ NO POSTS FOUND! This is why the automation stops immediately."),I("ğŸš¨ The page might not be fully loaded or the selector is wrong."),console.groupEnd(),M();return}let l=0;console.log(`ğŸ¯ Starting loop: commentCount=${l}, maxPosts=${e}, isActive=${a}`),d(`ğŸ¯ Starting loop: commentCount=${l}, maxPosts=${e}, isActive=${a}`);for(let i=0;i<t.length&&a&&l<e;i++){if(console.group(`ğŸ”„ POST ${i+1}/${t.length} - DETAILED PROCESSING`),console.log(`ğŸ”„ Loop iteration ${i+1}:`),console.log(`   - commentCount: ${l}/${e}`),console.log(`   - isCommentingActive: ${a}`),console.log(`   - Loop condition: i(${i}) < postContainers.length(${t.length}) = ${i<t.length}`),console.log(`   - Active condition: isCommentingActive = ${a}`),console.log(`   - Count condition: commentCount(${l}) < maxPosts(${e}) = ${l<e}`),console.log(`   - Overall loop should continue: ${i<t.length&&a&&l<e}`),!a){console.log("âŒ STOPPING: isCommentingActive became false"),console.groupEnd();break}const m=t[i];try{if(console.log(`ğŸ” Processing post ${i+1}/${t.length} (commented: ${l}/${e})`),m.scrollIntoView({behavior:"smooth",block:"center"}),await C(1e3),!a){console.log("âŒ STOPPING: isCommentingActive became false after scroll"),console.groupEnd();break}const p=extractPostUrns(m);if(p.length===0){console.log(`â­ï¸ SKIPPING post ${i+1} - could not extract post URNs`),console.groupEnd();continue}let g=!1;for(const w of p)if(so(w)){console.log(`â­ï¸ SKIPPING post ${i+1} - already commented on post URN: ${w}`),g=!0;break}if(g){await lo(),console.groupEnd();continue}const u=K(m);if(!u){console.log(`â­ï¸ SKIPPING post ${i+1} - could not extract author info`),console.groupEnd();continue}if(Q(u.name,D,r)){console.log(`â­ï¸ SKIPPING post ${i+1} - already commented on ${u.name} within ${r} hours`),await to(),console.groupEnd();continue}const f=B(m);if(!f){console.log(`â­ï¸ SKIPPING post ${i+1} - could not extract post content`),console.groupEnd();continue}const A=u.name+f;if(console.log(`ğŸ“ Post content preview: ${f.substring(0,100)}...`),!a){console.log("âŒ STOPPING: isCommentingActive became false before comment generation"),console.groupEnd();break}console.log(`ğŸ¤– Generating comment for post ${i+1}...`);const h=await z(A);if(console.log(`ğŸ¤– Comment generation result for post ${i+1}:`,h?"SUCCESS":"FAILED"),!h){console.log(`âŒ SKIPPING post ${i+1} - could not generate comment`),console.groupEnd();continue}if(console.log(`âœ… Generated comment for post ${i+1}:`,h.substring(0,50)+"..."),!a){console.log("âŒ STOPPING: isCommentingActive became false before posting comment"),console.groupEnd();break}console.log(`ğŸ“ Attempting to post comment on post ${i+1} by ${u.name}...`);const $=await W(m,h,a);if(console.log(`ğŸ“ Comment posting result for post ${i+1}: ${$?"SUCCESS":"FAILED"}`),$){l++,L.add(u.name),await oo(u.name),await J(u.name),D.set(u.name,Date.now());for(const w of p)await ro(w);if(await Y(),console.log(`ğŸ‰ Successfully posted comment ${l}/${e} on post by ${u.name}`),d(`ğŸ‰ Successfully posted comment ${l}/${e} on post by ${u.name}`),console.group("ğŸ“Š Progress Update After Successful Comment"),console.log(`Comments posted this session: ${l}/${e}`),console.log("Authors commented on today:",Array.from(L)),console.log(`Remaining posts to process: ${t.length-i-1}`),console.log(`Should continue? commentCount(${l}) < maxPosts(${e}) = ${l<e}`),console.log(`Next iteration will be: ${i+1} < ${t.length} = ${i+1<t.length}`),d(`ğŸ“Š Progress Update: ${l}/${e} comments posted. Remaining posts: ${t.length-i-1}. Should continue: ${l<e}`),console.groupEnd(),chrome.runtime.sendMessage({action:"updateCommentCount",count:l,status:`Posted comment ${l}/${e} on post by ${u.name}`}),l>=e){console.log(`âœ… REACHED MAX POSTS LIMIT: commentCount(${l}) >= maxPosts(${e}). Stopping...`),d(`âœ… REACHED MAX POSTS LIMIT: commentCount(${l}) >= maxPosts(${e}). Stopping...`),console.groupEnd();break}if(i<t.length-1&&l<e){console.log(`â³ Waiting ${o} seconds before next comment...`),console.log(`â³ Delay conditions: i(${i}) < postContainers.length-1(${t.length-1}) = ${i<t.length-1}`),console.log(`â³ Delay conditions: commentCount(${l}) < maxPosts(${e}) = ${l<e}`);const w=Math.ceil(o);for(let k=0;k<w&&a;k++)if(await C(1e3),!a){console.log("âŒ STOPPING during comment delay due to stop signal"),console.groupEnd();break}if(!a){console.groupEnd();break}console.log("âœ… Delay completed, continuing to next post...")}else console.log("ğŸ”š No delay needed - this was the last post or we've reached max comments"),console.log(`   - i(${i}) < postContainers.length-1(${t.length-1}): ${i<t.length-1}`),console.log(`   - commentCount(${l}) < maxPosts(${e}): ${l<e}`)}else console.log(`âŒ Failed to post comment on post ${i+1} by ${u.name}`);console.groupEnd()}catch(p){console.error(`ğŸ’¥ Error processing post ${i+1}:`,p),console.groupEnd()}console.log(`ğŸ”„ End of iteration ${i+1}. Next iteration check:`),console.log(`   - Next i will be: ${i+1}`),console.log(`   - postContainers.length: ${t.length}`),console.log(`   - isCommentingActive: ${a}`),console.log(`   - commentCount: ${l}`),console.log(`   - maxPosts: ${e}`),console.log(`   - Loop will continue: ${i+1<t.length&&a&&l<e}`)}console.log("ğŸ LOOP COMPLETED. Final stats:"),console.log(`   - Posted ${l}/${e} comments total`),console.log(`   - Final isCommentingActive: ${a}`),console.log(`   - Processed ${t.length} total posts`),console.log("   - Loop exit reason analysis:"),console.log(`     - Reached max posts? ${l>=e}`),console.log(`     - Lost active status? ${!a}`),console.log(`     - Ran out of posts? ${t.length===0}`),d(`ğŸ LOOP COMPLETED. Final stats: Posted ${l}/${e} comments total. Final isCommentingActive: ${a}. Processed ${t.length} total posts.`),d(`ğŸ Loop exit reason: Reached max posts? ${l>=e}, Lost active status? ${!a}, Ran out of posts? ${t.length===0}`),console.groupEnd(),M()}function P(){try{console.log("ğŸ”‡ Stopping continuous audio..."),O&&(O.stop(),O=null),b&&(b.pause(),b.remove(),b=null),y&&y.state!=="closed"&&(y.close(),y=null),console.log("ğŸ”‡ Continuous audio stopped")}catch(o){console.warn("âš ï¸ Error stopping audio:",o)}}console.log("EngageKit content script loaded - Background Window Mode");
//# sourceMappingURL=index.tsx-BrVtH-MR.js.map
})()
