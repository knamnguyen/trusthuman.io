{"version":3,"file":"index.tsx-Zm9hyqWA.js","sources":["../../src/utils/wait.ts","../../src/pages/content/background-log.ts","../../src/pages/content/post-comment-on-post.ts","../../src/pages/content/index.tsx"],"sourcesContent":["// Utility function to wait\nexport default function wait(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","// Background logging functions to send logs to background script\nconst backgroundLog = (...args: any[]) => {\n  console.log(...args); // Still log to content script console\n  chrome.runtime\n    .sendMessage({\n      action: \"backgroundLog\",\n      level: \"log\",\n      args: args,\n    })\n    .catch(() => {\n      /* ignore if background script not available */\n    });\n};\n\nconst backgroundError = (...args: any[]) => {\n  console.error(...args); // Still log to content script console\n  chrome.runtime\n    .sendMessage({\n      action: \"backgroundLog\",\n      level: \"error\",\n      args: args,\n    })\n    .catch(() => {\n      /* ignore if background script not available */\n    });\n};\n\nconst backgroundWarn = (...args: any[]) => {\n  console.warn(...args); // Still log to content script console\n  chrome.runtime\n    .sendMessage({\n      action: \"backgroundLog\",\n      level: \"warn\",\n      args: args,\n    })\n    .catch(() => {\n      /* ignore if background script not available */\n    });\n};\n\nconst backgroundGroup = (...args: any[]) => {\n  console.group(...args); // Still log to content script console\n  chrome.runtime\n    .sendMessage({\n      action: \"backgroundLog\",\n      level: \"group\",\n      args: args,\n    })\n    .catch(() => {\n      /* ignore if background script not available */\n    });\n};\n\nconst backgroundGroupEnd = () => {\n  console.groupEnd(); // Still log to content script console\n  chrome.runtime\n    .sendMessage({\n      action: \"backgroundLog\",\n      level: \"groupEnd\",\n      args: [],\n    })\n    .catch(() => {\n      /* ignore if background script not available */\n    });\n};\n\nexport {\n  backgroundLog,\n  backgroundError,\n  backgroundWarn,\n  backgroundGroup,\n  backgroundGroupEnd,\n};\n","import wait from \"@src/utils/wait\";\n\n// Function to post comment on a specific post\nexport default async function postCommentOnPost(\n  postContainer: HTMLElement,\n  comment: string,\n  isCommentingActive: boolean,\n): Promise<boolean> {\n  try {\n    console.group(\"üìù Comment Posting Process\");\n    console.log(\"Starting to post comment:\", comment.substring(0, 100) + \"...\");\n\n    // Check if we should stop before starting\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Stopping comment posting due to stop signal\");\n      console.groupEnd();\n      return false;\n    }\n\n    // Step 1: Find and click the comment button\n    console.log(\"üîç Looking for comment button...\");\n    const commentButton = postContainer.querySelector(\n      'button[aria-label=\"Comment\"]',\n    ) as HTMLButtonElement;\n    if (!commentButton) {\n      console.error(\"‚ùå Comment button not found\");\n      console.groupEnd();\n      return false;\n    }\n\n    console.log(\"üëÜ Clicking comment button...\");\n    commentButton.click();\n\n    // Wait for comment editor to appear\n    console.log(\"‚è≥ Waiting for comment editor to appear...\");\n    await wait(2000);\n\n    // Check again after wait\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Stopping during comment editor wait due to stop signal\");\n      console.groupEnd();\n      return false;\n    }\n\n    // Step 2: Find the comment editor\n    console.log(\"üîç Looking for comment editor...\");\n    const commentEditor = postContainer.querySelector(\n      \".comments-comment-box-comment__text-editor\",\n    );\n    if (!commentEditor) {\n      console.error(\"‚ùå Comment editor not found\");\n      console.groupEnd();\n      return false;\n    }\n\n    // Step 3: Find the editable field within the editor\n    console.log(\"üîç Looking for editable field...\");\n    const editableField = commentEditor.querySelector(\n      'div[contenteditable=\"true\"]',\n    ) as HTMLElement;\n    if (!editableField) {\n      console.error(\"‚ùå Editable field not found\");\n      console.groupEnd();\n      return false;\n    }\n\n    console.log(\"‚úÖ Found editable field, inputting comment...\");\n\n    // Check again before inputting\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Stopping during comment input due to stop signal\");\n      console.groupEnd();\n      return false;\n    }\n\n    // Step 4: Click on the editable field and input the comment\n    editableField.focus();\n    editableField.click();\n    editableField.innerHTML = \"\";\n\n    // Input the comment text\n    const lines = comment.split(\"\\n\");\n    lines.forEach((lineText) => {\n      const p = document.createElement(\"p\");\n      if (lineText === \"\") {\n        p.appendChild(document.createElement(\"br\"));\n      } else {\n        p.textContent = lineText;\n      }\n      editableField.appendChild(p);\n    });\n\n    // Set cursor position and trigger input event\n    const selection = window.getSelection();\n    if (selection) {\n      const range = document.createRange();\n      if (editableField.lastChild) {\n        range.setStartAfter(editableField.lastChild);\n      } else {\n        range.selectNodeContents(editableField);\n      }\n      range.collapse(true);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n    editableField.focus();\n\n    const inputEvent = new Event(\"input\", { bubbles: true, cancelable: true });\n    editableField.dispatchEvent(inputEvent);\n\n    console.log(\"‚úÖ Comment text inputted successfully\");\n\n    // Wait for submit button to become enabled\n    console.log(\"‚è≥ Waiting for submit button to become enabled...\");\n    await wait(1000);\n\n    // Check again before submitting\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Stopping during submit button wait due to stop signal\");\n      console.groupEnd();\n      return false;\n    }\n\n    // Step 5: Find and click the submit button\n    console.log(\"üîç Looking for submit button...\");\n    const submitButton = postContainer.querySelector(\n      \".comments-comment-box__submit-button--cr\",\n    ) as HTMLButtonElement;\n    if (!submitButton || submitButton.disabled) {\n      console.error(\"‚ùå Submit button not found or disabled\");\n      console.groupEnd();\n      return false;\n    }\n\n    console.log(\"üöÄ Clicking submit button...\");\n    submitButton.click();\n\n    // Wait for comment to be posted\n    console.log(\"‚è≥ Waiting for comment to be posted...\");\n    await wait(2000);\n\n    console.log(\"üéâ Comment posted successfully\");\n    console.groupEnd();\n    return true;\n  } catch (error) {\n    console.error(\"üí• Error posting comment:\", error);\n    console.groupEnd();\n    return false;\n  }\n}\n","import wait from \"@src/utils/wait\";\n\nimport {\n  backgroundError,\n  backgroundGroup,\n  backgroundGroupEnd,\n  backgroundLog,\n  backgroundWarn,\n} from \"./background-log\";\nimport postCommentOnPost from \"./post-comment-on-post\";\n\n// Content script for EngageKit - Background Window Mode\n// This script processes posts directly on the feed page\n\nlet isCommentingActive = false;\nlet commentedAuthors = new Set<string>();\nlet commentedAuthorsWithTimestamps = new Map<string, number>();\nlet postsSkippedDuplicateCount = 0;\nlet recentAuthorsDetectedCount = 0;\nlet commentedPostUrns = new Map<string, number>(); // URN -> timestamp\nlet postsSkippedAlreadyCommentedCount = 0;\nlet duplicatePostsDetectedCount = 0;\nlet postsSkippedTimeFilterCount = 0;\nlet audioContext: AudioContext | null = null;\nlet currentOscillator: OscillatorNode | null = null;\nlet audioElement: HTMLAudioElement | null = null;\n\n// Check if we need to show the start button\nlet hasUserInteracted = false;\n\n//check if page is ready to display the start button\nif (document.readyState !== \"loading\") {\n  console.log(\"document is already ready, just execute code here\");\n  //send page ready message to background script\n  chrome.runtime.sendMessage({\n    action: \"pageReady\",\n  });\n} else {\n  document.addEventListener(\"DOMContentLoaded\", function () {\n    console.log(\"document was not ready, place code here\");\n    //send page ready message to background script\n    chrome.runtime.sendMessage({\n      action: \"pageReady\",\n    });\n  });\n}\n\n// Function to show the start button overlay\nfunction showStartButton() {\n  console.log(\"üöÄ Showing start button for EngageKit...\");\n\n  // Don't show multiple buttons\n  if (document.getElementById(\"linkedin-start-overlay\")) {\n    return;\n  }\n\n  // Create full-screen overlay\n  const overlay = document.createElement(\"div\");\n  overlay.id = \"linkedin-start-overlay\";\n  overlay.style.cssText = `\n    position: fixed !important;\n    top: 0 !important;\n    left: 0 !important;\n    width: 100vw !important;\n    height: 100vh !important;\n    background: rgba(0, 115, 177, 0.95) !important;\n    z-index: 2147483647 !important;\n    display: flex !important;\n    flex-direction: column !important;\n    justify-content: center !important;\n    align-items: center !important;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;\n    color: white !important;\n  `;\n\n  // Create container\n  const container = document.createElement(\"div\");\n  container.style.cssText = `\n    text-align: center !important;\n    max-width: 600px !important;\n    padding: 40px !important;\n    background: rgba(255, 255, 255, 0.1) !important;\n    border-radius: 20px !important;\n    backdrop-filter: blur(10px) !important;\n  `;\n\n  // Create title\n  const title = document.createElement(\"h1\");\n  title.textContent = \"EngageKit\";\n  title.style.cssText = `\n    font-size: 48px !important;\n    margin: 0 0 20px 0 !important;\n    text-align: center !important;\n    font-weight: bold !important;\n    color: white !important;\n  `;\n\n  // Create subtitle\n  const subtitle = document.createElement(\"p\");\n  subtitle.textContent = \"Click to start auto-commenting on LinkedIn posts\";\n  subtitle.style.cssText = `\n    font-size: 20px !important;\n    margin: 0 0 40px 0 !important;\n    text-align: center !important;\n    opacity: 0.9 !important;\n    color: white !important;\n  `;\n\n  // Create start button\n  const startButton = document.createElement(\"button\");\n  startButton.textContent = \"üöÄ Start Auto-Commenting\";\n  startButton.style.cssText = `\n    background: #ffffff !important;\n    color: #0073b1 !important;\n    border: none !important;\n    padding: 20px 40px !important;\n    font-size: 24px !important;\n    font-weight: bold !important;\n    border-radius: 12px !important;\n    cursor: pointer !important;\n    box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;\n    transition: all 0.3s ease !important;\n    margin: 0 0 20px 0 !important;\n    font-family: inherit !important;\n  `;\n\n  // Add hover effects\n  startButton.addEventListener(\"mouseenter\", () => {\n    startButton.style.transform = \"translateY(-2px)\";\n    startButton.style.boxShadow = \"0 12px 20px rgba(0,0,0,0.3)\";\n  });\n\n  startButton.addEventListener(\"mouseleave\", () => {\n    startButton.style.transform = \"translateY(0)\";\n    startButton.style.boxShadow = \"0 8px 16px rgba(0,0,0,0.2)\";\n  });\n\n  // Create info text\n  const infoText = document.createElement(\"p\");\n  infoText.innerHTML = `\n    <strong>What will happen:</strong><br>\n    ‚Ä¢ Audio will start playing to keep this tab active<br>\n    ‚Ä¢ This window will move to the background<br>\n    ‚Ä¢ Auto-commenting will begin immediately<br>\n    ‚Ä¢ You can continue using other applications\n  `;\n  infoText.style.cssText = `\n    font-size: 16px !important;\n    text-align: center !important;\n    opacity: 0.8 !important;\n    line-height: 1.6 !important;\n    max-width: 500px !important;\n    margin: 0 !important;\n    color: white !important;\n  `;\n\n  // Button click handler\n  startButton.addEventListener(\"click\", async () => {\n    console.log(\"üöÄ Start button clicked! Beginning full flow...\");\n    hasUserInteracted = true;\n\n    // Update button state\n    startButton.textContent = \"üîÑ Starting...\";\n    startButton.style.background = \"#28a745\";\n    startButton.style.color = \"white\";\n    startButton.disabled = true;\n\n    try {\n      // Step 1: Start continuous audio\n      console.log(\"üéµ Step 1: Starting continuous audio...\");\n      await injectAndPlayContinuousSound();\n\n      startButton.textContent = \"üéµ Audio Started\";\n\n      await wait(1000);\n      startButton.textContent = \"üí¨ Starting flow\";\n      //step 2: move back to the original tab\n\n      // Get settings from storage and start commenting\n      chrome.storage.local.get(\n        [\n          \"scrollDuration\",\n          \"commentDelay\",\n          \"maxPosts\",\n          \"duplicateWindow\",\n          \"styleGuide\",\n          \"apiKey\",\n        ],\n        (result) => {\n          backgroundLog(\"Content: Retrieved settings from storage:\", result);\n\n          // Use popup settings with fallbacks only if completely missing\n          const scrollDuration =\n            result.scrollDuration !== undefined ? result.scrollDuration : 10;\n          const commentDelay =\n            result.commentDelay !== undefined ? result.commentDelay : 5;\n          const maxPosts = result.maxPosts !== undefined ? result.maxPosts : 5;\n          const duplicateWindow =\n            result.duplicateWindow !== undefined ? result.duplicateWindow : 24;\n          const styleGuide =\n            result.styleGuide !== undefined\n              ? result.styleGuide\n              : \"Be engaging and professional\";\n          const apiKey = result.apiKey !== undefined ? result.apiKey : \"\";\n\n          backgroundLog(\"üéØ Starting commenting flow with settings:\", {\n            scrollDuration,\n            commentDelay,\n            maxPosts,\n            styleGuide: styleGuide?.substring(0, 50) + \"...\",\n            hasApiKey: !!apiKey,\n          });\n\n          // API key check removed - using server-side tRPC API now\n\n          if (!styleGuide) {\n            backgroundError(\n              \"‚ùå No style guide found in storage! Cannot start commenting.\",\n            );\n            return;\n          }\n\n          // Update button status for scrolling phase\n          startButton.textContent = `üìú Scrolling to load posts (${scrollDuration}s) - DON'T navigate away!`;\n          startButton.style.background = \"#ff9500\";\n          startButton.style.fontSize = \"18px\";\n          subtitle.textContent =\n            \"Loading posts from LinkedIn feed - please keep this tab visible\";\n\n          // Add dynamic status panel to the overlay\n          const statusPanel = document.createElement(\"div\");\n          statusPanel.id = \"linkedin-status-panel\";\n          statusPanel.style.cssText = `\n          background: rgba(255, 255, 255, 0.15) !important;\n          border-radius: 12px !important;\n          padding: 20px !important;\n          margin-top: 20px !important;\n          border: 1px solid rgba(255, 255, 255, 0.3) !important;\n          font-family: monospace !important;\n          font-size: 14px !important;\n          line-height: 1.6 !important;\n        `;\n\n          const initialPosts = document.querySelectorAll(\n            \".feed-shared-update-v2__control-menu-container\",\n          ).length;\n\n          statusPanel.innerHTML = `\n          <div style=\"color: white !important; margin-bottom: 12px !important;\">\n            <strong>üìä AUTOMATION SETTINGS</strong>\n          </div>\n          <div style=\"color: #e0e0e0 !important; margin-bottom: 8px !important;\">\n            üìú Scroll Duration: <span style=\"color: #90EE90 !important;\">${scrollDuration} seconds</span>\n          </div>\n          <div style=\"color: #e0e0e0 !important; margin-bottom: 8px !important;\">\n            ‚è±Ô∏è Comment Delay: <span style=\"color: #90EE90 !important;\">${commentDelay} seconds</span>\n          </div>\n          <div style=\"color: #e0e0e0 !important; margin-bottom: 16px !important;\">\n            üéØ Max Posts: <span style=\"color: #90EE90 !important;\">${maxPosts} posts</span>\n          </div>\n          \n          <div style=\"color: white !important; margin-bottom: 12px !important;\">\n            <strong>üìà REAL-TIME STATUS</strong>\n          </div>\n          <div id=\"time-remaining\" style=\"color: #FFD700 !important; margin-bottom: 8px !important;\">\n            ‚è∞ Time Remaining: <span style=\"color: #FFA500 !important;\">${scrollDuration}s</span>\n          </div>\n          <div id=\"posts-loaded\" style=\"color: #87CEEB !important; margin-bottom: 8px !important;\">\n            üìù Posts Loaded: <span style=\"color: #00BFFF !important;\">${initialPosts} posts</span>\n          </div>\n          <div id=\"scroll-progress\" style=\"color: #DDA0DD !important;\">\n            üîÑ Status: <span style=\"color: #DA70D6 !important;\">Starting scroll...</span>\n          </div>\n        `;\n\n          // Add status panel to the container (after the info text)\n          const container = overlay.querySelector(\"div\");\n          if (container) {\n            container.appendChild(statusPanel);\n          }\n\n          // Start the commenting flow but delay tab switching until after scrolling\n          startNewCommentingFlowWithDelayedTabSwitch(\n            scrollDuration,\n            commentDelay,\n            maxPosts,\n            styleGuide,\n            duplicateWindow,\n            overlay,\n            startButton,\n            subtitle,\n            statusPanel,\n          );\n        },\n      );\n\n      // Don't remove overlay here - let the commenting flow handle it\n\n      console.log(\"‚úÖ Full flow started successfully!\");\n    } catch (error) {\n      console.error(\"‚ùå Failed to start:\", error);\n      startButton.textContent = \"‚ùå Failed - Try Again\";\n      startButton.style.background = \"#dc3545\";\n      startButton.disabled = false;\n      subtitle.textContent = \"Something went wrong - click to try again\";\n    }\n  });\n\n  // Assemble UI\n  container.appendChild(title);\n  container.appendChild(subtitle);\n  container.appendChild(startButton);\n  container.appendChild(infoText);\n  overlay.appendChild(container);\n\n  // Add to page\n  document.body.appendChild(overlay);\n\n  console.log(\"üöÄ Start button overlay displayed\");\n}\n\n// --- Main function to create and play the continuous audio ---\nasync function injectAndPlayContinuousSound(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    try {\n      console.log(\"üéµ Initializing Web Audio API for continuous sound...\");\n\n      // Get the AudioContext constructor, working across browsers\n      const AudioContext =\n        window.AudioContext || (window as any).webkitAudioContext;\n\n      // Check if Web Audio API is supported\n      if (!AudioContext) {\n        throw new Error(\n          \"Web Audio API is not supported in this browser. Cannot play audio.\",\n        );\n      }\n\n      // Create an AudioContext instance\n      // This is the gateway to using the Web Audio API\n      audioContext = new AudioContext();\n\n      // --- Sound Generation Setup ---\n\n      // Create an OscillatorNode: This will generate the actual sound wave\n      const oscillator = audioContext.createOscillator();\n\n      // Create a GainNode: This will control the volume of the sound\n      const gainNode = audioContext.createGain();\n\n      // Create a MediaStreamDestinationNode: This allows us to take the audio\n      // generated by the Web Audio API and use it as a source for an HTML <audio> element.\n      const mediaStreamDestination =\n        audioContext.createMediaStreamDestination();\n\n      // Connect the nodes: Oscillator -> GainNode -> MediaStreamDestination\n      // The sound flows from the oscillator, through the volume control (gain),\n      // and then to the stream destination.\n      oscillator.connect(gainNode);\n      gainNode.connect(mediaStreamDestination);\n\n      // --- Configure the Sound ---\n\n      // Set the type of wave for the oscillator\n      // 'sine': a pure, smooth tone\n      // Other options: 'square', 'sawtooth', 'triangle'\n      oscillator.type = \"sine\";\n\n      // Set the frequency (pitch) of the sound in Hertz (Hz)\n      // Let's pick a random frequency in a generally pleasant mid-range (e.g., between C4 and C5)\n      // C4 is approx 261.63 Hz, C5 is approx 523.25 Hz\n      const minFreq = 261.63;\n      const maxFreq = 523.25;\n      // const frequency = Math.random() * (maxFreq - minFreq) + minFreq;\n      const frequency = 10000;\n\n      //picking an inaudible frequency almost zero volume\n      oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);\n\n      // Set the volume using the GainNode\n      // 0.0 is silent, 1.0 is full volume. Let's set it low to be less intrusive.\n      gainNode.gain.setValueAtTime(0.001, audioContext.currentTime); // 10% volume\n\n      // --- HTML <audio> Element Setup ---\n\n      // Create a new HTML <audio> element\n      audioElement = document.createElement(\"audio\");\n\n      // Set the source of the audio element to the stream from our Web Audio API setup\n      audioElement.srcObject = mediaStreamDestination.stream;\n\n      // Set the audio to autoplay\n      // IMPORTANT: Browsers have autoplay restrictions. This might not work without user interaction.\n      audioElement.autoplay = true;\n\n      // Set the audio to loop continuously\n      audioElement.loop = true;\n\n      // Hide the default audio controls for background audio\n      audioElement.controls = false;\n\n      // Hide the audio element\n      audioElement.style.cssText = \"position: fixed; top: -9999px; opacity: 0;\";\n\n      // --- Inject into DOM and Start ---\n\n      // Append the new audio element to the body of the document\n      // This makes it part of the webpage\n      document.body.appendChild(audioElement);\n\n      // Resume AudioContext if needed (for user gesture compliance)\n      const startAudioPlayback = async () => {\n        if (audioContext!.state === \"suspended\") {\n          await audioContext!.resume();\n        }\n\n        // Start the oscillator to begin generating sound\n        // This needs to happen for any sound to be produced\n        oscillator.start();\n        currentOscillator = oscillator;\n\n        // Attempt to play the HTML audio element\n        // This is often needed due to autoplay policies, especially if audioCtx was not started by user gesture.\n        const playPromise = audioElement!.play();\n\n        if (playPromise !== undefined) {\n          playPromise\n            .then(() => {\n              // Autoplay started successfully.\n              console.log(\n                `‚úÖ Playing a ${oscillator.type} wave at ${frequency.toFixed(\n                  2,\n                )} Hz. Audio element injected and playing.`,\n              );\n              resolve();\n            })\n            .catch((error) => {\n              // Autoplay was prevented.\n              console.warn(\"‚ùå Autoplay was prevented by the browser:\", error);\n              reject(error);\n            });\n        } else {\n          console.log(`‚úÖ Audio started successfully (no promise returned)`);\n          resolve();\n        }\n      };\n\n      startAudioPlayback();\n    } catch (error) {\n      console.error(\"‚ùå Audio setup failed:\", error);\n      reject(error);\n    }\n  });\n}\n\n// Listen for messages from the background script\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  console.log(\"Content script received message:\", request);\n\n  if (request.action === \"showStartButton\") {\n    console.log(\"üì± Popup requested to show start button\");\n    showStartButton();\n    sendResponse({ success: true });\n  } else if (request.action === \"startNewCommentingFlow\") {\n    startNewCommentingFlowWithDelayedTabSwitch(\n      request.scrollDuration,\n      request.commentDelay,\n      request.maxPosts,\n      request.styleGuide,\n      request.apiKey,\n      request.duplicateWindow || 24, // default to 24 hours if not provided\n      null as any, // overlay not available from this path\n      null as any, // startButton not available from this path\n      null as any, // subtitle not available from this path\n      null as any, // statusPanel not available from this path\n    );\n    sendResponse({ success: true });\n  } else if (request.action === \"stopCommentingFlow\") {\n    console.log(\"Received stop signal - stopping commenting flow\");\n    isCommentingActive = false;\n    stopTabActiveAudio();\n    sendResponse({ success: true });\n  } else if (request.action === \"statusUpdate\" && request.error) {\n    // Log error details to the website console for debugging\n    console.group(\"üö® EngageKit Error Details\");\n    console.error(\"Error Message:\", request.error.message);\n    if (request.error.status) {\n      console.error(\n        \"HTTP Status:\",\n        request.error.status,\n        \"-\",\n        request.error.statusText,\n      );\n    }\n    if (request.error.body) {\n      console.error(\"API Response Body:\", request.error.body);\n    }\n    if (request.error.headers) {\n      console.error(\"Response Headers:\", request.error.headers);\n    }\n    console.error(\"API Key Status:\", request.error.apiKey || \"Unknown\");\n    console.error(\"Style Guide Status:\", request.error.styleGuide || \"Unknown\");\n    if (request.error.postContentLength !== undefined) {\n      console.error(\n        \"Post Content Length:\",\n        request.error.postContentLength,\n        \"characters\",\n      );\n    }\n    if (request.error.stack) {\n      console.error(\"Stack Trace:\", request.error.stack);\n    }\n    if (request.error.data) {\n      console.error(\"Additional Data:\", request.error.data);\n    }\n    console.groupEnd();\n\n    // Also create a visual alert in the page\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.style.cssText = `\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #fee;\n      border: 2px solid #f00;\n      padding: 15px;\n      border-radius: 8px;\n      z-index: 10000;\n      max-width: 400px;\n      font-family: Arial, sans-serif;\n      font-size: 12px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n    `;\n    errorDiv.innerHTML = `\n      <div style=\"font-weight: bold; color: #d00; margin-bottom: 8px;\">\n        üö® EngageKit Error\n      </div>\n      <div style=\"color: #800; margin-bottom: 5px;\">\n        ${request.error.message || \"Unknown error occurred\"}\n      </div>\n      ${\n        request.error.status\n          ? `<div style=\"color: #600; font-size: 11px;\">HTTP ${request.error.status}: ${request.error.statusText}</div>`\n          : \"\"\n      }\n      <div style=\"color: #600; font-size: 11px; margin-top: 5px;\">\n        Check console for full details (F12)\n      </div>\n      <button onclick=\"this.parentElement.remove()\" style=\"\n        background: #d00;\n        color: white;\n        border: none;\n        padding: 4px 8px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 10px;\n        margin-top: 8px;\n      \">Close</button>\n    `;\n    document.body.appendChild(errorDiv);\n\n    // Auto-remove after 10 seconds\n    setTimeout(() => {\n      if (errorDiv.parentElement) {\n        errorDiv.remove();\n      }\n    }, 10000);\n  }\n});\n\n// Function to get today's date string\nfunction getTodayDateString(): string {\n  return new Date().toDateString();\n}\n\n// Function to load commented authors with timestamps from local storage\nasync function loadCommentedAuthorsWithTimestamps(): Promise<\n  Map<string, number>\n> {\n  const storageKey = \"commented_authors_timestamps\";\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([storageKey], (result) => {\n      const authorTimestamps = result[storageKey] || {};\n      resolve(\n        new Map(\n          Object.entries(authorTimestamps).map(([name, timestamp]) => [\n            name,\n            Number(timestamp),\n          ]),\n        ),\n      );\n    });\n  });\n}\n\n// Function to save commented author with timestamp to local storage\nasync function saveCommentedAuthorWithTimestamp(\n  authorName: string,\n): Promise<void> {\n  const storageKey = \"commented_authors_timestamps\";\n  const now = Date.now();\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([storageKey], (result) => {\n      const authorTimestamps = result[storageKey] || {};\n      authorTimestamps[authorName] = now;\n      chrome.storage.local.set({ [storageKey]: authorTimestamps }, () => {\n        console.log(\n          `Saved commented author: ${authorName} at timestamp: ${now}`,\n        );\n        resolve();\n      });\n    });\n  });\n}\n\n// Function to check if author was commented on within the specified time window\nfunction hasCommentedOnAuthorRecently(\n  authorName: string,\n  commentedAuthors: Map<string, number>,\n  hoursWindow: number,\n): boolean {\n  const timestamp = commentedAuthors.get(authorName);\n  if (!timestamp) return false;\n\n  const now = Date.now();\n  const hoursInMs = hoursWindow * 60 * 60 * 1000;\n\n  return now - timestamp < hoursInMs;\n}\n\n// Function to load today's commented authors from local storage (for backward compatibility)\nasync function loadTodayCommentedAuthors(): Promise<Set<string>> {\n  const today = getTodayDateString();\n  const storageKey = `commented_authors_${today}`;\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([storageKey], (result) => {\n      const todayAuthors = result[storageKey] || [];\n      resolve(new Set(todayAuthors));\n    });\n  });\n}\n\n// Function to save commented author to local storage (for backward compatibility)\nasync function saveCommentedAuthor(authorName: string): Promise<void> {\n  const today = getTodayDateString();\n  const storageKey = `commented_authors_${today}`;\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([storageKey], (result) => {\n      const todayAuthors = result[storageKey] || [];\n      if (!todayAuthors.includes(authorName)) {\n        todayAuthors.push(authorName);\n        chrome.storage.local.set({ [storageKey]: todayAuthors }, () => {\n          console.log(`Saved commented author: ${authorName} for ${today}`);\n          resolve();\n        });\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\n// Function to load counter values from storage\nasync function loadCounters(): Promise<void> {\n  return new Promise((resolve) => {\n    chrome.storage.local.get(\n      [\n        \"postsSkippedDuplicate\",\n        \"recentAuthorsDetected\",\n        \"postsSkippedAlreadyCommented\",\n        \"duplicatePostsDetected\",\n      ],\n      (result) => {\n        postsSkippedDuplicateCount = result.postsSkippedDuplicate || 0;\n        recentAuthorsDetectedCount = result.recentAuthorsDetected || 0;\n        postsSkippedAlreadyCommentedCount =\n          result.postsSkippedAlreadyCommented || 0;\n        duplicatePostsDetectedCount = result.duplicatePostsDetected || 0;\n        console.log(\n          `Loaded counters - Posts skipped: ${postsSkippedDuplicateCount}, Recent authors: ${recentAuthorsDetectedCount}, Posts already commented: ${postsSkippedAlreadyCommentedCount}, Duplicate posts detected: ${duplicatePostsDetectedCount}`,\n        );\n        resolve();\n      },\n    );\n  });\n}\n\n// Function to update skipped post counter\nasync function updateSkippedPostCounter(): Promise<void> {\n  postsSkippedDuplicateCount++;\n  recentAuthorsDetectedCount++; // For now both counters increment together\n  duplicatePostsDetectedCount++; // For now, both author filter skips and post URN skips increment this\n\n  return new Promise((resolve) => {\n    chrome.storage.local.set(\n      {\n        postsSkippedDuplicate: postsSkippedDuplicateCount,\n        recentAuthorsDetected: recentAuthorsDetectedCount,\n        duplicatePostsDetected: duplicatePostsDetectedCount,\n      },\n      () => {\n        console.log(\n          `Updated counters - Posts skipped: ${postsSkippedDuplicateCount}, Recent authors: ${recentAuthorsDetectedCount}, Duplicate posts detected: ${duplicatePostsDetectedCount}`,\n        );\n\n        // Send real-time update to popup\n        chrome.runtime.sendMessage({\n          action: \"realTimeCountUpdate\",\n          skippedCount: postsSkippedDuplicateCount,\n          recentAuthorsCount: recentAuthorsDetectedCount,\n          duplicatePostsDetectedCount: duplicatePostsDetectedCount,\n        });\n\n        resolve();\n      },\n    );\n  });\n}\n\n// Function to load commented post URNs from storage\nasync function loadCommentedPostUrns(): Promise<void> {\n  return new Promise((resolve) => {\n    chrome.storage.local.get([\"commented_post_urns\"], (result) => {\n      const storedUrns = result.commented_post_urns || {};\n      commentedPostUrns = new Map(\n        Object.entries(storedUrns).map(([urn, timestamp]) => [\n          urn,\n          Number(timestamp),\n        ]),\n      );\n      console.log(\n        `Loaded ${commentedPostUrns.size} commented post URNs from storage`,\n      );\n      resolve();\n    });\n  });\n}\n\n// Function to save a commented post URN with timestamp\nasync function saveCommentedPostUrn(urn: string): Promise<void> {\n  const timestamp = Date.now();\n  commentedPostUrns.set(urn, timestamp);\n\n  return new Promise((resolve) => {\n    const urnsObject = Object.fromEntries(commentedPostUrns);\n    chrome.storage.local.set({ commented_post_urns: urnsObject }, () => {\n      console.log(\n        `Saved commented post URN: ${urn} at timestamp: ${timestamp}`,\n      );\n      resolve();\n    });\n  });\n}\n\n// Function to check if we've already commented on a post URN\nfunction hasCommentedOnPostUrn(urn: string): boolean {\n  return commentedPostUrns.has(urn);\n}\n\n// Function to extract post URNs from data-id attribute\nfunction extractPostUrns(postContainer: HTMLElement): string[] {\n  // Look for the top-level div with data-id attribute\n  const topLevelPost = postContainer.closest(\"div[data-id]\") as HTMLElement;\n  if (!topLevelPost) {\n    console.log(\"No div[data-id] found for this post container\");\n    return [];\n  }\n\n  const dataId = topLevelPost.getAttribute(\"data-id\");\n  if (!dataId) {\n    console.log(\"No data-id attribute found\");\n    return [];\n  }\n\n  console.log(`Found data-id: ${dataId}`);\n\n  // Extract URNs - handle both single and aggregate format\n  // Single: \"urn:li:activity:7341086723700936704\"\n  // Aggregate: \"urn:li:aggregate:(urn:li:activity:7341090533815087104,urn:li:activity:7341089862118244355)\"\n  const urns: string[] = [];\n\n  if (dataId.startsWith(\"urn:li:aggregate:\")) {\n    // Handle aggregate format - extract URNs from within parentheses\n    const match = dataId.match(/urn:li:aggregate:\\((.*)\\)/);\n    if (match) {\n      const innerUrns = match[1].split(\",\").map((urn) => urn.trim());\n      urns.push(...innerUrns);\n    }\n  } else if (dataId.startsWith(\"urn:li:activity:\")) {\n    // Handle single activity format\n    urns.push(dataId);\n  }\n\n  console.log(`Extracted URNs: ${urns.join(\", \")}`);\n  return urns;\n}\n\n// Function to update the post already commented counter\nasync function updatePostAlreadyCommentedCounter(): Promise<void> {\n  postsSkippedAlreadyCommentedCount++;\n  duplicatePostsDetectedCount++; // For now, both counters increment together\n\n  return new Promise((resolve) => {\n    chrome.storage.local.set(\n      {\n        postsSkippedAlreadyCommented: postsSkippedAlreadyCommentedCount,\n        duplicatePostsDetected: duplicatePostsDetectedCount,\n      },\n      () => {\n        console.log(\n          `Updated post already commented counter: ${postsSkippedAlreadyCommentedCount}`,\n        );\n        console.log(\n          `Updated duplicate posts detected counter: ${duplicatePostsDetectedCount}`,\n        );\n\n        // Send real-time update to popup\n        chrome.runtime.sendMessage({\n          action: \"realTimeCountUpdate\",\n          postsSkippedAlreadyCommentedCount: postsSkippedAlreadyCommentedCount,\n          duplicatePostsDetectedCount: duplicatePostsDetectedCount,\n        });\n\n        resolve();\n      },\n    );\n  });\n}\n\n// Function to clean up old post URNs (older than 1 year)\nasync function cleanupOldPostUrns(): Promise<void> {\n  const oneYearInMs = 365 * 24 * 60 * 60 * 1000;\n  const now = Date.now();\n\n  return new Promise((resolve) => {\n    let removedCount = 0;\n    const cleanedUrns = new Map<string, number>();\n\n    for (const [urn, timestamp] of commentedPostUrns) {\n      if (now - timestamp < oneYearInMs) {\n        cleanedUrns.set(urn, timestamp);\n      } else {\n        removedCount++;\n      }\n    }\n\n    if (removedCount > 0) {\n      commentedPostUrns = cleanedUrns;\n      const urnsObject = Object.fromEntries(commentedPostUrns);\n      chrome.storage.local.set({ commented_post_urns: urnsObject }, () => {\n        console.log(\n          `Cleaned up ${removedCount} old post URNs (older than 1 year)`,\n        );\n        resolve();\n      });\n    } else {\n      console.log(\"No old post URNs to clean up\");\n      resolve();\n    }\n  });\n}\n\n// Function to update comment counts in local storage\nasync function updateCommentCounts(): Promise<void> {\n  const today = getTodayDateString();\n  const todayKey = `comments_today_${today}`;\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([todayKey, \"totalAllTimeComments\"], (result) => {\n      const currentTodayCount = result[todayKey] || 0;\n      const currentAllTimeCount = result[\"totalAllTimeComments\"] || 0;\n\n      const newTodayCount = currentTodayCount + 1;\n      const newAllTimeCount = currentAllTimeCount + 1;\n\n      chrome.storage.local.set(\n        {\n          [todayKey]: newTodayCount,\n          totalAllTimeComments: newAllTimeCount,\n        },\n        () => {\n          console.log(\n            `Updated counts - Today: ${newTodayCount}, All-time: ${newAllTimeCount}`,\n          );\n\n          // Send real-time update to popup\n          chrome.runtime.sendMessage({\n            action: \"realTimeCountUpdate\",\n            todayCount: newTodayCount,\n            allTimeCount: newAllTimeCount,\n          });\n\n          resolve();\n        },\n      );\n    });\n  });\n}\n\n// Main function to start the new commenting flow with delayed tab switching\nasync function startNewCommentingFlowWithDelayedTabSwitch(\n  scrollDuration: number,\n  commentDelay: number,\n  maxPosts: number,\n  styleGuide: string,\n  duplicateWindow: number,\n  overlay: HTMLDivElement,\n  startButton: HTMLButtonElement,\n  subtitle: HTMLParagraphElement,\n  statusPanel: HTMLDivElement,\n) {\n  isCommentingActive = true;\n  console.log(`üöÄ Starting new commenting flow with parameters:`);\n  backgroundLog(`üöÄ Starting new commenting flow with parameters:`);\n  console.log(`   - scrollDuration: ${scrollDuration}`);\n  console.log(`   - commentDelay: ${commentDelay}`);\n  console.log(`   - maxPosts: ${maxPosts}`);\n  console.log(`   - isCommentingActive: ${isCommentingActive}`);\n  backgroundLog(\n    `   - scrollDuration: ${scrollDuration}, commentDelay: ${commentDelay}, maxPosts: ${maxPosts}, isCommentingActive: ${isCommentingActive}`,\n  );\n\n  // Apply tab active state spoofing immediately to prevent LinkedIn from detecting background tab\n  await forceTabActiveState();\n  backgroundLog(\"üé≠ Applied LinkedIn background tab bypass techniques\");\n\n  // // Start anti-throttling mechanisms to prevent tab throttling\n  // keepTabActiveAudio();\n\n  //starts the always active core\n  // window.alwaysActive.enable();\n\n  // Load commented authors with timestamps, post URNs, and counters from local storage\n  commentedAuthorsWithTimestamps = await loadCommentedAuthorsWithTimestamps();\n  await loadCommentedPostUrns();\n  await loadCounters();\n\n  // Clean up old timestamp entries and post URNs to prevent storage bloat\n  await cleanupOldTimestamps();\n  await cleanupOldPostUrns();\n\n  // For backward compatibility, also load today's authors\n  commentedAuthors = await loadTodayCommentedAuthors();\n  console.log(\n    `Loaded ${commentedAuthorsWithTimestamps.size} authors with timestamps and ${commentedAuthors.size} authors for today`,\n  );\n  console.log(\n    `Loaded counters - Posts skipped: ${postsSkippedDuplicateCount}, Recent authors: ${recentAuthorsDetectedCount}`,\n  );\n  backgroundLog(\n    `Loaded ${commentedAuthorsWithTimestamps.size} authors with timestamps and ${commentedAuthors.size} authors for today`,\n  );\n  backgroundLog(\n    `Loaded counters - Posts skipped: ${postsSkippedDuplicateCount}, Recent authors: ${recentAuthorsDetectedCount}`,\n  );\n\n  try {\n    console.log(`Starting new commenting flow with max ${maxPosts} posts...`);\n    backgroundLog(`Starting new commenting flow with max ${maxPosts} posts...`);\n\n    // Step 1: Scroll down for specified duration to load posts\n    console.log(`üìú Step 1: Scrolling feed for ${scrollDuration} seconds...`);\n    backgroundLog(`üìú Step 1: Scrolling feed for ${scrollDuration} seconds...`);\n    await scrollFeedToLoadPosts(scrollDuration, statusPanel);\n\n    // IMPORTANT: Only move to original tab AFTER scrolling is completely finished\n    console.log(\n      \"üìú Step 1.5: Scrolling completed, now moving back to original tab...\",\n    );\n    backgroundLog(\n      \"üìú Step 1.5: Scrolling completed, now moving back to original tab...\",\n    );\n    chrome.runtime.sendMessage({\n      action: \"moveToOriginalTab\",\n    });\n\n    // Wait a moment for tab switch to complete\n    await wait(2000);\n\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Commenting stopped during scroll phase\");\n      backgroundLog(\"‚ùå Commenting stopped during scroll phase\");\n      stopTabActiveAudio();\n      return;\n    }\n\n    // Step 2: Scroll back to top\n    console.log(\"üìú Step 2: Scrolling back to top...\");\n    backgroundLog(\"üìú Step 2: Scrolling back to top...\");\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n    await wait(2000);\n\n    // Update overlay status after scrolling is complete (if overlay elements exist)\n    if (overlay && startButton && subtitle) {\n      startButton.textContent =\n        \"‚úÖ Posts loaded! You can now move away from this tab\";\n      startButton.style.background = \"#28a745\";\n      startButton.style.fontSize = \"20px\";\n      subtitle.textContent =\n        \"All posts have been loaded. Switching to automation mode...\";\n\n      // Wait a moment to show the message, then remove overlay\n      await wait(3000);\n      overlay.remove();\n      backgroundLog(\"üìú üé≠ Overlay removed after successful post loading\");\n    }\n\n    if (!isCommentingActive) {\n      console.log(\"‚ùå Commenting stopped during scroll to top\");\n      backgroundLog(\"‚ùå Commenting stopped during scroll to top\");\n      stopTabActiveAudio();\n      return;\n    }\n\n    // Step 3: Find all posts and process them\n    console.log(\"üìú Step 3: Processing all posts on feed...\");\n    console.log(`   - maxPosts parameter: ${maxPosts}`);\n    console.log(`   - commentDelay parameter: ${commentDelay}`);\n    console.log(\n      `   - isCommentingActive before processing: ${isCommentingActive}`,\n    );\n    backgroundLog(\n      `üìú Step 3: Processing all posts on feed... maxPosts: ${maxPosts}, commentDelay: ${commentDelay}, isCommentingActive: ${isCommentingActive}`,\n    );\n\n    await processAllPostsOnFeed(commentDelay, maxPosts, duplicateWindow);\n\n    console.log(`üìú Step 3 completed. Final state:`);\n    console.log(`   - isCommentingActive: ${isCommentingActive}`);\n    backgroundLog(\n      `üìú Step 3 completed. Final isCommentingActive: ${isCommentingActive}`,\n    );\n\n    // Stop anti-throttling mechanisms\n    stopTabActiveAudio();\n\n    // Only notify completion if we weren't stopped\n    if (isCommentingActive) {\n      console.log(\"üèÅ Sending completion message to background script...\");\n      backgroundLog(\"üèÅ Sending completion message to background script...\");\n      chrome.runtime.sendMessage({\n        action: \"commentingCompleted\",\n      });\n    } else {\n      console.log(\n        \"üõë Not sending completion message because commenting was stopped\",\n      );\n      backgroundLog(\n        \"üõë Not sending completion message because commenting was stopped\",\n      );\n    }\n  } catch (error) {\n    console.error(\"üí• Error in new commenting flow:\", error);\n    backgroundError(\"üí• Error in new commenting flow:\", error);\n    isCommentingActive = false;\n    stopTabActiveAudio();\n  }\n}\n\n// Helper function to request notification permission for anti-throttling\nasync function requestNotificationPermissionForAntiThrottling(): Promise<boolean> {\n  try {\n    if (!(\"Notification\" in window)) {\n      backgroundLog(\"üìú üîî Notifications not supported in this browser\");\n      return false;\n    }\n\n    if (Notification.permission === \"granted\") {\n      backgroundLog(\"üìú üîî Notification permission already granted\");\n      return true;\n    }\n\n    if (Notification.permission === \"denied\") {\n      backgroundLog(\"üìú üîî Notification permission previously denied\");\n      return false;\n    }\n\n    // Request notification permission\n    const permission = await Notification.requestPermission();\n\n    if (permission === \"granted\") {\n      backgroundLog(\n        \"üìú üîî ‚úÖ Notification permission granted - should help with anti-throttling\",\n      );\n\n      // Show a brief notification to confirm it works\n      new Notification(\"EngageKit\", {\n        body: \"Notification permission granted for better performance\",\n        icon: \"https://static.licdn.com/sc/h/3m6veb8kxx0k7v4c6u7q6z8hm\",\n        silent: true,\n      });\n\n      return true;\n    } else {\n      backgroundLog(\"üìú üîî ‚ùå Notification permission denied\");\n      return false;\n    }\n  } catch (error) {\n    backgroundWarn(\n      \"üìú üîî ‚ö†Ô∏è Failed to request notification permission:\",\n      error,\n    );\n    return false;\n  }\n}\n\n// Helper function to force LinkedIn to think tab is active\nasync function forceTabActiveState() {\n  try {\n    // Step 1: Request notification permission for anti-throttling\n    await requestNotificationPermissionForAntiThrottling();\n\n    // Step 2: Override document.hidden and document.visibilityState\n    Object.defineProperty(document, \"hidden\", {\n      value: false,\n      writable: false,\n    });\n\n    Object.defineProperty(document, \"visibilityState\", {\n      value: \"visible\",\n      writable: false,\n    });\n\n    // Step 3: Override document.hasFocus to return true\n    const originalHasFocus = document.hasFocus;\n    document.hasFocus = function () {\n      return true;\n    };\n\n    // Step 4: Prevent visibility change events\n    const originalAddEventListener = document.addEventListener;\n    document.addEventListener = function (\n      type: string,\n      listener: EventListenerOrEventListenerObject | null,\n      options?: boolean | AddEventListenerOptions,\n    ) {\n      if (type === \"visibilitychange\") {\n        // Don't add visibility change listeners\n        return;\n      }\n      if (listener === null) {\n        return;\n      }\n      return originalAddEventListener.call(this, type, listener, options);\n    };\n\n    backgroundLog(\"üìú üé≠ Applied comprehensive tab active state spoofing\");\n  } catch (error) {\n    backgroundWarn(\"üìú ‚ö†Ô∏è Failed to apply tab active state spoofing:\", error);\n  }\n}\n\n// Helper function to manually trigger LinkedIn's content loading\nfunction forceTriggerLinkedInLoading() {\n  try {\n    // Trigger visibility change event to \"visible\"\n    const visibilityEvent = new Event(\"visibilitychange\", { bubbles: true });\n    document.dispatchEvent(visibilityEvent);\n\n    // Trigger focus events\n    const focusEvent = new Event(\"focus\", { bubbles: true });\n    window.dispatchEvent(focusEvent);\n    document.dispatchEvent(focusEvent);\n\n    // Trigger page show event\n    const pageShowEvent = new PageTransitionEvent(\"pageshow\", {\n      bubbles: true,\n      persisted: false,\n    });\n    window.dispatchEvent(pageShowEvent);\n\n    // PRIORITY: Click LinkedIn's infinite scroll load button\n    const infiniteScrollButton = document.querySelector(\n      \".scaffold-finite-scroll__load-button\",\n    ) as HTMLButtonElement;\n    if (infiniteScrollButton && !infiniteScrollButton.disabled) {\n      infiniteScrollButton.click();\n      backgroundLog(\n        \"üìú üéØ Clicked LinkedIn infinite scroll load button (.scaffold-finite-scroll__load-button)\",\n      );\n    } else if (infiniteScrollButton && infiniteScrollButton.disabled) {\n      backgroundLog(\"üìú ‚ö†Ô∏è Infinite scroll button found but disabled\");\n    } else {\n      backgroundLog(\n        \"üìú ‚ÑπÔ∏è No infinite scroll button found (.scaffold-finite-scroll__load-button)\",\n      );\n    }\n  } catch (error) {\n    backgroundWarn(\"üìú ‚ö†Ô∏è Failed to trigger LinkedIn loading:\", error);\n  }\n}\n\n// Helper function to manually trigger scroll events for better LinkedIn compatibility\nfunction triggerScrollEvents() {\n  try {\n    // Create scroll event (following the 10-year-old solution approach)\n    const scrollEvent = new Event(\"scroll\", {\n      bubbles: true,\n      cancelable: true,\n    });\n\n    // Method 1: Traditional window/document events\n    window.dispatchEvent(scrollEvent);\n    document.dispatchEvent(scrollEvent);\n\n    // Method 2: Target LinkedIn's specific feed containers (key insight from old solution)\n    const linkedInFeedSelectors = [\n      \".scaffold-layout__main\", // Main content area\n      \".feed-container-theme\", // Feed container\n      \".scaffold-finite-scroll\", // Infinite scroll container\n      \".feed-shared-update-v2\", // Individual post containers\n      \".application-outlet\", // Main app container\n      \".feed-outlet\", // Feed outlet\n      \"#main\", // Main element\n      '[role=\"main\"]', // ARIA main role\n      \".ember-application\", // Ember app container\n    ];\n\n    // Dispatch scroll events to each LinkedIn container we can find\n    linkedInFeedSelectors.forEach((selector) => {\n      const elements = document.querySelectorAll(selector);\n      elements.forEach((element) => {\n        if (element) {\n          element.dispatchEvent(scrollEvent);\n          backgroundLog(`üìú üéØ Triggered scroll event on: ${selector}`);\n        }\n      });\n    });\n\n    // Method 3: Also trigger wheel events (some sites listen for these)\n    const wheelEvent = new WheelEvent(\"wheel\", {\n      bubbles: true,\n      cancelable: true,\n      deltaY: 100,\n      deltaMode: WheelEvent.DOM_DELTA_PIXEL,\n    });\n    window.dispatchEvent(wheelEvent);\n\n    // Trigger wheel events on main containers too\n    const mainContainer = document.querySelector(\n      \".scaffold-layout__main, .feed-container-theme\",\n    );\n    if (mainContainer) {\n      mainContainer.dispatchEvent(wheelEvent);\n      backgroundLog(\"üìú üéØ Triggered wheel event on main LinkedIn container\");\n    }\n  } catch (error) {\n    backgroundWarn(\"üìú ‚ö†Ô∏è Failed to trigger scroll events:\", error);\n  }\n}\n\n// Function to scroll feed and load posts - Aggressive scrolling to bottom\nasync function scrollFeedToLoadPosts(\n  duration: number,\n  statusPanel?: HTMLDivElement,\n): Promise<void> {\n  console.log(\n    `Aggressively scrolling feed for ${duration} seconds to load posts...`,\n  );\n  backgroundLog(\n    `üìú Starting aggressive scroll-to-bottom for ${duration} seconds...`,\n  );\n\n  // Apply tab active state spoofing immediately\n  await forceTabActiveState();\n\n  const startTime = Date.now();\n  const endTime = startTime + duration * 1000;\n\n  // Track metrics for debugging\n  let scrollAttempts = 0;\n  let postCountBefore = 0;\n  let lastPostCount = 0;\n\n  // Get initial post count\n  const initialPosts = document.querySelectorAll(\n    \".feed-shared-update-v2__control-menu-container\",\n  );\n  postCountBefore = initialPosts.length;\n  lastPostCount = postCountBefore;\n  backgroundLog(`üìú Initial post count: ${postCountBefore}`);\n\n  // Use aggressive scrolling - just go to bottom repeatedly\n  const pauseBetweenScrolls = 2000; // 2 second pause to allow content loading\n\n  while (Date.now() < endTime && isCommentingActive) {\n    // Check if we should stop\n    if (!isCommentingActive) {\n      backgroundLog(\"‚ùå Stopping scroll due to stop signal\");\n      break;\n    }\n\n    const currentTime = Date.now();\n    const timeRemaining = Math.round((endTime - currentTime) / 1000);\n    backgroundLog(\n      `üìú Aggressive scroll attempt ${\n        scrollAttempts + 1\n      }, ${timeRemaining}s remaining`,\n    );\n\n    // Update status panel if available\n    if (statusPanel) {\n      const currentPosts = document.querySelectorAll(\n        \".feed-shared-update-v2__control-menu-container\",\n      ).length;\n      const newPostsThisSession = currentPosts - postCountBefore;\n\n      const timeRemainingElement = statusPanel.querySelector(\n        \"#time-remaining span\",\n      );\n      const postsLoadedElement =\n        statusPanel.querySelector(\"#posts-loaded span\");\n      const scrollProgressElement = statusPanel.querySelector(\n        \"#scroll-progress span\",\n      );\n\n      if (timeRemainingElement) {\n        timeRemainingElement.textContent = `${timeRemaining}s`;\n      }\n\n      if (postsLoadedElement) {\n        postsLoadedElement.textContent = `${currentPosts} posts (+${newPostsThisSession} this session)`;\n      }\n\n      if (scrollProgressElement) {\n        scrollProgressElement.textContent = `Scroll attempt ${\n          scrollAttempts + 1\n        } - Loading content...`;\n      }\n    }\n\n    scrollAttempts++;\n\n    // Record current scroll position\n    const beforeScroll = window.scrollY;\n    const documentHeight = document.body.scrollHeight;\n\n    // Aggressive scroll: Go straight to bottom\n    window.scrollTo({ top: documentHeight, behavior: \"smooth\" });\n\n    // Trigger scroll events on LinkedIn's specific containers\n    triggerScrollEvents();\n\n    // Wait for scroll to complete and content to load\n    await wait(pauseBetweenScrolls);\n\n    const afterScroll = window.scrollY;\n    const newDocumentHeight = document.body.scrollHeight;\n\n    backgroundLog(\n      `üìú Scrolled from ${beforeScroll} to ${afterScroll}, doc height: ${documentHeight} ‚Üí ${newDocumentHeight}`,\n    );\n\n    // Check for new content after each scroll\n    const currentPosts = document.querySelectorAll(\n      \".feed-shared-update-v2__control-menu-container\",\n    );\n    const newPostCount = currentPosts.length;\n\n    if (newPostCount > lastPostCount) {\n      const newPosts = newPostCount - lastPostCount;\n      backgroundLog(\n        `üìú ‚úÖ Content loaded! Found ${newPosts} new posts (total: ${newPostCount})`,\n      );\n      lastPostCount = newPostCount;\n\n      // Update status panel with success indicator\n      if (statusPanel) {\n        const scrollProgressElement = statusPanel.querySelector(\n          \"#scroll-progress span\",\n        );\n        if (scrollProgressElement) {\n          scrollProgressElement.textContent = `‚úÖ Loaded ${newPosts} new posts! (Total: ${newPostCount})`;\n        }\n      }\n    } else {\n      backgroundLog(\n        `üìú ‚ö†Ô∏è No new posts detected. Still at ${newPostCount} posts`,\n      );\n\n      // Update status panel with no new content indicator\n      if (statusPanel) {\n        const scrollProgressElement = statusPanel.querySelector(\n          \"#scroll-progress span\",\n        );\n        if (scrollProgressElement) {\n          scrollProgressElement.textContent = `‚è≥ Waiting for new content... (${newPostCount} posts)`;\n        }\n      }\n    }\n\n    // Apply anti-throttling techniques periodically\n    if (scrollAttempts % 3 === 0) {\n      await forceTabActiveState();\n      forceTriggerLinkedInLoading();\n      backgroundLog(`üìú üé≠ Reapplied anti-throttling techniques`);\n\n      // Update status panel with anti-throttling indicator\n      if (statusPanel) {\n        const scrollProgressElement = statusPanel.querySelector(\n          \"#scroll-progress span\",\n        );\n        if (scrollProgressElement) {\n          scrollProgressElement.textContent = `üé≠ Applied anti-throttling techniques`;\n        }\n      }\n    }\n\n    // If document height didn't change, we might be done\n    if (\n      newDocumentHeight === documentHeight &&\n      newPostCount === lastPostCount\n    ) {\n      backgroundLog(\n        `üìú üìä No height or post changes detected - continuing for full duration`,\n      );\n    }\n  }\n\n  // Final status update\n  if (statusPanel) {\n    const finalPosts = document.querySelectorAll(\n      \".feed-shared-update-v2__control-menu-container\",\n    );\n    const totalNewPosts = finalPosts.length - postCountBefore;\n\n    const timeRemainingElement = statusPanel.querySelector(\n      \"#time-remaining span\",\n    );\n    const scrollProgressElement = statusPanel.querySelector(\n      \"#scroll-progress span\",\n    );\n\n    if (timeRemainingElement) {\n      timeRemainingElement.textContent = `0s - COMPLETE!`;\n    }\n\n    if (scrollProgressElement) {\n      scrollProgressElement.textContent = `üéâ Scrolling complete! Loaded ${totalNewPosts} new posts`;\n    }\n  }\n\n  // Final metrics\n  const finalPosts = document.querySelectorAll(\n    \".feed-shared-update-v2__control-menu-container\",\n  );\n  const totalNewPosts = finalPosts.length - initialPosts.length;\n  const actualDuration = Math.round((Date.now() - startTime) / 1000);\n\n  console.log(\"Finished aggressive scrolling to load posts\");\n  backgroundLog(\n    `üìú Aggressive scroll completed! Duration: ${actualDuration}s, Scroll attempts: ${scrollAttempts}, New posts loaded: ${totalNewPosts} (${initialPosts.length} ‚Üí ${finalPosts.length})`,\n  );\n\n  // Alert if we didn't load many posts\n  if (totalNewPosts < 15 && actualDuration > 15) {\n    backgroundWarn(\n      `üìú ‚ö†Ô∏è Only loaded ${totalNewPosts} posts in ${actualDuration}s. LinkedIn might be throttling or has limited content.`,\n    );\n  } else if (totalNewPosts >= 20) {\n    backgroundLog(\n      `üìú üéâ Excellent! Loaded ${totalNewPosts} posts using aggressive scrolling.`,\n    );\n  }\n}\n\n// Function to process all posts on the feed\nasync function processAllPostsOnFeed(\n  commentDelay: number,\n  maxPosts: number,\n  duplicateWindow: number,\n): Promise<void> {\n  console.group(\"üéØ PROCESSING ALL POSTS - DETAILED DEBUG\");\n  backgroundGroup(\"üéØ PROCESSING ALL POSTS - DETAILED DEBUG\");\n  console.log(\n    `üéØ Starting to process posts on feed (max ${maxPosts} posts)...`,\n  );\n  backgroundLog(\n    `üéØ Starting to process posts on feed (max ${maxPosts} posts)...`,\n  );\n\n  // Find all post containers using the top-level div[data-id] structure\n  const postContainers = document.querySelectorAll(\"div[data-id]\");\n  console.log(\n    `üéØ Found ${postContainers.length} post containers with selector: div[data-id]`,\n  );\n  backgroundLog(\n    `üéØ Found ${postContainers.length} post containers with selector: div[data-id]`,\n  );\n\n  // Let's also try alternative selectors to see what we find\n  const altSelector1 = document.querySelectorAll(\".feed-shared-update-v2\");\n  const altSelector2 = document.querySelectorAll(\n    '[data-urn*=\"urn:li:activity\"]',\n  );\n  const altSelector3 = document.querySelectorAll(\n    \".feed-shared-update-v2__content\",\n  );\n\n  console.log(`üéØ Alternative selector results:`);\n  console.log(`   - .feed-shared-update-v2: ${altSelector1.length} elements`);\n  console.log(\n    `   - [data-urn*=\"urn:li:activity\"]: ${altSelector2.length} elements`,\n  );\n  console.log(\n    `   - .feed-shared-update-v2__content: ${altSelector3.length} elements`,\n  );\n  backgroundLog(\n    `üéØ Alternative selector results: .feed-shared-update-v2: ${altSelector1.length}, [data-urn*=\"urn:li:activity\"]: ${altSelector2.length}, .feed-shared-update-v2__content: ${altSelector3.length}`,\n  );\n\n  if (postContainers.length === 0) {\n    console.error(\n      \"üö® NO POSTS FOUND! This is why the automation stops immediately.\",\n    );\n    console.error(\n      \"üö® The page might not be fully loaded or the selector is wrong.\",\n    );\n    backgroundError(\n      \"üö® NO POSTS FOUND! This is why the automation stops immediately.\",\n    );\n    backgroundError(\n      \"üö® The page might not be fully loaded or the selector is wrong.\",\n    );\n    console.groupEnd();\n    backgroundGroupEnd();\n    return;\n  }\n\n  let commentCount = 0;\n  console.log(\n    `üéØ Starting loop: commentCount=${commentCount}, maxPosts=${maxPosts}, isActive=${isCommentingActive}`,\n  );\n  backgroundLog(\n    `üéØ Starting loop: commentCount=${commentCount}, maxPosts=${maxPosts}, isActive=${isCommentingActive}`,\n  );\n\n  for (\n    let i = 0;\n    i < postContainers.length && isCommentingActive && commentCount < maxPosts;\n    i++\n  ) {\n    console.group(\n      `üîÑ POST ${i + 1}/${postContainers.length} - DETAILED PROCESSING`,\n    );\n    console.log(`üîÑ Loop iteration ${i + 1}:`);\n    console.log(`   - commentCount: ${commentCount}/${maxPosts}`);\n    console.log(`   - isCommentingActive: ${isCommentingActive}`);\n    console.log(\n      `   - Loop condition: i(${i}) < postContainers.length(${\n        postContainers.length\n      }) = ${i < postContainers.length}`,\n    );\n    console.log(\n      `   - Active condition: isCommentingActive = ${isCommentingActive}`,\n    );\n    console.log(\n      `   - Count condition: commentCount(${commentCount}) < maxPosts(${maxPosts}) = ${\n        commentCount < maxPosts\n      }`,\n    );\n    console.log(\n      `   - Overall loop should continue: ${\n        i < postContainers.length &&\n        isCommentingActive &&\n        commentCount < maxPosts\n      }`,\n    );\n\n    // Check if we should stop at the beginning of each iteration\n    if (!isCommentingActive) {\n      console.log(\"‚ùå STOPPING: isCommentingActive became false\");\n      console.groupEnd();\n      break;\n    }\n\n    const postContainer = postContainers[i] as HTMLElement;\n\n    try {\n      console.log(\n        `üîç Processing post ${i + 1}/${\n          postContainers.length\n        } (commented: ${commentCount}/${maxPosts})`,\n      );\n\n      // Scroll to the post\n      postContainer.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      await wait(1000);\n\n      // Check again after scroll\n      if (!isCommentingActive) {\n        console.log(\n          \"‚ùå STOPPING: isCommentingActive became false after scroll\",\n        );\n        console.groupEnd();\n        break;\n      }\n\n      // STEP 1: Check for post URN duplicates (if we've already commented on this specific post)\n      const postUrns = extractPostUrns(postContainer);\n      if (postUrns.length === 0) {\n        console.log(`‚è≠Ô∏è SKIPPING post ${i + 1} - could not extract post URNs`);\n        console.groupEnd();\n        continue;\n      }\n\n      // Check if we've commented on any of these URNs before\n      let hasCommentedOnThisPost = false;\n      for (const urn of postUrns) {\n        if (hasCommentedOnPostUrn(urn)) {\n          console.log(\n            `‚è≠Ô∏è SKIPPING post ${i + 1} - already commented on post URN: ${urn}`,\n          );\n          hasCommentedOnThisPost = true;\n          break;\n        }\n      }\n\n      if (hasCommentedOnThisPost) {\n        // Update the post already commented counter\n        await updatePostAlreadyCommentedCounter();\n        console.groupEnd();\n        continue;\n      }\n\n      // STEP 2: Check for author duplicate (within time window)\n      const authorInfo = extractAuthorInfo(postContainer);\n      if (!authorInfo) {\n        console.log(\n          `‚è≠Ô∏è SKIPPING post ${i + 1} - could not extract author info`,\n        );\n        console.groupEnd();\n        continue;\n      }\n\n      // Check if we've commented on this author within the time window\n      if (\n        hasCommentedOnAuthorRecently(\n          authorInfo.name,\n          commentedAuthorsWithTimestamps,\n          duplicateWindow,\n        )\n      ) {\n        console.log(\n          `‚è≠Ô∏è SKIPPING post ${i + 1} - already commented on ${\n            authorInfo.name\n          } within ${duplicateWindow} hours`,\n        );\n\n        // Update counters\n        await updateSkippedPostCounter();\n\n        console.groupEnd();\n        continue;\n      }\n\n      // Extract post content\n      const postContent = extractPostContent(postContainer);\n      if (!postContent) {\n        console.log(\n          `‚è≠Ô∏è SKIPPING post ${i + 1} - could not extract post content`,\n        );\n        console.groupEnd();\n        continue;\n      }\n\n      const postAuthorContent = authorInfo.name + postContent;\n\n      console.log(\n        `üìù Post content preview: ${postContent.substring(0, 100)}...`,\n      );\n\n      // Check again before generating comment\n      if (!isCommentingActive) {\n        console.log(\n          \"‚ùå STOPPING: isCommentingActive became false before comment generation\",\n        );\n        console.groupEnd();\n        break;\n      }\n\n      // Generate comment using background script\n      console.log(`ü§ñ Generating comment for post ${i + 1}...`);\n      const comment = await generateComment(postAuthorContent);\n      console.log(\n        `ü§ñ Comment generation result for post ${i + 1}:`,\n        comment ? \"SUCCESS\" : \"FAILED\",\n      );\n\n      if (!comment) {\n        console.log(`‚ùå SKIPPING post ${i + 1} - could not generate comment`);\n        console.groupEnd();\n        continue;\n      }\n\n      console.log(\n        `‚úÖ Generated comment for post ${i + 1}:`,\n        comment.substring(0, 50) + \"...\",\n      );\n\n      // Check again before posting comment\n      if (!isCommentingActive) {\n        console.log(\n          \"‚ùå STOPPING: isCommentingActive became false before posting comment\",\n        );\n        console.groupEnd();\n        break;\n      }\n\n      // Post the comment\n      console.log(\n        `üìù Attempting to post comment on post ${i + 1} by ${\n          authorInfo.name\n        }...`,\n      );\n      const success = await postCommentOnPost(\n        postContainer,\n        comment,\n        isCommentingActive,\n      );\n      console.log(\n        `üìù Comment posting result for post ${i + 1}: ${\n          success ? \"SUCCESS\" : \"FAILED\"\n        }`,\n      );\n\n      if (success) {\n        commentCount++;\n        commentedAuthors.add(authorInfo.name);\n\n        // Save author with timestamp and update counts\n        await saveCommentedAuthor(authorInfo.name); // for backward compatibility\n        await saveCommentedAuthorWithTimestamp(authorInfo.name); // new timestamp-based storage\n        commentedAuthorsWithTimestamps.set(authorInfo.name, Date.now()); // update in-memory data\n\n        // Save all post URNs to prevent commenting on this post again\n        for (const urn of postUrns) {\n          await saveCommentedPostUrn(urn);\n        }\n\n        await updateCommentCounts();\n\n        console.log(\n          `üéâ Successfully posted comment ${commentCount}/${maxPosts} on post by ${authorInfo.name}`,\n        );\n        backgroundLog(\n          `üéâ Successfully posted comment ${commentCount}/${maxPosts} on post by ${authorInfo.name}`,\n        );\n        console.group(`üìä Progress Update After Successful Comment`);\n        console.log(\n          `Comments posted this session: ${commentCount}/${maxPosts}`,\n        );\n        console.log(\n          `Authors commented on today:`,\n          Array.from(commentedAuthors),\n        );\n        console.log(\n          `Remaining posts to process: ${postContainers.length - i - 1}`,\n        );\n        console.log(\n          `Should continue? commentCount(${commentCount}) < maxPosts(${maxPosts}) = ${\n            commentCount < maxPosts\n          }`,\n        );\n        console.log(\n          `Next iteration will be: ${i + 1} < ${postContainers.length} = ${\n            i + 1 < postContainers.length\n          }`,\n        );\n        backgroundLog(\n          `üìä Progress Update: ${commentCount}/${maxPosts} comments posted. Remaining posts: ${\n            postContainers.length - i - 1\n          }. Should continue: ${commentCount < maxPosts}`,\n        );\n        console.groupEnd();\n\n        // Update background script with progress\n        chrome.runtime.sendMessage({\n          action: \"updateCommentCount\",\n          count: commentCount,\n          status: `Posted comment ${commentCount}/${maxPosts} on post by ${authorInfo.name}`,\n        });\n\n        // Check if we've reached the max posts limit\n        if (commentCount >= maxPosts) {\n          console.log(\n            `‚úÖ REACHED MAX POSTS LIMIT: commentCount(${commentCount}) >= maxPosts(${maxPosts}). Stopping...`,\n          );\n          backgroundLog(\n            `‚úÖ REACHED MAX POSTS LIMIT: commentCount(${commentCount}) >= maxPosts(${maxPosts}). Stopping...`,\n          );\n          console.groupEnd();\n          break;\n        }\n\n        // Wait between comments with stop checking\n        if (i < postContainers.length - 1 && commentCount < maxPosts) {\n          console.log(\n            `‚è≥ Waiting ${commentDelay} seconds before next comment...`,\n          );\n          console.log(\n            `‚è≥ Delay conditions: i(${i}) < postContainers.length-1(${\n              postContainers.length - 1\n            }) = ${i < postContainers.length - 1}`,\n          );\n          console.log(\n            `‚è≥ Delay conditions: commentCount(${commentCount}) < maxPosts(${maxPosts}) = ${\n              commentCount < maxPosts\n            }`,\n          );\n\n          // Break the delay into smaller chunks to check for stop signal\n          const delayChunks = Math.ceil(commentDelay);\n          for (\n            let chunk = 0;\n            chunk < delayChunks && isCommentingActive;\n            chunk++\n          ) {\n            await wait(1000);\n            if (!isCommentingActive) {\n              console.log(\n                \"‚ùå STOPPING during comment delay due to stop signal\",\n              );\n              console.groupEnd();\n              break;\n            }\n          }\n\n          if (!isCommentingActive) {\n            console.groupEnd();\n            break;\n          }\n\n          console.log(`‚úÖ Delay completed, continuing to next post...`);\n        } else {\n          console.log(\n            `üîö No delay needed - this was the last post or we've reached max comments`,\n          );\n          console.log(\n            `   - i(${i}) < postContainers.length-1(${\n              postContainers.length - 1\n            }): ${i < postContainers.length - 1}`,\n          );\n          console.log(\n            `   - commentCount(${commentCount}) < maxPosts(${maxPosts}): ${\n              commentCount < maxPosts\n            }`,\n          );\n        }\n      } else {\n        console.log(\n          `‚ùå Failed to post comment on post ${i + 1} by ${authorInfo.name}`,\n        );\n      }\n\n      console.groupEnd();\n    } catch (error) {\n      console.error(`üí• Error processing post ${i + 1}:`, error);\n      console.groupEnd();\n    }\n\n    // Debug the next iteration conditions\n    console.log(`üîÑ End of iteration ${i + 1}. Next iteration check:`);\n    console.log(`   - Next i will be: ${i + 1}`);\n    console.log(`   - postContainers.length: ${postContainers.length}`);\n    console.log(`   - isCommentingActive: ${isCommentingActive}`);\n    console.log(`   - commentCount: ${commentCount}`);\n    console.log(`   - maxPosts: ${maxPosts}`);\n    console.log(\n      `   - Loop will continue: ${\n        i + 1 < postContainers.length &&\n        isCommentingActive &&\n        commentCount < maxPosts\n      }`,\n    );\n  }\n\n  console.log(`üèÅ LOOP COMPLETED. Final stats:`);\n  console.log(`   - Posted ${commentCount}/${maxPosts} comments total`);\n  console.log(`   - Final isCommentingActive: ${isCommentingActive}`);\n  console.log(`   - Processed ${postContainers.length} total posts`);\n  console.log(`   - Loop exit reason analysis:`);\n  console.log(`     - Reached max posts? ${commentCount >= maxPosts}`);\n  console.log(`     - Lost active status? ${!isCommentingActive}`);\n  console.log(`     - Ran out of posts? ${postContainers.length === 0}`);\n  backgroundLog(\n    `üèÅ LOOP COMPLETED. Final stats: Posted ${commentCount}/${maxPosts} comments total. Final isCommentingActive: ${isCommentingActive}. Processed ${postContainers.length} total posts.`,\n  );\n  backgroundLog(\n    `üèÅ Loop exit reason: Reached max posts? ${\n      commentCount >= maxPosts\n    }, Lost active status? ${!isCommentingActive}, Ran out of posts? ${\n      postContainers.length === 0\n    }`,\n  );\n  console.groupEnd();\n  backgroundGroupEnd();\n}\n\n// Function to parse time strings like \"15h\", \"5m\", \"2d\" into hours\nfunction parseTimeStringToHours(timeStr: string): number | null {\n  if (!timeStr || typeof timeStr !== \"string\") {\n    return null;\n  }\n\n  // Remove any extra whitespace and convert to lowercase\n  const cleaned = timeStr.trim().toLowerCase();\n\n  // Handle \"Promoted\" posts\n  if (cleaned === \"promoted\" || cleaned.includes(\"promoted\")) {\n    return null;\n  }\n\n  // Extract number and unit using regex\n  const match = cleaned.match(/^(\\d+)([mhdw])$/);\n  if (!match) {\n    console.log(`Could not parse time string: \"${timeStr}\"`);\n    return null;\n  }\n\n  const [, numberStr, unit] = match;\n  const number = parseInt(numberStr, 10);\n\n  if (isNaN(number)) {\n    return null;\n  }\n\n  // Convert to hours\n  switch (unit) {\n    case \"m\": // minutes\n      return number / 60;\n    case \"h\": // hours\n      return number;\n    case \"d\": // days\n      return number * 24;\n    case \"w\": // weeks\n      return number * 24 * 7;\n    default:\n      return null;\n  }\n}\n\n// Function to extract post time from post container\nfunction extractPostTime(postContainer: HTMLElement): number | null {\n  try {\n    // Look for the time span with the specific classes\n    const timeSpan = postContainer.querySelector(\n      \".update-components-actor__sub-description.text-body-xsmall\",\n    );\n\n    if (!timeSpan || !timeSpan.textContent) {\n      console.log(\"Time span not found or has no text content\");\n      return null;\n    }\n\n    const timeText = timeSpan.textContent.trim();\n    console.log(`Found time text: \"${timeText}\"`);\n\n    return parseTimeStringToHours(timeText);\n  } catch (error) {\n    console.error(\"Error extracting post time:\", error);\n    return null;\n  }\n}\n\n// Function to update time filter skipped counter\nasync function updateTimeFilterSkippedCounter(): Promise<void> {\n  postsSkippedTimeFilterCount++;\n\n  return new Promise((resolve) => {\n    chrome.storage.local.set(\n      {\n        postsSkippedTimeFilter: postsSkippedTimeFilterCount,\n      },\n      () => {\n        console.log(\n          `Updated time filter skipped counter: ${postsSkippedTimeFilterCount}`,\n        );\n\n        // Send real-time update to popup\n        chrome.runtime.sendMessage({\n          action: \"realTimeCountUpdate\",\n          postsSkippedTimeFilterCount: postsSkippedTimeFilterCount,\n        });\n\n        resolve();\n      },\n    );\n  });\n}\n\n// Function to extract author info from post container\nfunction extractAuthorInfo(\n  postContainer: HTMLElement,\n): { name: string } | null {\n  try {\n    // Look for author container within the post\n    const authorContainer = postContainer.querySelector(\n      \".update-components-actor__container\",\n    );\n    if (!authorContainer) {\n      console.log(\"Author container not found\");\n      return null;\n    }\n\n    // Try different selectors for author name\n    const nameSelectors = [\n      '.update-components-actor__title span[dir=\"ltr\"] span[aria-hidden=\"true\"]',\n      '.update-components-actor__title span[aria-hidden=\"true\"]',\n      \".update-components-actor__title\",\n      \".update-components-actor__name\",\n    ];\n\n    for (const selector of nameSelectors) {\n      const nameElement = authorContainer.querySelector(selector);\n      if (nameElement && nameElement.textContent) {\n        const name = nameElement.textContent\n          .replace(/<!---->/g, \"\")\n          .trim()\n          .split(\"‚Ä¢\")[0]\n          .trim();\n        if (name) {\n          console.log(`Extracted author name: ${name}`);\n          return { name };\n        }\n      }\n    }\n\n    console.log(\"Could not extract author name\");\n    return null;\n  } catch (error) {\n    console.error(\"Error extracting author info:\", error);\n    return null;\n  }\n}\n\n// Function to extract post content from post container\nfunction extractPostContent(postContainer: HTMLElement): string {\n  try {\n    // Look for the content container within the post\n    // const contentContainer = postContainer.querySelector('.fie-impression-container');\n    const contentContainer = postContainer.querySelector(\n      \".feed-shared-inline-show-more-text\",\n    );\n    if (!contentContainer) {\n      console.log(\"Content container not found\");\n      return \"\";\n    }\n\n    // Extract text content recursively\n    function extractText(node: Node): string {\n      let text = \"\";\n      node.childNodes.forEach((child) => {\n        if (child.nodeType === Node.TEXT_NODE) {\n          text += child.textContent?.trim() + \" \";\n        } else if (child.nodeType === Node.ELEMENT_NODE) {\n          text += extractText(child);\n        }\n      });\n      return text;\n    }\n\n    const content = extractText(contentContainer).replace(/\\s+/g, \" \").trim();\n    console.log(`Extracted post content: ${content.substring(0, 100)}...`);\n    return content;\n  } catch (error) {\n    console.error(\"Error extracting post content:\", error);\n    return \"\";\n  }\n}\n\n\nfunction stopTabActiveAudio() {\n  try {\n    console.log(\"üîá Stopping continuous audio...\");\n\n    if (currentOscillator) {\n      currentOscillator.stop();\n      currentOscillator = null;\n    }\n\n    if (audioElement) {\n      audioElement.pause();\n      audioElement.remove();\n      audioElement = null;\n    }\n\n    if (audioContext && audioContext.state !== \"closed\") {\n      audioContext.close();\n      audioContext = null;\n    }\n\n    console.log(\"üîá Continuous audio stopped\");\n  } catch (error) {\n    console.warn(\"‚ö†Ô∏è Error stopping audio:\", error);\n  }\n}\n\n// Function to clean up old timestamp entries (older than 7 days)\nasync function cleanupOldTimestamps(): Promise<void> {\n  const storageKey = \"commented_authors_timestamps\";\n  const sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;\n  const now = Date.now();\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([storageKey], (result) => {\n      const authorTimestamps = result[storageKey] || {};\n      const cleanedTimestamps: { [key: string]: number } = {};\n\n      let removedCount = 0;\n      for (const [authorName, timestamp] of Object.entries(authorTimestamps)) {\n        if (typeof timestamp === \"number\" && now - timestamp < sevenDaysInMs) {\n          cleanedTimestamps[authorName] = timestamp;\n        } else {\n          removedCount++;\n        }\n      }\n\n      if (removedCount > 0) {\n        chrome.storage.local.set({ [storageKey]: cleanedTimestamps }, () => {\n          console.log(`Cleaned up ${removedCount} old timestamp entries`);\n          resolve();\n        });\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nconsole.log(\"EngageKit content script loaded - Background Window Mode\");\n"],"names":["wait","ms","resolve","backgroundLog","args","backgroundError","backgroundWarn","backgroundGroup","backgroundGroupEnd","postCommentOnPost","postContainer","comment","isCommentingActive","commentButton","commentEditor","editableField","lineText","p","selection","range","inputEvent","submitButton","error","commentedAuthors","commentedAuthorsWithTimestamps","postsSkippedDuplicateCount","recentAuthorsDetectedCount","commentedPostUrns","postsSkippedAlreadyCommentedCount","duplicatePostsDetectedCount","audioContext","currentOscillator","audioElement","showStartButton","overlay","container","title","subtitle","startButton","infoText","injectAndPlayContinuousSound","result","scrollDuration","commentDelay","maxPosts","duplicateWindow","styleGuide","apiKey","statusPanel","initialPosts","startNewCommentingFlowWithDelayedTabSwitch","reject","AudioContext","oscillator","gainNode","mediaStreamDestination","minFreq","maxFreq","frequency","playPromise","request","sender","sendResponse","stopTabActiveAudio","errorDiv","getTodayDateString","loadCommentedAuthorsWithTimestamps","storageKey","authorTimestamps","name","timestamp","saveCommentedAuthorWithTimestamp","authorName","now","hasCommentedOnAuthorRecently","hoursWindow","hoursInMs","loadTodayCommentedAuthors","todayAuthors","saveCommentedAuthor","today","loadCounters","updateSkippedPostCounter","loadCommentedPostUrns","storedUrns","urn","saveCommentedPostUrn","urnsObject","hasCommentedOnPostUrn","extractPostUrns","topLevelPost","dataId","urns","match","innerUrns","updatePostAlreadyCommentedCounter","cleanupOldPostUrns","removedCount","cleanedUrns","updateCommentCounts","todayKey","currentTodayCount","currentAllTimeCount","newTodayCount","newAllTimeCount","forceTabActiveState","cleanupOldTimestamps","scrollFeedToLoadPosts","processAllPostsOnFeed","requestNotificationPermissionForAntiThrottling","originalHasFocus","originalAddEventListener","type","listener","options","forceTriggerLinkedInLoading","visibilityEvent","focusEvent","pageShowEvent","infiniteScrollButton","triggerScrollEvents","scrollEvent","selector","element","wheelEvent","mainContainer","duration","startTime","endTime","scrollAttempts","postCountBefore","lastPostCount","pauseBetweenScrolls","currentTime","timeRemaining","currentPosts","newPostsThisSession","timeRemainingElement","postsLoadedElement","scrollProgressElement","beforeScroll","documentHeight","afterScroll","newDocumentHeight","newPostCount","newPosts","totalNewPosts","finalPosts","actualDuration","postContainers","altSelector1","altSelector2","altSelector3","commentCount","i","postUrns","hasCommentedOnThisPost","authorInfo","extractAuthorInfo","postContent","extractPostContent","postAuthorContent","success","delayChunks","chunk","authorContainer","nameSelectors","nameElement","extractText","node","text","child","_a","contentContainer","content","cleanedTimestamps"],"mappings":"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"}