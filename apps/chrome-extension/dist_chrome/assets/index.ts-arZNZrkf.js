console.log("background script loaded");let n={isRunning:!1,styleGuide:"",apiKey:"",scrollDuration:10,commentDelay:10,maxPosts:20,duplicateWindow:24,commentCount:0};const s=(e,c={})=>{try{chrome.runtime.sendMessage({action:"statusUpdate",status:e,commentCount:n.commentCount,isRunning:n.isRunning,...c}),chrome.storage.local.set({isRunning:n.isRunning,currentCommentCount:n.commentCount})}catch(a){console.error("Error sending status update:",a)}},d=async e=>{console.log("Background: Starting comment generation for content length:",(e==null?void 0:e.length)||0);const c=new GoogleGenAI({apiKey:n.apiKey}),a=`
  You are a LinkedIn influencer commenting on a post. 
  
  Generate concise but engaging comments for a single LinkedIn. 

  Super Importantly, ONLY REPSOND WITH THE COMMENT. DO NOT REPLY WITH ANYTHING ELSE LIKE QUOTATIONS OR ANYTHING ELSE.
  
  You must ahere to the style guide: ${n.styleGuide}. 
  
  Importantly, ahere strictly to the following additional rules:
  - Keep comments professional yet conversational
  - under 100 words
  - avoid generic responses.

  Super Importantly, ONLY REPSOND WITH THE COMMENT. DO NOT REPLY WITH ANYTHING ELSE LIKE QUOTATIONS OR ANYTHING ELSE.

  Generate a thoughtful comment for this LinkedIn post: ${e}

  Super Importantly, ONLY REPSOND WITH THE COMMENT. DO NOT REPLY WITH ANYTHING ELSE LIKE QUOTATIONS OR ANYTHING ELSE.

  Super Importantly, do not return any artefacts that might imply that the comment was generated by AI like placeholders [First's Name] or [Post Content].

  The postContent above likely starts with the author's name. Address the author's name somewhere in your comment. If you can't find a name, don't try to put in placeholder, just don't address them.

  It's important that you think very hard to make sure that what you return is as natural and human sounding/looking as possible without raising any red flags.

  `;try{const r=(await c.models.generateContent({model:"gemini-2.0-flash-lite",contents:a,config:{maxOutputTokens:100,temperature:.7}})).text||"Great post! Thanks for sharing.";return console.log("Background: Successfully generated comment:",r.substring(0,100)+"..."),r}catch(i){const r={message:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0,name:i instanceof Error?i.name:"Unknown",apiKey:n.apiKey?"Present":"Missing",styleGuide:n.styleGuide?"Present":"Missing",postContentLength:e?e.length:0,timestamp:new Date().toISOString()};console.error("Background: Error generating comment:",r);try{chrome.tabs.query({active:!0,currentWindow:!0},o=>{var t;(t=o[0])!=null&&t.id&&chrome.tabs.sendMessage(o[0].id,{action:"statusUpdate",error:r})})}catch(o){console.error("Background: Failed to send error message to content script:",o)}throw i}},g=async(e,c,a,i,r,o)=>{try{n.styleGuide=e,n.apiKey=c,n.scrollDuration=a,n.commentDelay=i,n.maxPosts=r,n.duplicateWindow=o,n.isRunning=!0,n.commentCount=0,console.log("Starting LinkedIn auto-commenting process..."),s("Starting LinkedIn auto-commenting...");const t=await chrome.tabs.query({active:!0,currentWindow:!0});t.length>0&&t[0].id&&(n.originalTabId=t[0].id,console.log(`Captured original tab ID: ${n.originalTabId}`));let l;if(console.log("Creating LinkedIn tab in current window..."),s("Creating LinkedIn tab for automation..."),l=await chrome.tabs.create({url:"https://www.linkedin.com/feed/",active:!0,pinned:!0}),!l||!l.id)throw new Error("Failed to create LinkedIn feed tab");n.feedTabId=l.id,console.log(`LinkedIn tab created with ID: ${l.id}`),console.log(`LinkedIn tab pinned status: ${l.pinned}`),s("LinkedIn tab created successfully as pinned tab (anti-throttling)..."),s("Waiting for LinkedIn page to load..."),console.log("Waiting for content script to signal page ready...")}catch(t){console.error("Error in auto-commenting process:",t),n.isRunning=!1,s("Error occurred during auto-commenting setup",{isRunning:!1})}};chrome.runtime.onMessage.addListener((e,c,a)=>{var i,r;if(e.action==="backgroundLog"){const o=new Date().toLocaleTimeString(),t=c.tab?`[Tab ${c.tab.id}]`:"[Unknown Tab]";switch(e.level){case"error":console.error(`${o} ${t} CONTENT:`,...e.args);break;case"warn":console.warn(`${o} ${t} CONTENT:`,...e.args);break;case"group":console.group(`${o} ${t} CONTENT:`,...e.args);break;case"groupEnd":console.groupEnd();break;default:console.log(`${o} ${t} CONTENT:`,...e.args);break}a({success:!0})}else if(e.action==="startAutoCommenting"){console.log("Background: Received startAutoCommenting with settings:",{scrollDuration:e.scrollDuration,commentDelay:e.commentDelay,maxPosts:e.maxPosts,duplicateWindow:e.duplicateWindow,styleGuide:((i=e.styleGuide)==null?void 0:i.substring(0,50))+"...",hasApiKey:!!e.apiKey});const o={apiKey:e.apiKey,styleGuide:e.styleGuide,scrollDuration:e.scrollDuration,commentDelay:e.commentDelay,maxPosts:e.maxPosts,duplicateWindow:e.duplicateWindow};console.log("Background: Saving settings to storage:",o),chrome.storage.local.set(o),g(e.styleGuide,e.apiKey,e.scrollDuration,e.commentDelay,e.maxPosts,e.duplicateWindow),a({success:!0})}else if(e.action==="stopAutoCommenting")console.log("Background: Received stopAutoCommenting request"),n.isRunning=!1,n.feedTabId&&(chrome.tabs.sendMessage(n.feedTabId,{action:"stopCommentingFlow"}),chrome.tabs.remove(n.feedTabId).catch(()=>{})),chrome.storage.local.set({isRunning:!1,currentCommentCount:0}),n.commentCount=0,n.originalTabId=void 0,s("Process stopped and LinkedIn tab closed",{isRunning:!1}),a({success:!0});else{if(e.action==="generateComment")return console.log("Background: Received comment generation request for content:",((r=e.postContent)==null?void 0:r.substring(0,100))+"..."),d(e.postContent).then(o=>{console.log("Background: Sending comment response:",o.substring(0,100)+"..."),a({comment:o})}).catch(o=>{console.error("Background: Error in comment generation promise:",o);const t={message:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,name:o instanceof Error?o.name:"Unknown",apiKey:n.apiKey?"Present":"Missing",styleGuide:n.styleGuide?"Present":"Missing",postContentLength:e.postContent?e.postContent.length:0,timestamp:new Date().toISOString(),type:"openrouter_api_error"};n.feedTabId&&chrome.tabs.sendMessage(n.feedTabId,{action:"openrouter_error",error:t}).catch(l=>{console.error("Background: Failed to send error to content script:",l)}),console.error("Background: Sending fallback comment due to error"),a({comment:"Great post! Thanks for sharing.",error:t})}),!0;if(e.action==="updateCommentCount")n.commentCount=e.count,s(e.status||`Processed ${e.count} comments`,{commentCount:e.count}),a({success:!0});else if(e.action==="commentingCompleted")n.isRunning=!1,n.feedTabId&&chrome.tabs.remove(n.feedTabId).catch(()=>{console.log("LinkedIn tab was already closed or could not be closed")}),n.originalTabId=void 0,s("Commenting completed! LinkedIn tab closed. Check the counts above for total comments posted.",{isRunning:!1}),a({success:!0});else{if(e.action==="moveToOriginalTab")return console.log("Background: Received request to move back to the original tab"),n.originalTabId&&chrome.tabs.update(n.originalTabId,{active:!0}).then(()=>{console.log(`âœ… Successfully focused original tab ID: ${n.originalTabId}`),a({success:!0})}),!0;e.action==="pageReady"&&(console.log("Content script signaled page ready - showing start button"),s("LinkedIn feed loaded. Showing start button..."),n.feedTabId&&(chrome.tabs.sendMessage(n.feedTabId,{action:"showStartButton"}),console.log("Start button should now be visible in the LinkedIn tab")),a({success:!0}))}}});chrome.tabs.onRemoved.addListener(e=>{n.feedTabId===e&&(console.log("LinkedIn tab was manually closed"),n.feedTabId=void 0,n.isRunning&&(n.isRunning=!1,chrome.storage.local.set({isRunning:!1,currentCommentCount:0}),n.commentCount=0,n.originalTabId=void 0,s("LinkedIn tab was closed - automation stopped",{isRunning:!1})))});console.log("EngageKit background script loaded");
//# sourceMappingURL=index.ts-arZNZrkf.js.map
